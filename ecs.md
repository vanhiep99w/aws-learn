# Amazon ECS (Elastic Container Service)

## ğŸ“– Tá»•ng quan

**Amazon ECS (Elastic Container Service)** lÃ  dá»‹ch vá»¥ quáº£n lÃ½ container Ä‘Æ°á»£c AWS quáº£n lÃ½ hoÃ n toÃ n (fully managed). ECS giÃºp báº¡n cháº¡y, dá»«ng vÃ  quáº£n lÃ½ Docker containers trÃªn má»™t cluster.

### Container lÃ  gÃ¬?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VIRTUAL MACHINE                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   App A  â”‚  â”‚   App B  â”‚  â”‚   App C  â”‚                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚  â”‚  Libs A  â”‚  â”‚  Libs B  â”‚  â”‚  Libs C  â”‚                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚  â”‚ Guest OS â”‚  â”‚ Guest OS â”‚  â”‚ Guest OS â”‚  â† Má»—i VM cÃ³ OS  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Hypervisor (VMware, KVM)                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                    Host OS                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTAINERS                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚   App A  â”‚  â”‚   App B  â”‚  â”‚   App C  â”‚                  â”‚
â”‚  â”‚ + Libs A â”‚  â”‚ + Libs B â”‚  â”‚ + Libs C â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Container Runtime (Docker)                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                Host OS (1 OS duy nháº¥t!)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Táº¡i sao dÃ¹ng Containers?

| VM (Virtual Machine) | Container |
|---------------------|-----------|
| âŒ Khá»Ÿi Ä‘á»™ng cháº­m (phÃºt) | âœ… Khá»Ÿi Ä‘á»™ng nhanh (giÃ¢y) |
| âŒ Tá»‘n nhiá»u resources | âœ… Nháº¹, chia sáº» OS kernel |
| âŒ Má»—i VM cáº§n Guest OS | âœ… KhÃ´ng cáº§n Guest OS |
| âŒ Image size lá»›n (GBs) | âœ… Image size nhá» (MBs) |
| âœ… Isolation hoÃ n toÃ n | âš ï¸ Isolation Ã­t hÆ¡n |

### Táº¡i sao cáº§n ECS?

| Tá»± quáº£n lÃ½ Docker | Amazon ECS |
|-------------------|------------|
| Pháº£i setup Docker Swarm/K8s | AWS quáº£n lÃ½ hoÃ n toÃ n |
| Tá»± scheduling containers | ECS tá»± Ä‘á»™ng scheduling |
| Tá»± quáº£n lÃ½ cluster | Cluster quáº£n lÃ½ sáºµn |
| Tá»± thiáº¿t láº­p load balancing | TÃ­ch há»£p ALB/NLB |
| Tá»± cáº¥u hÃ¬nh auto-scaling | Application Auto Scaling |

#### ğŸ” Giáº£i thÃ­ch chi tiáº¿t tá»«ng Ä‘iá»ƒm:

---

**1. Pháº£i setup Docker Swarm/K8s vs AWS quáº£n lÃ½ hoÃ n toÃ n**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tá»° QUáº¢N LÃ (Docker Swarm/K8s)                     â”‚
â”‚                                                                       â”‚
â”‚   Báº¡n pháº£i:                                                          â”‚
â”‚   â”œâ”€â”€ CÃ i Ä‘áº·t Docker trÃªn tá»«ng server                                â”‚
â”‚   â”œâ”€â”€ Setup Swarm cluster hoáº·c K8s master/worker nodes              â”‚
â”‚   â”œâ”€â”€ Cáº¥u hÃ¬nh network overlay (Flannel, Calico, Weave)             â”‚
â”‚   â”œâ”€â”€ Setup etcd cluster Ä‘á»ƒ lÆ°u state                               â”‚
â”‚   â”œâ”€â”€ Cáº¥u hÃ¬nh TLS certificates                                     â”‚
â”‚   â”œâ”€â”€ Monitor cluster health                                         â”‚
â”‚   â””â”€â”€ Upgrade/patch cluster components                               â”‚
â”‚                                                                       â”‚
â”‚   â° Thá»i gian setup: 2-5 ngÃ y                                       â”‚
â”‚   ğŸ‘¨â€ğŸ’» YÃªu cáº§u: DevOps engineer cÃ³ kinh nghiá»‡m                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AMAZON ECS                                   â”‚
â”‚                                                                       â”‚
â”‚   Báº¡n chá»‰ cáº§n:                                                       â”‚
â”‚   â””â”€â”€ aws ecs create-cluster --cluster-name my-cluster               â”‚
â”‚                                                                       â”‚
â”‚   â° Thá»i gian setup: 5 phÃºt                                         â”‚
â”‚   ğŸ‘¨â€ğŸ’» YÃªu cáº§u: Biáº¿t cÆ¡ báº£n vá» containers                              â”‚
â”‚                                                                       â”‚
â”‚   AWS lo pháº§n cÃ²n láº¡i:                                               â”‚
â”‚   â”œâ”€â”€ Control plane                                                  â”‚
â”‚   â”œâ”€â”€ State management                                               â”‚
â”‚   â”œâ”€â”€ API server                                                     â”‚
â”‚   â””â”€â”€ Cluster coordination                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**2. Tá»± scheduling containers vs ECS tá»± Ä‘á»™ng scheduling**

**Scheduling** = Quyáº¿t Ä‘á»‹nh container nÃ o cháº¡y trÃªn server nÃ o.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Tá»° SCHEDULING                                â”‚
â”‚                                                                       â”‚
â”‚  Báº¡n cÃ³ 3 servers, má»—i server cÃ³ resources khÃ¡c nhau:               â”‚
â”‚                                                                       â”‚
â”‚  Server 1: 4 CPU, 8GB RAM (Ä‘ang dÃ¹ng 3 CPU, 6GB)                    â”‚
â”‚  Server 2: 2 CPU, 4GB RAM (Ä‘ang dÃ¹ng 0.5 CPU, 1GB)                  â”‚
â”‚  Server 3: 4 CPU, 16GB RAM (Ä‘ang dÃ¹ng 4 CPU, 14GB)                  â”‚
â”‚                                                                       â”‚
â”‚  â†’ Báº¡n muá»‘n deploy container cáº§n 1 CPU, 2GB RAM                     â”‚
â”‚  â†’ Báº¡n pháº£i Tá»° kiá»ƒm tra server nÃ o cÃ³ Ä‘á»§ resources                  â”‚
â”‚  â†’ Náº¿u Server 3 Ä‘áº§y, báº¡n pháº£i Ä‘á»•i sang Server 1/2                   â”‚
â”‚  â†’ Pháº£i viáº¿t logic Ä‘á»ƒ handle failures, retries                      â”‚
â”‚                                                                       â”‚
â”‚  âŒ Prone to human error                                             â”‚
â”‚  âŒ KhÃ³ scale khi cÃ³ 50+ servers                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ECS SCHEDULER                                  â”‚
â”‚                                                                       â”‚
â”‚  ECS tá»± Ä‘á»™ng:                                                        â”‚
â”‚  â”œâ”€â”€ Track resources cá»§a táº¥t cáº£ instances                           â”‚
â”‚  â”œâ”€â”€ TÃ¬m instance phÃ¹ há»£p nháº¥t (bin packing)                        â”‚
â”‚  â”œâ”€â”€ Handle constraints (AZ, instance type, custom)                 â”‚
â”‚  â”œâ”€â”€ Retry náº¿u placement fail                                       â”‚
â”‚  â””â”€â”€ Rebalance khi cáº§n                                              â”‚
â”‚                                                                       â”‚
â”‚  Placement Strategies:                                               â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   BINPACK    â”‚  â”‚   SPREAD     â”‚  â”‚   RANDOM     â”‚               â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚               â”‚
â”‚  â”‚ Tá»‘i Æ°u cost  â”‚  â”‚ Tá»‘i Æ°u HA    â”‚  â”‚ ÄÆ¡n giáº£n     â”‚               â”‚
â”‚  â”‚ Pack Ä‘áº§y 1   â”‚  â”‚ Spread Ä‘á»u   â”‚  â”‚ Chá»n random  â”‚               â”‚
â”‚  â”‚ server trÆ°á»›c â”‚  â”‚ cÃ¡c AZs      â”‚  â”‚              â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                       â”‚
â”‚  âœ… Tá»± Ä‘á»™ng, khÃ´ng cáº§n can thiá»‡p                                    â”‚
â”‚  âœ… Scale tá»›i hÃ ng ngÃ n containers                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VÃ­ dá»¥ Placement Strategy:**

```bash
# Spread tasks across Availability Zones (HA)
aws ecs create-service \
  --placement-strategy type=spread,field=attribute:ecs.availability-zone

# Pack tasks to minimize EC2 instances (cost)
aws ecs create-service \
  --placement-strategy type=binpack,field=memory
```

---

**3. Tá»± quáº£n lÃ½ cluster vs Cluster quáº£n lÃ½ sáºµn**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tá»° QUáº¢N LÃ CLUSTER                                â”‚
â”‚                                                                       â”‚
â”‚  Khi 1 server cháº¿t:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. Monitor alert (báº¡n pháº£i setup monitoring trÆ°á»›c)        â”‚     â”‚
â”‚  â”‚  2. SSH vÃ o server Ä‘á»ƒ debug (náº¿u cÃ²n access Ä‘Æ°á»£c)          â”‚     â”‚
â”‚  â”‚  3. Quyáº¿t Ä‘á»‹nh: repair hay replace?                        â”‚     â”‚
â”‚  â”‚  4. Náº¿u replace:                                           â”‚     â”‚
â”‚  â”‚     a. Provision server má»›i                                â”‚     â”‚
â”‚  â”‚     b. CÃ i Docker                                          â”‚     â”‚
â”‚  â”‚     c. Join vÃ o cluster                                    â”‚     â”‚
â”‚  â”‚     d. Migrate containers                                  â”‚     â”‚
â”‚  â”‚  5. Remove server cÅ© khá»i cluster                          â”‚     â”‚
â”‚  â”‚  6. Update DNS/LB náº¿u cáº§n                                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                       â”‚
â”‚  â° Thá»i gian: 30 phÃºt - vÃ i giá»                                     â”‚
â”‚  ğŸš¨ CÃ³ thá»ƒ xáº£y ra lÃºc 3 giá» sÃ¡ng!                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ECS MANAGED CLUSTER                              â”‚
â”‚                                                                       â”‚
â”‚  Vá»›i Fargate:                                                        â”‚
â”‚  â””â”€â”€ KhÃ´ng cÃ³ server Ä‘á»ƒ quáº£n lÃ½! AWS lo táº¥t cáº£.                     â”‚
â”‚                                                                       â”‚
â”‚  Vá»›i EC2 + ECS:                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. ECS detect container instance unhealthy                â”‚     â”‚
â”‚  â”‚  2. Tasks Ä‘Æ°á»£c reschedule sang instance khÃ¡c Tá»° Äá»˜NG      â”‚     â”‚
â”‚  â”‚  3. Auto Scaling Group thay tháº¿ instance má»›i              â”‚     â”‚
â”‚  â”‚  4. Instance má»›i tá»± Ä‘á»™ng join cluster (ECS Agent)         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                       â”‚
â”‚  â° Thá»i gian: 1-5 phÃºt (tá»± Ä‘á»™ng)                                    â”‚
â”‚  ğŸ˜´ Báº¡n cÃ³ thá»ƒ tiáº¿p tá»¥c ngá»§!                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**4. Tá»± thiáº¿t láº­p load balancing vs TÃ­ch há»£p ALB/NLB**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tá»° SETUP LOAD BALANCING                           â”‚
â”‚                                                                       â”‚
â”‚  Báº¡n pháº£i:                                                           â”‚
â”‚  â”œâ”€â”€ Setup HAProxy/Nginx lÃ m load balancer                          â”‚
â”‚  â”œâ”€â”€ Cáº¥u hÃ¬nh health checks                                         â”‚
â”‚  â”œâ”€â”€ Update config má»—i khi container start/stop                     â”‚
â”‚  â”œâ”€â”€ Handle SSL termination                                         â”‚
â”‚  â””â”€â”€ Setup HA cho chÃ­nh load balancer                               â”‚
â”‚                                                                       â”‚
â”‚  Váº¥n Ä‘á» vá»›i Dynamic Ports:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Container 1: host:32768 â†’ container:80         â”‚               â”‚
â”‚  â”‚  Container 2: host:32769 â†’ container:80         â”‚               â”‚
â”‚  â”‚  Container 3: host:32770 â†’ container:80         â”‚               â”‚
â”‚  â”‚                                                  â”‚               â”‚
â”‚  â”‚  â†’ Port thay Ä‘á»•i má»—i láº§n deploy!                â”‚               â”‚
â”‚  â”‚  â†’ Pháº£i update LB config liÃªn tá»¥c               â”‚               â”‚
â”‚  â”‚  â†’ ThÆ°á»ng dÃ¹ng Service Discovery (Consul, etc)  â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ECS + ALB INTEGRATION                             â”‚
â”‚                                                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â”‚     Application Load Balancer       â”‚                      â”‚
â”‚         â”‚     (AWS managed, HA by default)    â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                         â”‚                                            â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚         â–¼               â–¼               â–¼                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚    â”‚ Task 1  â”‚    â”‚ Task 2  â”‚    â”‚ Task 3  â”‚                        â”‚
â”‚    â”‚ :32768  â”‚    â”‚ :32769  â”‚    â”‚ :32770  â”‚                        â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                       â”‚
â”‚  ECS tá»± Ä‘á»™ng:                                                        â”‚
â”‚  â”œâ”€â”€ Register task vÃ o Target Group khi start                       â”‚
â”‚  â”œâ”€â”€ Deregister khi task stop                                       â”‚
â”‚  â”œâ”€â”€ Handle dynamic ports (ECS biáº¿t port mapping)                   â”‚
â”‚  â”œâ”€â”€ Connection draining trÆ°á»›c khi remove                           â”‚
â”‚  â””â”€â”€ Health check integration                                        â”‚
â”‚                                                                       â”‚
â”‚  âœ… Zero manual intervention!                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VÃ­ dá»¥ cáº¥u hÃ¬nh:**

```json
// Service Definition vá»›i Load Balancer
{
  "serviceName": "my-service",
  "loadBalancers": [
    {
      "targetGroupArn": "arn:aws:elasticloadbalancing:...:targetgroup/my-tg/xxx",
      "containerName": "my-app",
      "containerPort": 80
    }
  ],
  "healthCheckGracePeriodSeconds": 60
}
```

---

**5. Tá»± cáº¥u hÃ¬nh auto-scaling vs Application Auto Scaling**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tá»° SETUP AUTO SCALING                             â”‚
â”‚                                                                       â”‚
â”‚  Báº¡n pháº£i viáº¿t custom solution:                                      â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  1. Collect metrics (Prometheus, custom scripts)             â”‚   â”‚
â”‚  â”‚  2. Viáº¿t scaling logic:                                      â”‚   â”‚
â”‚  â”‚     if cpu > 70%:                                            â”‚   â”‚
â”‚  â”‚         spawn_more_containers()                              â”‚   â”‚
â”‚  â”‚     if cpu < 30%:                                            â”‚   â”‚
â”‚  â”‚         terminate_containers()                               â”‚   â”‚
â”‚  â”‚  3. Handle cooldown periods                                  â”‚   â”‚
â”‚  â”‚  4. Prevent thrashing (scale up/down liÃªn tá»¥c)              â”‚   â”‚
â”‚  â”‚  5. Implement min/max limits                                 â”‚   â”‚
â”‚  â”‚  6. Scale servers (náº¿u háº¿t capacity)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  âŒ Phá»©c táº¡p, dá»… bugs                                                â”‚
â”‚  âŒ KhÃ´ng scale Ä‘á»§ nhanh                                             â”‚
â”‚  âŒ CÃ³ thá»ƒ scale sai (over/under provision)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ECS + APPLICATION AUTO SCALING                       â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    CloudWatch                                 â”‚   â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚        â”‚  ECSServiceAverageCPUUtilization    â”‚               â”‚   â”‚
â”‚  â”‚        â”‚         Current: 75%                â”‚               â”‚   â”‚
â”‚  â”‚        â”‚         Target: 70%                 â”‚               â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                          â”‚                                    â”‚   â”‚
â”‚  â”‚                          â–¼                                    â”‚   â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚        â”‚    Application Auto Scaling          â”‚               â”‚   â”‚
â”‚  â”‚        â”‚    Action: Scale Out                 â”‚               â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                          â”‚                                    â”‚   â”‚
â”‚  â”‚                          â–¼                                    â”‚   â”‚
â”‚  â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚        â”‚    ECS Service                       â”‚               â”‚   â”‚
â”‚  â”‚        â”‚    Desired: 3 â†’ 4 tasks             â”‚               â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  CÃ¡c loáº¡i scaling policies:                                          â”‚
â”‚                                                                       â”‚
â”‚  1. Target Tracking (set-and-forget):                                â”‚
â”‚     "Giá»¯ CPU á»Ÿ má»©c 70%"                                              â”‚
â”‚                                                                       â”‚
â”‚  2. Step Scaling (chi tiáº¿t hÆ¡n):                                     â”‚
â”‚     CPU 70-80%: +1 task                                              â”‚
â”‚     CPU 80-90%: +2 tasks                                             â”‚
â”‚     CPU > 90%: +4 tasks                                              â”‚
â”‚                                                                       â”‚
â”‚  3. Scheduled Scaling:                                               â”‚
â”‚     9 AM: Scale to 10 tasks (giá» cao Ä‘iá»ƒm)                          â”‚
â”‚     6 PM: Scale to 3 tasks (giá» tháº¥p Ä‘iá»ƒm)                          â”‚
â”‚                                                                       â”‚
â”‚  âœ… AWS Ä‘Ã£ test vÃ  tá»‘i Æ°u                                            â”‚
â”‚  âœ… Integrate seamlessly vá»›i ECS                                     â”‚
â”‚  âœ… Predictive scaling (ML-based)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VÃ­ dá»¥ cáº¥u hÃ¬nh Target Tracking:**

```bash
# ÄÄƒng kÃ½ scalable target
aws application-autoscaling register-scalable-target \
  --service-namespace ecs \
  --resource-id service/my-cluster/my-service \
  --scalable-dimension ecs:service:DesiredCount \
  --min-capacity 2 \
  --max-capacity 10

# Táº¡o scaling policy (Target Tracking)
aws application-autoscaling put-scaling-policy \
  --service-namespace ecs \
  --resource-id service/my-cluster/my-service \
  --scalable-dimension ecs:service:DesiredCount \
  --policy-name cpu70-target-tracking \
  --policy-type TargetTrackingScaling \
  --target-tracking-scaling-policy-configuration '{
    "TargetValue": 70.0,
    "PredefinedMetricSpecification": {
      "PredefinedMetricType": "ECSServiceAverageCPUUtilization"
    },
    "ScaleOutCooldown": 60,
    "ScaleInCooldown": 300
  }'
```

---

### ğŸ¯ TÃ³m táº¯t: Tá»± quáº£n lÃ½ vs ECS

| CÃ´ng viá»‡c | Tá»± quáº£n lÃ½ | ECS |
|-----------|-----------|-----|
| Setup cluster | 2-5 ngÃ y | 5 phÃºt |
| Scheduling | Code custom | Built-in |
| Server failure | Manual response | Auto heal |
| Load balancing | DIY + maintain | 1 config |
| Auto scaling | Custom scripts | Policy config |
| **Total DevOps effort** | **Cao** | **Tháº¥p** |

> ğŸ’¡ **Káº¿t luáº­n**: ECS cho phÃ©p báº¡n táº­p trung vÃ o **application code** thay vÃ¬ **infrastructure management**. Äáº·c biá»‡t vá»›i **Fargate**, báº¡n khÃ´ng cáº§n quan tÃ¢m Ä‘áº¿n servers ná»¯a!

---

## ğŸ—ï¸ Kiáº¿n trÃºc ECS

### CÃ¡c thÃ nh pháº§n chÃ­nh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ECS CLUSTER                           â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    ECS SERVICE                       â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚
â”‚  â”‚  â”‚  TASK    â”‚  â”‚  TASK    â”‚  â”‚  TASK    â”‚           â”‚    â”‚
â”‚  â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚           â”‚    â”‚
â”‚  â”‚  â”‚â”‚Containerâ”‚â”‚  â”‚â”‚Containerâ”‚â”‚  â”‚â”‚Containerâ”‚â”‚           â”‚    â”‚
â”‚  â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚           â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Container Instance 1  â”‚  â”‚ Container Instance 2  â”‚       â”‚
â”‚  â”‚ (EC2 hoáº·c Fargate)    â”‚  â”‚ (EC2 hoáº·c Fargate)    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“Œ 1. Cluster (Cá»¥m)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ECS CLUSTER                                â”‚
â”‚                                                                       â”‚
â”‚   = Má»™t "nhÃ³m logic" Ä‘á»ƒ quáº£n lÃ½ táº¥t cáº£ resources ECS                 â”‚
â”‚                                                                       â”‚
â”‚   VÃ­ von: Cluster giá»‘ng nhÆ° 1 CÃ”NG TY                               â”‚
â”‚   - CÃ´ng ty cÃ³ nhiá»u phÃ²ng ban (Services)                           â”‚
â”‚   - Má»—i phÃ²ng ban cÃ³ nhiá»u nhÃ¢n viÃªn (Tasks)                        â”‚
â”‚   - CÃ´ng ty thuÃª vÄƒn phÃ²ng (EC2) hoáº·c coworking space (Fargate)     â”‚
â”‚                                                                       â”‚
â”‚   Trong 1 cluster cÃ³:                                                â”‚
â”‚   â”œâ”€â”€ Nhiá»u Services                                                 â”‚
â”‚   â”œâ”€â”€ Nhiá»u Tasks                                                    â”‚
â”‚   â”œâ”€â”€ Compute resources (EC2 hoáº·c Fargate)                          â”‚
â”‚   â””â”€â”€ Configs, settings chung                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Khi nÃ o táº¡o nhiá»u clusters?**
- MÃ´i trÆ°á»ng khÃ¡c nhau: `dev-cluster`, `staging-cluster`, `prod-cluster`
- Projects tÃ¡ch biá»‡t hoÃ n toÃ n
- Regions khÃ¡c nhau

---

### ğŸ“Œ 2. Task Definition (Báº£n thiáº¿t káº¿)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TASK DEFINITION                               â”‚
â”‚                                                                       â”‚
â”‚   = Báº¢N THIáº¾T Káº¾ / BLUEPRINT Ä‘á»ƒ táº¡o container                       â”‚
â”‚   = Giá»‘ng nhÆ° "cÃ´ng thá»©c náº¥u Äƒn"                                     â”‚
â”‚                                                                       â”‚
â”‚   Task Definition KHÃ”NG PHáº¢I lÃ  container Ä‘ang cháº¡y!                 â”‚
â”‚   NÃ³ chá»‰ MÃ” Táº¢ cÃ¡ch táº¡o container.                                   â”‚
â”‚                                                                       â”‚
â”‚   Má»™t Task Definition bao gá»“m:                                       â”‚
â”‚   â”œâ”€â”€ Image nÃ o? (nginx:latest, my-app:v1.2.3)                      â”‚
â”‚   â”œâ”€â”€ Cáº§n bao nhiÃªu CPU, Memory?                                     â”‚
â”‚   â”œâ”€â”€ Port mapping? (host:80 â†’ container:80)                        â”‚
â”‚   â”œâ”€â”€ Environment variables?                                         â”‚
â”‚   â”œâ”€â”€ Secrets? (password tá»« Secrets Manager)                        â”‚
â”‚   â”œâ”€â”€ Logging config? (CloudWatch)                                   â”‚
â”‚   â”œâ”€â”€ Volume mounts?                                                 â”‚
â”‚   â””â”€â”€ IAM roles?                                                      â”‚
â”‚                                                                       â”‚
â”‚   Versioned: my-app:1, my-app:2, my-app:3 (revisions)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VÃ­ dá»¥ Task Definition JSON:**
```json
{
  "family": "my-web-app",
  "cpu": "256",
  "memory": "512",
  "networkMode": "awsvpc",
  "containerDefinitions": [
    {
      "name": "nginx",
      "image": "nginx:1.21",
      "portMappings": [
        { "containerPort": 80 }
      ],
      "environment": [
        { "name": "ENV", "value": "production" }
      ],
      "secrets": [
        { "name": "DB_PASSWORD", "valueFrom": "arn:aws:secretsmanager:..." }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/my-web-app"
        }
      }
    }
  ]
}
```

---

### ğŸ“Œ 3. Task (CÃ´ng viá»‡c Ä‘ang cháº¡y)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                             TASK                                     â”‚
â”‚                                                                       â”‚
â”‚   = INSTANCE cá»§a Task Definition Ä‘ang cháº¡y                           â”‚
â”‚   = Container(s) thá»±c sá»± Ä‘ang cháº¡y                                   â”‚
â”‚                                                                       â”‚
â”‚   VÃ­ von:                                                            â”‚
â”‚   - Task Definition = CÃ´ng thá»©c pizza                                â”‚
â”‚   - Task = Chiáº¿c pizza tháº­t Ä‘ang Ä‘Æ°á»£c lÃ m/Äƒn                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### âš ï¸ 1 Task cÃ³ thá»ƒ chá»©a NHIá»€U Containers!

```
TRÆ¯á»œNG Há»¢P 1: 1 Task = 1 Container (phá»• biáº¿n nháº¥t - 90%)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TASK                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚         Container: user-api          â”‚   â”‚
â”‚   â”‚         (Node.js app)                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TRÆ¯á»œNG Há»¢P 2: 1 Task = NHIá»€U Containers (sidecar pattern)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TASK                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Container 1:   â”‚  â”‚  Container 2:   â”‚  â”‚
â”‚   â”‚  nginx          â”‚  â”‚  app            â”‚  â”‚
â”‚   â”‚  (reverse proxy)â”‚  â”‚  (Python Flask) â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚   Cáº£ 2 chia sáº»:                             â”‚
â”‚   - Network (gá»i nhau qua localhost)        â”‚
â”‚   - Storage volumes                          â”‚
â”‚   - Lifecycle (sá»‘ng cháº¿t cÃ¹ng nhau)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Khi nÃ o dÃ¹ng nhiá»u containers trong 1 Task?**
| Pattern | VÃ­ dá»¥ |
|---------|-------|
| **Sidecar** | App + Log collector |
| **Reverse Proxy** | Nginx + Python app |
| **Service Mesh** | Envoy + Your app |

> âš ï¸ **LÆ°u Ã½**: Containers trong cÃ¹ng Task **KHÃ”NG THá»‚ scale riÃªng** - cáº£ nhÃ³m scale cÃ¹ng nhau!

---

### ğŸ“Œ 4. Service (Dá»‹ch vá»¥)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SERVICE                                    â”‚
â”‚                                                                       â”‚
â”‚   = Äáº£m báº£o sá»‘ lÆ°á»£ng Tasks mong muá»‘n LUÃ”N CHáº Y                       â”‚
â”‚   = "Supervisor" giÃ¡m sÃ¡t Tasks                                      â”‚
â”‚                                                                       â”‚
â”‚   Service nÃ³i: "TÃ´i muá»‘n luÃ´n cÃ³ 3 tasks cháº¡y"                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚  Task 1  â”‚  â”‚  Task 2  â”‚  â”‚  Task 3  â”‚                          â”‚
â”‚   â”‚ RUNNING  â”‚  â”‚ RUNNING  â”‚  â”‚ RUNNING  â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                       â”‚
â”‚   Náº¿u Task 2 cháº¿t:                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚  Task 1  â”‚  â”‚  Task 2  â”‚  â”‚  Task 4  â”‚ â† Service tá»± táº¡o má»›i!   â”‚
â”‚   â”‚ RUNNING  â”‚  â”‚  DEAD âŒ â”‚  â”‚ RUNNING  â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                       â”‚
â”‚   Service lÃ m gÃ¬?                                                    â”‚
â”‚   â”œâ”€â”€ Duy trÃ¬ sá»‘ lÆ°á»£ng tasks (desired count)                        â”‚
â”‚   â”œâ”€â”€ Tá»± Ä‘á»™ng restart tasks bá»‹ crash                                â”‚
â”‚   â”œâ”€â”€ Káº¿t ná»‘i vá»›i Load Balancer                                     â”‚
â”‚   â”œâ”€â”€ Rolling deployments (cáº­p nháº­t tá»« tá»«)                          â”‚
â”‚   â”œâ”€â”€ Health checks                                                  â”‚
â”‚   â””â”€â”€ Auto scaling                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Task vs Service:**
| Task | Service |
|------|---------|
| Cháº¡y 1 láº§n rá»“i káº¿t thÃºc | Cháº¡y liÃªn tá»¥c, tá»± restart |
| Batch jobs, cron jobs | Web servers, APIs |
| Manually start/stop | Tá»± Ä‘á»™ng maintain |

---

### ğŸ“Œ 5. Container Instance (Chá»‰ vá»›i EC2 Launch Type)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTAINER INSTANCE                              â”‚
â”‚                                                                       â”‚
â”‚   = EC2 instance Ä‘Ã£ Ä‘Äƒng kÃ½ vá»›i ECS cluster                          â”‚
â”‚   = MÃ¡y chá»§ tháº­t cháº¡y containers                                     â”‚
â”‚                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                   EC2 Instance                               â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚  â”‚  ECS Agent (cháº¡y sáºµn trong ECS-optimized AMI)        â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  - Giao tiáº¿p vá»›i ECS control plane                   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  - Nháº­n lá»‡nh start/stop containers                   â”‚   â”‚   â”‚
â”‚   â”‚  â”‚  - BÃ¡o cÃ¡o resource usage                            â”‚   â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                              â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚   â”‚  â”‚ Container 1 â”‚ â”‚ Container 2 â”‚ â”‚ Container 3 â”‚           â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚   â”‚                                                              â”‚   â”‚
â”‚   â”‚  Docker daemon, OS, etc.                                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚   âš ï¸ Fargate KHÃ”NG cÃ³ Container Instance - AWS quáº£n lÃ½ háº¿t!         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ğŸ“Š Tá»•ng káº¿t quan há»‡ cÃ¡c thÃ nh pháº§n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLUSTER                                    â”‚
â”‚    = CÃ´ng ty / Tá»• chá»©c                                              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        SERVICE A                              â”‚  â”‚
â”‚  â”‚    = PhÃ²ng ban (luÃ´n duy trÃ¬ X nhÃ¢n viÃªn)                    â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
â”‚  â”‚  â”‚ Task 1  â”‚  â”‚ Task 2  â”‚  â”‚ Task 3  â”‚   = NhÃ¢n viÃªn         â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        SERVICE B                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚  â”‚
â”‚  â”‚  â”‚ Task 1  â”‚  â”‚ Task 2  â”‚                                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  TASK DEFINITION = HÆ°á»›ng dáº«n táº¡o Task (blueprint)                   â”‚
â”‚  CONTAINER INSTANCE = VÄƒn phÃ²ng (EC2) - nÆ¡i lÃ m viá»‡c                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ThÃ nh pháº§n | VÃ­ von | MÃ´ táº£ |
|------------|--------|-------|
| **Cluster** | CÃ´ng ty | NhÃ³m logic quáº£n lÃ½ má»i thá»© |
| **Task Definition** | Báº£n mÃ´ táº£ cÃ´ng viá»‡c | Blueprint Ä‘á»ƒ táº¡o container |
| **Task** | NhÃ¢n viÃªn Ä‘ang lÃ m viá»‡c | Container(s) Ä‘ang cháº¡y |
| **Service** | PhÃ²ng ban | Äáº£m báº£o luÃ´n cÃ³ Ä‘á»§ Tasks |
| **Container Instance** | VÄƒn phÃ²ng | EC2 cháº¡y containers |

---

## ğŸš€ Launch Types: EC2 vs Fargate

### â“ Táº¡i sao ECS cáº§n EC2 hoáº·c Fargate? Má»—i cÃ¡i lÃ m gÃ¬?

> **Äiá»ƒm quan trá»ng cáº§n hiá»ƒu**: 
> - ECS lÃ  **bá»™ nÃ£o Ä‘iá»u khiá»ƒn** (khÃ´ng cÃ³ CPU/RAM)
> - EC2/Fargate lÃ  **cÆ¡ báº¯p thá»±c thi** (cÃ³ CPU/RAM tháº­t)
> - Container = chÆ°Æ¡ng trÃ¬nh â†’ cáº§n MÃY THáº¬T Ä‘á»ƒ cháº¡y!
> - **KhÃ´ng cÃ³ EC2/Fargate = ECS khÃ´ng thá»ƒ cháº¡y container nÃ o cáº£!**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ECS (Orchestrator)                          â”‚
â”‚                       ğŸ§  "Bá»˜ NÃƒO ÄIá»€U KHIá»‚N"                         â”‚
â”‚                                                                       â”‚
â”‚   ECS LÃ€M:                                                           â”‚
â”‚   â”œâ”€â”€ Quyáº¿t Ä‘á»‹nh container cháº¡y á»Ÿ Ä‘Ã¢u (scheduling)                  â”‚
â”‚   â”œâ”€â”€ Ra lá»‡nh khá»Ÿi Ä‘á»™ng/dá»«ng containers                             â”‚
â”‚   â”œâ”€â”€ Theo dÃµi health cá»§a containers                                â”‚
â”‚   â”œâ”€â”€ Tá»± Ä‘á»™ng restart container náº¿u cháº¿t                            â”‚
â”‚   â”œâ”€â”€ Scale sá»‘ lÆ°á»£ng containers lÃªn/xuá»‘ng                           â”‚
â”‚   â””â”€â”€ Káº¿t ná»‘i containers vá»›i Load Balancer                          â”‚
â”‚                                                                       â”‚
â”‚   ECS KHÃ”NG LÃ€M:                                                     â”‚
â”‚   â”œâ”€â”€ âŒ Cung cáº¥p CPU/RAM Ä‘á»ƒ cháº¡y containers                        â”‚
â”‚   â””â”€â”€ âŒ Thá»±c sá»± "cháº¡y" container processes                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â”‚ ECS ra lá»‡nh: "Cháº¡y container nÃ y!"
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EC2 (Compute Resources)                          â”‚
â”‚                        ğŸ’ª "CÆ  Báº®P THá»°C THI"                          â”‚
â”‚                                                                       â”‚
â”‚   EC2 LÃ€M:                                                           â”‚
â”‚   â”œâ”€â”€ Cung cáº¥p CPU, RAM, Disk váº­t lÃ½                                â”‚
â”‚   â”œâ”€â”€ Cháº¡y Docker daemon (container runtime)                        â”‚
â”‚   â”œâ”€â”€ Thá»±c sá»± execute container processes                           â”‚
â”‚   â””â”€â”€ Cung cáº¥p network interface cho containers                     â”‚
â”‚                                                                       â”‚
â”‚   EC2 KHÃ”NG LÃ€M:                                                     â”‚
â”‚   â”œâ”€â”€ âŒ Biáº¿t nÃªn cháº¡y container nÃ o (chá» lá»‡nh tá»« ECS)              â”‚
â”‚   â”œâ”€â”€ âŒ Tá»± Ä‘á»™ng scale containers                                   â”‚
â”‚   â””â”€â”€ âŒ Quyáº¿t Ä‘á»‹nh logic deployment                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ• VÃ­ dá»¥: Tiá»‡m Pizza

| Vai trÃ² | Trong tiá»‡m Pizza | Trong AWS |
|---------|------------------|-----------|
| **Manager** | Nháº­n order, phÃ¢n cÃ´ng thá»£ lÃ m pizza nÃ o | **ECS** (Orchestrator) |
| **Thá»£ lÃ m bÃ¡nh** | Thá»±c sá»± nhÃ o bá»™t, nÆ°á»›ng bÃ¡nh | **EC2** (Compute) |
| **Pizza** | Sáº£n pháº©m Ä‘Æ°á»£c táº¡o ra | **Container** (App) |
| **CÃ´ng thá»©c** | HÆ°á»›ng dáº«n lÃ m pizza | **Task Definition** |

**Náº¿u chá»‰ cÃ³ Manager (ECS), khÃ´ng cÃ³ Thá»£ (EC2)**:
```
Manager: "LÃ m 5 pizza Margherita!"
...
...
KhÃ´ng ai lÃ m ğŸ˜… â†’ Cáº§n cÃ³ thá»£ (EC2/Fargate) Ä‘á»ƒ thá»±c hiá»‡n!
```

**Náº¿u chá»‰ cÃ³ Thá»£ (EC2), khÃ´ng cÃ³ Manager (ECS)**:
```
Thá»£: "TÃ´i cÃ³ tay, cÃ³ lÃ² nÆ°á»›ng... nhÆ°ng lÃ m pizza nÃ o?"
Thá»£: "Ai order? Bao nhiÃªu cÃ¡i? Loáº¡i gÃ¬?"
â†’ Cáº§n cÃ³ manager (ECS) Ä‘á»ƒ Ä‘iá»u phá»‘i!
```

### ğŸ¯ Váº­y 2 Launch Types lÃ  gÃ¬?

**Launch Type = CÃ¡ch báº¡n cung cáº¥p "thá»£ lÃ m bÃ¡nh" cho ECS**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ECS CLUSTER                                  â”‚
â”‚                     (Manager/Orchestrator)                           â”‚
â”‚                                                                       â”‚
â”‚                              â”‚                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚          â–¼                                       â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  EC2 LAUNCH TYPE  â”‚                â”‚ FARGATE LAUNCH TYPEâ”‚         â”‚
â”‚  â”‚                   â”‚                â”‚                   â”‚         â”‚
â”‚  â”‚  Báº¡n thuÃª EC2     â”‚                â”‚  AWS cung cáº¥p     â”‚         â”‚
â”‚  â”‚  instances vÃ      â”‚                â”‚  compute áº©n danh  â”‚         â”‚
â”‚  â”‚  Ä‘Äƒng kÃ½ vá»›i ECS  â”‚                â”‚  tá»± Ä‘á»™ng          â”‚         â”‚
â”‚  â”‚                   â”‚                â”‚                   â”‚         â”‚
â”‚  â”‚  ğŸ  ThuÃª nhÃ       â”‚                â”‚  ğŸ¨ á» khÃ¡ch sáº¡n   â”‚         â”‚
â”‚  â”‚  (tá»± lo má»i thá»©)  â”‚                â”‚  (há» lo táº¥t cáº£)   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| | EC2 Launch Type | Fargate Launch Type |
|--|-----------------|---------------------|
| **Ai cung cáº¥p mÃ¡y?** | Báº¡n táº¡o EC2 instances | AWS tá»± Ä‘á»™ng cung cáº¥p |
| **Báº¡n tháº¥y servers?** | âœ… CÃ³, SSH Ä‘Æ°á»£c | âŒ KhÃ´ng tháº¥y, serverless |
| **VÃ­ von** | ThuÃª nhÃ , tá»± quáº£n lÃ½ | á» khÃ¡ch sáº¡n, há» lo háº¿t |

### So sÃ¡nh tá»•ng quan

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           EC2 LAUNCH TYPE             â”‚  â”‚         FARGATE LAUNCH TYPE           â”‚
â”‚         "ThuÃª nhÃ  riÃªng"              â”‚  â”‚          "á» khÃ¡ch sáº¡n"                â”‚
â”‚                                        â”‚  â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Báº N QUáº¢N LÃ                â”‚   â”‚  â”‚      AWS QUáº¢N LÃ                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ EC2 Instances            â”‚  â”‚   â”‚  â”‚  â”‚ Compute Resources        â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ - Provisioning           â”‚  â”‚   â”‚  â”‚  â”‚ (Serverless containers)  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ - Scaling                â”‚  â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚  â”‚ - Patching               â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”‚  â”‚ - AMI updates            â”‚  â”‚   â”‚                                        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚      Báº N QUáº¢N LÃ                â”‚   â”‚
â”‚                                        â”‚  â”‚  - Task Definitions              â”‚   â”‚
â”‚  Báº¡n: Tráº£ tiá»n EC2 + quáº£n lÃ½ servers  â”‚  â”‚  - Container images              â”‚   â”‚
â”‚                                        â”‚  â”‚  - Application code              â”‚   â”‚
â”‚                                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### So sÃ¡nh chi tiáº¿t

| TiÃªu chÃ­ | EC2 Launch Type | Fargate Launch Type |
|----------|-----------------|---------------------|
| **Quáº£n lÃ½ server** | Báº¡n quáº£n lÃ½ EC2 | AWS quáº£n lÃ½ |
| **Pricing** | Tráº£ tiá»n EC2 instances | Tráº£ theo vCPU + Memory sá»­ dá»¥ng |
| **Scaling** | Pháº£i scale EC2 + Tasks | Chá»‰ scale Tasks |
| **Control** | Full control (SSH, AMI) | Ãt control hÆ¡n |
| **Patching** | Báº¡n patch OS | AWS lo |
| **GPU support** | âœ… CÃ³ | âŒ KhÃ´ng |
| **Persistent storage** | âœ… EBS volumes | âš ï¸ Ephemeral (cÃ³ EFS) |
| **Startup time** | Nhanh hÆ¡n (EC2 sáºµn) | Cháº­m hÆ¡n 1-2 phÃºt |
| **Use case** | Workloads á»•n Ä‘á»‹nh, GPU | Variable workloads, dev/test |

### Khi nÃ o dÃ¹ng EC2 vs Fargate?

| Sá»­ dá»¥ng EC2 khi | Sá»­ dá»¥ng Fargate khi |
|-----------------|---------------------|
| Cáº§n GPU/special hardware | KhÃ´ng muá»‘n quáº£n lÃ½ servers |
| Workload á»•n Ä‘á»‹nh, dá»± Ä‘oÃ¡n Ä‘Æ°á»£c | Workload biáº¿n Ä‘á»™ng |
| Cáº§n SSH debug | Startup, MVP, nhanh chÃ³ng |
| CÃ³ Reserved Instances | KhÃ´ng muá»‘n lo capacity |
| Cáº§n táº­n dá»¥ng Spot Instances | Development, testing |

### ğŸ”¥ Khi háº¿t resources thÃ¬ sao?

#### Vá»›i EC2 Launch Type:

```
Báº¡n cÃ³ 2 EC2, má»—i cÃ¡i 4 CPU, 8GB RAM
Äang cháº¡y 8 containers (má»—i cÃ¡i 1 CPU, 2GB)
â†’ Háº¾T CHá»–!

ECS: "TÃ´i cáº§n cháº¡y Container #9"
     â†’ KhÃ´ng cÃ³ EC2 nÃ o cÃ²n resources
     â†’ Container #9 bá»‹ PENDING... mÃ£i mÃ£i âŒ

Giáº£i phÃ¡p: Setup Capacity Provider + Auto Scaling Group
â†’ Tá»± Ä‘á»™ng táº¡o thÃªm EC2 khi cáº§n
â†’ Tá»± Ä‘á»™ng xÃ³a EC2 khi khÃ´ng cáº§n
```

| Tráº¡ng thÃ¡i | KhÃ´ng cÃ³ Auto Scaling | CÃ³ Auto Scaling (Capacity Provider) |
|------------|----------------------|-------------------------------------|
| Háº¿t resources | Task PENDING mÃ£i | Tá»± Ä‘á»™ng táº¡o EC2 má»›i â†’ Task cháº¡y |
| DÆ° resources | Váº«n tráº£ tiá»n EC2 | Tá»± Ä‘á»™ng terminate EC2 thá»«a |

#### Vá»›i Fargate Launch Type:

```
Báº¡n Ä‘ang cháº¡y 8 containers
ECS: "TÃ´i cáº§n cháº¡y Container #9"
AWS Fargate: "OK! TÃ´i tá»± tÃ¬m compute vÃ  cháº¡y ngay!" âœ…

â†’ Container #9 cháº¡y trong 1-2 phÃºt
â†’ KHÃ”NG Cáº¦N lo capacity
â†’ AWS cÃ³ "vÃ´ háº¡n" resources (tá»« gÃ³c nhÃ¬n cá»§a báº¡n)
```

| So sÃ¡nh | EC2 (khÃ´ng Auto Scaling) | EC2 (cÃ³ Auto Scaling) | Fargate |
|---------|--------------------------|----------------------|---------|
| **Háº¿t resources** | âŒ Task PENDING | â³ Chá» EC2 má»›i (3-5 phÃºt) | âœ… Cháº¡y ngay (1-2 phÃºt) |
| **Cáº¥u hÃ¬nh** | KhÃ´ng cáº§n | Pháº£i setup ASG + Capacity Provider | KhÃ´ng cáº§n |
| **Äá»™ phá»©c táº¡p** | Tháº¥p | Cao | Tháº¥p |

---

## ğŸŒ Network Modes

### 4 Network Modes trong ECS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. awsvpc MODE                            â”‚
â”‚         (Recommended cho Fargate vÃ  EC2)                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    VPC                               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚   Task 1   â”‚  â”‚   Task 2   â”‚  â”‚   Task 3   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ ENI: 10.0.1.5â”‚ â”‚ ENI: 10.0.1.6â”‚ â”‚ ENI: 10.0.1.7â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚       â–²              â–²              â–²                â”‚    â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚    â”‚
â”‚  â”‚              Má»—i task cÃ³ ENI riÃªng                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  âœ… Má»—i task cÃ³ Private IP riÃªng                            â”‚
â”‚  âœ… Security Groups á»Ÿ task level                            â”‚
â”‚  âœ… REQUIRED cho Fargate                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. bridge MODE                            â”‚
â”‚              (Default cho EC2 Linux)                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              EC2 Instance (docker0 bridge)           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚ Container 1â”‚  â”‚ Container 2â”‚  â”‚ Container 3â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  Port 8080 â”‚  â”‚  Port 8081 â”‚  â”‚  Port 8082 â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚    â”‚
â”‚  â”‚                   Docker Bridge                       â”‚    â”‚
â”‚  â”‚                        â”‚                              â”‚    â”‚
â”‚  â”‚              EC2 ENI: 10.0.1.5                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  âš ï¸ Containers chia sáº» ENI cá»§a EC2                          â”‚
â”‚  âš ï¸ Dynamic port mapping                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    3. host MODE                              â”‚
â”‚                 (EC2 Linux only)                             â”‚
â”‚                                                              â”‚
â”‚  Container dÃ¹ng trá»±c tiáº¿p network stack cá»§a EC2             â”‚
â”‚  KhÃ´ng cÃ³ port mapping, container port = host port          â”‚
â”‚                                                              â”‚
â”‚  âš ï¸ Chá»‰ 1 task/port/instance                                â”‚
â”‚  âš ï¸ KhÃ´ng cÃ³ network isolation                              â”‚
â”‚  âœ… Performance tá»‘t nháº¥t                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    4. none MODE                              â”‚
â”‚                                                              â”‚
â”‚  Container khÃ´ng cÃ³ external network connectivity           â”‚
â”‚  Chá»‰ cÃ³ loopback interface                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chá»n Network Mode nÃ o?

| Mode | Use Case |
|------|----------|
| **awsvpc** | Máº·c Ä‘á»‹nh cho Fargate, recommended cho EC2 má»›i |
| **bridge** | Legacy EC2, khi cáº§n dynamic port mapping |
| **host** | Maximum performance, single task per port |
| **none** | Batch jobs khÃ´ng cáº§n network |

### ğŸ”‘ Network Mode vs Security Group

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                       â”‚
â”‚   NETWORK MODE = LÃ€M SAO Ä‘á»ƒ container CÃ“ ÄÆ¯á»¢C Ä‘á»‹a chá»‰ máº¡ng?         â”‚
â”‚   (Giá»‘ng nhÆ°: MÃ¡y tÃ­nh Ä‘Æ°á»£c cáº¯m dÃ¢y máº¡ng kiá»ƒu gÃ¬?)                   â”‚
â”‚                                                                       â”‚
â”‚   SECURITY GROUP = AI ÄÆ¯á»¢C PHÃ‰P gá»­i/nháº­n request?                    â”‚
â”‚   (Giá»‘ng nhÆ°: Báº£o vá»‡ cho ai vÃ o, ai khÃ´ng cho vÃ o)                   â”‚
â”‚                                                                       â”‚
â”‚   â†’ Cáº£ 2 lÃ m viá»‡c CÃ™NG NHAU, khÃ´ng thay tháº¿ nhau!                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”Œ awsvpc chi tiáº¿t: EC2 cÃ³ NHIá»€U ENIs

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EC2 INSTANCE                                 â”‚
â”‚                                                                       â”‚
â”‚   EC2 cÃ³ IP chÃ­nh: 10.0.1.100 (Primary ENI - eth0)                  â”‚
â”‚                                                                       â”‚
â”‚   Vá»›i awsvpc, má»—i Task Ä‘Æ°á»£c gáº¯n thÃªm ENI riÃªng!                     â”‚
â”‚                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  Primary ENI (eth0)     â”‚  10.0.1.100  â”‚ EC2 management   â”‚     â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚   â”‚  Task 1 ENI (eth1)      â”‚  10.0.1.5    â”‚ â† Task 1 dÃ¹ng   â”‚     â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚   â”‚  Task 2 ENI (eth2)      â”‚  10.0.1.8    â”‚ â† Task 2 dÃ¹ng   â”‚     â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚   â”‚  Task 3 ENI (eth3)      â”‚  10.0.1.12   â”‚ â† Task 3 dÃ¹ng   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                       â”‚
â”‚   â†’ Má»—i Task cÃ³ "card máº¡ng" riÃªng, IP riÃªng!                        â”‚
â”‚   â†’ Traffic ÄI THáº²NG Ä‘áº¿n Task, KHÃ”NG qua IP chÃ­nh cá»§a EC2!          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸš€ Traffic Ä‘i nhÆ° tháº¿ nÃ o vá»›i awsvpc?

```
     ALB
      â”‚
      â”‚ Request Ä‘áº¿n 10.0.1.5:3000
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EC2 Instance (10.0.1.100) â† KHÃ”NG Ä‘i qua IP nÃ y!                  â”‚
â”‚                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚ Task 1           â”‚ â† Traffic Ä‘i THáº²NG vÃ o ENI cá»§a Task 1        â”‚
â”‚   â”‚ ENI: 10.0.1.5    â”‚                                               â”‚
â”‚   â”‚ Port: 3000       â”‚                                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚ Task 2           â”‚                                               â”‚
â”‚   â”‚ ENI: 10.0.1.8    â”‚                                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”„ Task gá»i Task trÃªn cÃ¹ng EC2

```
Task 1 (10.0.1.5) gá»i Task 2 (10.0.1.8) trÃªn CÃ™NG EC2:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EC2 Instance                                                       â”‚
â”‚                                                                       â”‚
â”‚   Task 1 (10.0.1.5)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  Task 2 (10.0.1.8)       â”‚
â”‚                                                                       â”‚
â”‚   â†’ Traffic Ä‘i qua VPC network layer                                â”‚
â”‚   â†’ KHÃ”NG cáº§n Ä‘i qua EC2's primary IP (10.0.1.100)                  â”‚
â”‚   â†’ Giá»‘ng nhÆ° 2 mÃ¡y tÃ­nh riÃªng biá»‡t trong cÃ¹ng máº¡ng LAN             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ’¡ Táº¡i sao awsvpc + Security Group quan trá»ng?

```
Vá»šI BRIDGE MODE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EC2 cÃ³ 1 Security Group chung cho Táº¤T Cáº¢ containers              â”‚
â”‚   â”œâ”€â”€ Container A (web) - cáº§n port 80                               â”‚
â”‚   â”œâ”€â”€ Container B (admin) - chá»‰ internal                            â”‚
â”‚   â””â”€â”€ â†’ KhÃ´ng thá»ƒ kiá»ƒm soÃ¡t riÃªng tá»«ng container âŒ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Vá»šI AWSVPC MODE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Má»—i Task cÃ³ ENI riÃªng â†’ cÃ³ Security Group riÃªng!                   â”‚
â”‚   â”œâ”€â”€ Task A (web): SG cho phÃ©p port 80 tá»« ALB                      â”‚
â”‚   â”œâ”€â”€ Task B (admin): SG chá»‰ cho phÃ©p tá»« VPN                        â”‚
â”‚   â””â”€â”€ â†’ Kiá»ƒm soÃ¡t riÃªng tá»«ng task âœ…                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### âš ï¸ Giá»›i háº¡n: Sá»‘ ENI trÃªn má»—i EC2

| Instance Type | Max ENIs | Max Tasks (awsvpc) |
|---------------|----------|-------------------|
| t3.micro | 2 | 1 task |
| t3.small | 3 | 2 tasks |
| t3.medium | 3 | 2 tasks |
| m5.large | 3 | 2 tasks |
| m5.xlarge | 4 | 3 tasks |

> ğŸ’¡ **Fargate khÃ´ng cÃ³ váº¥n Ä‘á» nÃ y** - AWS quáº£n lÃ½ compute, khÃ´ng giá»›i háº¡n ENI!

---

## ğŸ”„ ECS Service

### Service lÃ  gÃ¬?

Service Ä‘áº£m báº£o sá»‘ lÆ°á»£ng tasks mong muá»‘n luÃ´n cháº¡y:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ECS SERVICE                             â”‚
â”‚                                                              â”‚
â”‚  Desired Count: 3                                            â”‚
â”‚  Running Count: 3 âœ…                                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Task 1  â”‚  â”‚  Task 2  â”‚  â”‚  Task 3  â”‚                   â”‚
â”‚  â”‚ RUNNING  â”‚  â”‚ RUNNING  â”‚  â”‚ RUNNING  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                              â”‚
â”‚  Náº¿u Task 2 cháº¿t:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Task 1  â”‚  â”‚  Task 2  â”‚  â”‚  Task 4  â”‚ â† Service tá»± táº¡o  â”‚
â”‚  â”‚ RUNNING  â”‚  â”‚  DEAD âŒ â”‚  â”‚ RUNNING  â”‚   task má»›i!       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Scheduler Types

| Type | MÃ´ táº£ |
|------|-------|
| **REPLICA** | Duy trÃ¬ sá»‘ lÆ°á»£ng tasks cá»‘ Ä‘á»‹nh |
| **DAEMON** | Má»™t task trÃªn má»—i container instance (EC2 only) |

### Service Load Balancing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚                   Application Load Balancer                  â”‚
â”‚                          â”‚                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â–¼           â–¼           â–¼                      â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚        â”‚  Task 1  â”‚â”‚  Task 2  â”‚â”‚  Task 3  â”‚                 â”‚
â”‚        â”‚ Port 80  â”‚â”‚ Port 80  â”‚â”‚ Port 80  â”‚                 â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                              â”‚
â”‚  âœ… Health checks tá»± Ä‘á»™ng                                   â”‚
â”‚  âœ… Deregister unhealthy tasks                              â”‚
â”‚  âœ… Session stickiness (náº¿u cáº§n)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ”„ ECS tá»± Ä‘á»™ng quáº£n lÃ½ Load Balancer:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ALB + ECS INTEGRATION                             â”‚
â”‚                                                                       â”‚
â”‚   ALB                    Target Group: user-service-tg               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚             â”‚       â”‚  Targets (ECS tá»± Ä‘á»™ng cáº­p nháº­t):        â”‚ â”‚
â”‚   â”‚  Listener   â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”œâ”€â”€ 10.0.1.5:3000 (Task 1) âœ… healthy  â”‚ â”‚
â”‚   â”‚  :80        â”‚       â”‚  â”œâ”€â”€ 10.0.2.8:3000 (Task 2) âœ… healthy  â”‚ â”‚
â”‚   â”‚             â”‚       â”‚  â””â”€â”€ 10.0.1.12:3000 (Task 3) âœ… healthy â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚   ğŸ”„ Khi scale up (thÃªm Task 4):                                     â”‚
â”‚   - ECS tá»± Ä‘á»™ng Ä‘Äƒng kÃ½ Task 4 vÃ o Target Group                     â”‚
â”‚   - ALB báº¯t Ä‘áº§u gá»­i traffic Ä‘áº¿n Task 4                              â”‚
â”‚                                                                       â”‚
â”‚   ğŸ”„ Khi Task 2 cháº¿t:                                                â”‚
â”‚   - Health check fail â†’ ALB ngá»«ng gá»­i traffic                       â”‚
â”‚   - ECS há»§y Ä‘Äƒng kÃ½ Task 2 khá»i Target Group                        â”‚
â”‚   - ECS táº¡o Task má»›i thay tháº¿                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Cáº¥u hÃ¬nh Service vá»›i Load Balancer:

```json
{
  "serviceName": "user-service",
  "taskDefinition": "user-service:15",
  "desiredCount": 3,
  "loadBalancers": [
    {
      "targetGroupArn": "arn:aws:elasticloadbalancing:...:targetgroup/user-tg/xxx",
      "containerName": "user-api",
      "containerPort": 3000
    }
  ],
  "healthCheckGracePeriodSeconds": 60
}
```

> **LÆ°u Ã½**: `healthCheckGracePeriodSeconds` cho phÃ©p task thá»i gian khá»Ÿi Ä‘á»™ng trÆ°á»›c khi health check báº¯t Ä‘áº§u.

### Deployment Strategies

| Strategy | MÃ´ táº£ | Use case |
|----------|-------|----------|
| **Rolling Update** | Thay tháº¿ tasks dáº§n dáº§n | Default, zero-downtime |
| **Blue/Green** | Chuyá»ƒn traffic giá»¯a 2 environments | Production, rollback nhanh |

#### Rolling Update Parameters

```
minimumHealthyPercent: 50   â† Ãt nháº¥t 50% tasks pháº£i healthy
maximumPercent: 200         â† CÃ³ thá»ƒ cháº¡y tá»‘i Ä‘a 200% tasks
```

```
Desired: 4 tasks, min: 50%, max: 200%

Step 1: Äang cháº¡y 4 tasks (v1)
Step 2: Táº¡o thÃªm 4 tasks (v2) â†’ 8 tasks (200%)
Step 3: Stop 4 tasks v1
Step 4: CÃ²n 4 tasks v2 âœ…
```

### ğŸ¢ High Availability & Multi-AZ

ECS há»— trá»£ **High Availability** báº±ng cÃ¡ch spread tasks qua nhiá»u AZs vÃ  EC2 instances:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              VPC                                     â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Availability Zone A     â”‚   â”‚     Availability Zone B     â”‚  â”‚
â”‚  â”‚                              â”‚   â”‚                              â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚   EC2 Instance #1    â”‚  â”‚   â”‚   â”‚   EC2 Instance #2    â”‚  â”‚  â”‚
â”‚  â”‚   â”‚                      â”‚  â”‚   â”‚   â”‚                      â”‚  â”‚  â”‚
â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”‚  â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚   â”‚   â”‚Task 1â”‚ â”‚Task 2â”‚ â”‚  â”‚   â”‚   â”‚   â”‚Task 3â”‚ â”‚Task 4â”‚ â”‚  â”‚  â”‚
â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                              â”‚   â”‚                              â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚   EC2 Instance #3    â”‚  â”‚   â”‚   â”‚   EC2 Instance #4    â”‚  â”‚  â”‚
â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”           â”‚  â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚
â”‚  â”‚   â”‚   â”‚Task 5â”‚           â”‚  â”‚   â”‚   â”‚   â”‚Task 6â”‚ â”‚Task 7â”‚ â”‚  â”‚  â”‚
â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚   SERVICE: user-service (desired count: 7)                           â”‚
â”‚   â†’ ECS tá»± Ä‘á»™ng SPREAD tasks across AZs vÃ  EC2 instances            â”‚
â”‚                                                                       â”‚
â”‚   Náº¿u AZ-A cháº¿t toÃ n bá»™:                                             â”‚
â”‚   â†’ Tasks 1, 2, 5 bá»‹ máº¥t                                             â”‚
â”‚   â†’ Tasks 3, 4, 6, 7 váº«n cháº¡y âœ… (HA)                                â”‚
â”‚   â†’ ECS tá»± Ä‘á»™ng táº¡o tasks má»›i á»Ÿ AZ-B                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Placement Strategies (Chiáº¿n lÆ°á»£c Ä‘áº·t Tasks)

ECS cÃ³ cÃ¡c strategies Ä‘á»ƒ quyáº¿t Ä‘á»‹nh Ä‘áº·t task á»Ÿ Ä‘Ã¢u:

| Strategy | MÃ´ táº£ | Use case |
|----------|-------|----------|
| **SPREAD** | PhÃ¢n bá»• Ä‘á»u theo AZ hoáº·c instance | **HA (khuyáº¿n nghá»‹)** |
| **BINPACK** | Nhá»“i Ä‘áº§y 1 instance trÆ°á»›c | Tiáº¿t kiá»‡m chi phÃ­ |
| **RANDOM** | Random | Testing |

```json
// Service definition vá»›i SPREAD strategy
{
  "serviceName": "user-service",
  "placementStrategy": [
    {
      "type": "spread",
      "field": "attribute:ecs.availability-zone"
    },
    {
      "type": "spread",
      "field": "instanceId"
    }
  ]
}
```

#### Cáº¥u hÃ¬nh Multi-AZ vá»›i Fargate:

```json
// Fargate Service - chá»‰ cáº§n chá»‰ Ä‘á»‹nh subnets á»Ÿ nhiá»u AZs
{
  "networkConfiguration": {
    "awsvpcConfiguration": {
      "subnets": [
        "subnet-aza-1",   // Private subnet AZ-A
        "subnet-azb-1"    // Private subnet AZ-B
      ],
      "securityGroups": ["sg-xxx"],
      "assignPublicIp": "DISABLED"
    }
  }
}
```

â†’ Fargate tá»± Ä‘á»™ng spread tasks giá»¯a cÃ¡c AZs!

---

## ğŸ“¦ Container Images & ECR

### Amazon ECR (Elastic Container Registry)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Amazon ECR                                â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Repository: my-app                                  â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚  Images:                                             â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ my-app:latest     (123 MB)                     â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ my-app:v1.2.3     (123 MB)                     â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ my-app:v1.2.2     (120 MB)                     â”‚    â”‚
â”‚  â”‚  â””â”€â”€ my-app:dev        (125 MB)                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Features:                                                   â”‚
â”‚  âœ… Private registry                                        â”‚
â”‚  âœ… Image scanning (vulnerabilities)                        â”‚
â”‚  âœ… Image lifecycle policies                                â”‚
â”‚  âœ… Cross-region replication                                â”‚
â”‚  âœ… IAM integration                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Push Image to ECR

```bash
# 1. Authenticate Docker to ECR
aws ecr get-login-password --region us-east-1 | \
  docker login --username AWS --password-stdin \
  123456789012.dkr.ecr.us-east-1.amazonaws.com

# 2. Build image
docker build -t my-app .

# 3. Tag image
docker tag my-app:latest \
  123456789012.dkr.ecr.us-east-1.amazonaws.com/my-app:latest

# 4. Push to ECR
docker push 123456789012.dkr.ecr.us-east-1.amazonaws.com/my-app:latest
```

---

## ğŸ” IAM Roles trong ECS

### 2 loáº¡i IAM Roles quan trá»ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ECS IAM ROLES                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Task Execution Role                               â”‚    â”‚
â”‚  â”‚    (ecsTaskExecutionRole)                            â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚    ECS Agent dÃ¹ng Ä‘á»ƒ:                                â”‚    â”‚
â”‚  â”‚    - Pull images tá»« ECR                              â”‚    â”‚
â”‚  â”‚    - Push logs to CloudWatch                         â”‚    â”‚
â”‚  â”‚    - Get secrets tá»« Secrets Manager                  â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚    Policy: AmazonECSTaskExecutionRolePolicy          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 2. Task Role                                         â”‚    â”‚
â”‚  â”‚    (Application permissions)                         â”‚    â”‚
â”‚  â”‚                                                      â”‚    â”‚
â”‚  â”‚    Container app dÃ¹ng Ä‘á»ƒ:                            â”‚    â”‚
â”‚  â”‚    - Access S3 buckets                               â”‚    â”‚
â”‚  â”‚    - Query DynamoDB                                  â”‚    â”‚
â”‚  â”‚    - Send messages to SQS                            â”‚    â”‚
â”‚  â”‚    - Báº¥t ká»³ AWS service nÃ o app cáº§n                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### VÃ­ dá»¥ Task Role Policy

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::my-bucket/*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:GetItem",
        "dynamodb:PutItem"
      ],
      "Resource": "arn:aws:dynamodb:*:*:table/my-table"
    }
  ]
}
```

---

## ğŸ“Š Auto Scaling

### ECS Service Auto Scaling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ECS SERVICE AUTO SCALING                    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         CloudWatch Alarm: CPU > 70%                  â”‚    â”‚
â”‚  â”‚                    â”‚                                 â”‚    â”‚
â”‚  â”‚                    â–¼                                 â”‚    â”‚
â”‚  â”‚         Application Auto Scaling                     â”‚    â”‚
â”‚  â”‚                    â”‚                                 â”‚    â”‚
â”‚  â”‚                    â–¼                                 â”‚    â”‚
â”‚  â”‚         Scale Out: 3 tasks â†’ 6 tasks                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  Scaling Policies:                                           â”‚
â”‚  â”œâ”€â”€ Target Tracking: Maintain CPU at 70%                   â”‚
â”‚  â”œâ”€â”€ Step Scaling: Add 2 tasks if CPU > 80%                 â”‚
â”‚  â””â”€â”€ Scheduled Scaling: Scale up at 9 AM                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scaling Metrics phá»• biáº¿n

| Metric | MÃ´ táº£ |
|--------|-------|
| **ECSServiceAverageCPUUtilization** | CPU trung bÃ¬nh cá»§a service |
| **ECSServiceAverageMemoryUtilization** | Memory trung bÃ¬nh |
| **ALBRequestCountPerTarget** | Requests per target tá»« ALB |
| **Custom metrics** | SQS queue depth, etc. |

### EC2 Auto Scaling (cho EC2 Launch Type)

```
Fargate: Chá»‰ cáº§n scale Service (tasks)

EC2 Launch Type: Pháº£i scale Cáº¢ HAI:
  1. EC2 Auto Scaling Group (instances)
  2. ECS Service Auto Scaling (tasks)

ECS Cluster Capacity Providers giÃºp tá»± Ä‘á»™ng hoÃ¡!
```

---

## ğŸ”§ Secrets & Configuration

### CÃ¡ch truyá»n secrets vÃ o containers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECRETS MANAGEMENT                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ AWS Secrets     â”‚     â”‚ AWS Systems Manager         â”‚   â”‚
â”‚  â”‚ Manager         â”‚     â”‚ Parameter Store             â”‚   â”‚
â”‚  â”‚                 â”‚     â”‚                             â”‚   â”‚
â”‚  â”‚ DB passwords    â”‚     â”‚ API_ENDPOINT                â”‚   â”‚
â”‚  â”‚ API keys        â”‚     â”‚ FEATURE_FLAG                â”‚   â”‚
â”‚  â”‚ Certificates    â”‚     â”‚ CONFIG_VALUES               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                          â”‚                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                        â–¼                                    â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â”‚     ECS Task Definition      â”‚                   â”‚
â”‚           â”‚    (secrets reference)       â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                        â”‚                                    â”‚
â”‚                        â–¼                                    â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚           â”‚        Container            â”‚                   â”‚
â”‚           â”‚   env: DB_PASSWORD=***      â”‚                   â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Task Definition vá»›i Secrets

```json
{
  "containerDefinitions": [
    {
      "name": "my-app",
      "image": "my-app:latest",
      "secrets": [
        {
          "name": "DB_PASSWORD",
          "valueFrom": "arn:aws:secretsmanager:us-east-1:123456789012:secret:my-db-password"
        },
        {
          "name": "API_KEY",
          "valueFrom": "arn:aws:ssm:us-east-1:123456789012:parameter/my-api-key"
        }
      ],
      "environment": [
        {
          "name": "APP_ENV",
          "value": "production"
        }
      ]
    }
  ]
}
```

---

## ğŸ“ Logging

### Container Logging vá»›i CloudWatch

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ECS LOGGING                               â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Container    â”‚  stdout  â”‚   CloudWatch Logs      â”‚     â”‚
â”‚  â”‚   (app logs)   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   /ecs/my-service      â”‚     â”‚
â”‚  â”‚                â”‚  stderr  â”‚   â””â”€â”€ task-id/...      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  Log Driver: awslogs                                         â”‚
â”‚                                                              â”‚
â”‚  Task Definition:                                            â”‚
â”‚  {                                                           â”‚
â”‚    "logConfiguration": {                                     â”‚
â”‚      "logDriver": "awslogs",                                 â”‚
â”‚      "options": {                                            â”‚
â”‚        "awslogs-group": "/ecs/my-service",                   â”‚
â”‚        "awslogs-region": "us-east-1",                        â”‚
â”‚        "awslogs-stream-prefix": "ecs"                        â”‚
â”‚      }                                                       â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CÃ¡c Log Drivers khÃ¡c

| Driver | Destination |
|--------|-------------|
| **awslogs** | CloudWatch Logs |
| **splunk** | Splunk |
| **fluentd** | Fluentd |
| **awsfirelens** | Kinesis, S3, Elasticsearch (via Fluent Bit) |

---

## ğŸ’° Pricing: EC2 vs Fargate chi tiáº¿t

### ğŸ’¡ Äiá»ƒm khÃ¡c biá»‡t cá»‘t lÃµi

| | EC2 Launch Type | Fargate Launch Type |
|--|-----------------|---------------------|
| **Tráº£ tiá»n cho** | EC2 instances (dÃ¹ container cháº¡y hay khÃ´ng) | Tá»«ng container (vCPU + Memory) |
| **KhÃ´ng cháº¡y gÃ¬** | Váº«n tráº£ tiá»n EC2! | $0 |
| **VÃ­ von** | ThuÃª nhÃ  thÃ¡ng (tráº£ cáº£ thÃ¡ng) | ThuÃª phÃ²ng theo giá» |

### ğŸ“Œ EC2 Launch Type - CÃ¡ch tÃ­nh

```
Báº¡n thuÃª 2 x t3.medium ($0.0416/giá» má»—i cÃ¡i)
Chi phÃ­ cá»‘ Ä‘á»‹nh: $0.0832/giá» Ã— 24 Ã— 30 = ~$60/thÃ¡ng

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EC2 #1                    EC2 #2                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Container A    â”‚        â”‚ [TRá»NG]        â”‚ â† Váº«n tráº£ tiá»n! â”‚
â”‚  â”‚ [TRá»NG]        â”‚        â”‚ [TRá»NG]        â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                               â”‚
â”‚  DÃ¹ chá»‰ cháº¡y 1 container hay 0 container â†’ váº«n ~$60/thÃ¡ng   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“Œ Fargate Launch Type - CÃ¡ch tÃ­nh

```
GiÃ¡ (US East - tham kháº£o):
- vCPU: $0.04048 / vCPU / giá»
- Memory: $0.004445 / GB / giá»

VÃ­ dá»¥ 1 container (0.5 vCPU, 1GB RAM):
- vCPU:   0.5 Ã— $0.04048 = $0.02024/giá»
- Memory: 1 Ã— $0.004445 = $0.00445/giá»
- Tá»•ng:   $0.0247/giá»

Cháº¡y 24/7 trong 1 thÃ¡ng: $0.0247 Ã— 24 Ã— 30 = ~$17.8/container

âœ… KhÃ´ng cháº¡y = $0!
```

### ğŸ“Š So sÃ¡nh thá»±c táº¿: 3 containers (0.5 vCPU, 1GB má»—i cÃ¡i)

| Thá»i gian cháº¡y | EC2 (2 x t3.medium) | Fargate | Ai ráº» hÆ¡n? |
|----------------|---------------------|---------|------------|
| **24/7 cáº£ thÃ¡ng** | ~$60 | ~$53 | Fargate âœ… |
| **12h/ngÃ y** | ~$60 | ~$26 | Fargate âœ… |
| **8h/ngÃ y (giá» lÃ m viá»‡c)** | ~$60 | ~$18 | Fargate âœ… |
| **4h/ngÃ y** | ~$60 | ~$9 | Fargate âœ… |
| **Táº¯t háº¿t** | ~$60 | **$0** | Fargate âœ… |

> âš ï¸ **LÆ°u Ã½**: VÃ­ dá»¥ trÃªn EC2 chÆ°a tá»‘i Æ°u. Vá»›i Reserved Instances hoáº·c Spot, EC2 sáº½ ráº» hÆ¡n nhiá»u!

### ğŸ¯ Khi nÃ o EC2 ráº» hÆ¡n?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ÄIá»‚M HÃ’A Vá»N (~65% utilization)                 â”‚
â”‚                                                                     â”‚
â”‚   Cost â”‚                                                           â”‚
â”‚    â–²   â”‚          Fargate                                          â”‚
â”‚        â”‚         /                                                  â”‚
â”‚        â”‚        /        EC2 (On-Demand)                           â”‚
â”‚        â”‚       /        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚        â”‚      /                                                     â”‚
â”‚        â”‚     /     EC2 (Reserved)                                  â”‚
â”‚        â”‚    /     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚        â”‚   /                                                        â”‚
â”‚        â”‚  /                                                         â”‚
â”‚        â”‚ /                                                          â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Utilization   â”‚
â”‚          0%        50%       65%       80%      100%               â”‚
â”‚                              â–²                                      â”‚
â”‚                    Äiá»ƒm hÃ²a vá»‘n                                    â”‚
â”‚                                                                     â”‚
â”‚   Utilization < 65%: Fargate ráº» hÆ¡n                                â”‚
â”‚   Utilization > 65%: EC2 ráº» hÆ¡n                                    â”‚
â”‚   CÃ³ Reserved/Spot: EC2 ráº» hÆ¡n sá»›m hÆ¡n                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ’µ CÃ¡c cÃ¡ch tiáº¿t kiá»‡m

| PhÆ°Æ¡ng phÃ¡p | EC2 | Fargate | Tiáº¿t kiá»‡m |
|-------------|-----|---------|-----------|
| **On-Demand** | âœ… | âœ… | 0% (baseline) |
| **Reserved Instances** | âœ… | âŒ | 30-60% |
| **Spot Instances** | âœ… | âœ… (Fargate Spot) | 50-70% |
| **Savings Plans** | âœ… | âœ… | 30-50% |

#### ğŸŸï¸ Reserved Instances (RI) lÃ  gÃ¬?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESERVED INSTANCES                                â”‚
â”‚                                                                       â”‚
â”‚   Báº¡n: "TÃ´i cam káº¿t dÃ¹ng t3.medium 1 nÄƒm"                           â”‚
â”‚   AWS: "OK! Giáº£m 40% giÃ¡!"                                          â”‚
â”‚                                                                       â”‚
â”‚   VÃ­ dá»¥:                                                             â”‚
â”‚   On-Demand: $0.0416/giá» Ã— 8760 giá» = $364/nÄƒm                      â”‚
â”‚   Reserved:  $0.025/giá»  Ã— 8760 giá» = $219/nÄƒm â† TIáº¾T KIá»†M $145!   â”‚
â”‚                                                                       â”‚
â”‚   CÃ¡c option:                                                        â”‚
â”‚   â”œâ”€â”€ 1 nÄƒm: Giáº£m ~30-40%                                           â”‚
â”‚   â”œâ”€â”€ 3 nÄƒm: Giáº£m ~50-60%                                           â”‚
â”‚   â”œâ”€â”€ Tráº£ trÆ°á»›c toÃ n bá»™: Giáº£m thÃªm                                  â”‚
â”‚   â””â”€â”€ Tráº£ hÃ ng thÃ¡ng: Ãt giáº£m hÆ¡n                                   â”‚
â”‚                                                                       â”‚
â”‚   âš ï¸ Rá»§i ro: Cam káº¿t rá»“i khÃ´ng dÃ¹ng â†’ váº«n pháº£i tráº£!                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| VÃ­ von | Reserved Instances |
|--------|-------------------|
| ğŸš• On-Demand | Äi taxi, báº­t Ä‘á»“ng há»“ |
| ğŸš— Reserved | ThuÃª xe thÃ¡ng/nÄƒm - cam káº¿t, ráº» hÆ¡n |

#### âš¡ Spot Instances lÃ  gÃ¬?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SPOT INSTANCES                                  â”‚
â”‚                                                                       â”‚
â”‚   AWS cÃ³ 1000 mÃ¡y EC2, Ä‘ang dÃ¹ng 700 mÃ¡y                            â”‚
â”‚   â†’ 300 mÃ¡y Ä‘ang ráº£nh (idle)                                        â”‚
â”‚   â†’ AWS bÃ¡n ráº» nhá»¯ng mÃ¡y nÃ y! (giáº£m 50-90%)                         â”‚
â”‚                                                                       â”‚
â”‚   On-Demand: $0.10/giá»                                               â”‚
â”‚   Spot:      $0.03/giá»  â† GIáº¢M 70%!                                 â”‚
â”‚                                                                       â”‚
â”‚   âš ï¸ NHÆ¯NG: Khi AWS cáº§n mÃ¡y, báº¡n bá»‹ "Ä‘uá»•i" vá»›i 2 phÃºt cáº£nh bÃ¡o!     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| VÃ­ von | Spot Instances |
|--------|----------------|
| âœˆï¸ VÃ© mÃ¡y bay giá» chÃ³t | Ráº» nhÆ°ng cÃ³ thá»ƒ bá»‹ há»§y |

#### ğŸš¨ Khi AWS láº¥y láº¡i Spot Instance thÃ¬ sao?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SPOT INTERRUPTION FLOW                            â”‚
â”‚                                                                       â”‚
â”‚   AWS: "TÃ´i cáº§n láº¥y láº¡i mÃ¡y nÃ y trong 2 phÃºt!"                       â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼ (2 phÃºt warning)                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  1. ECS nháº­n Ä‘Æ°á»£c thÃ´ng bÃ¡o                                  â”‚   â”‚
â”‚   â”‚  2. ECS Ä‘Ã¡nh dáº¥u instance DRAINING (khÃ´ng nháº­n task má»›i)    â”‚   â”‚
â”‚   â”‚  3. ALB ngá»«ng gá»­i traffic Ä‘áº¿n tasks trÃªn instance nÃ y       â”‚   â”‚
â”‚   â”‚  4. Tasks Ä‘Æ°á»£c graceful shutdown (SIGTERM)                  â”‚   â”‚
â”‚   â”‚  5. Instance bá»‹ terminate                                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚                                                           â”‚
â”‚          â–¼                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  6. ECS tháº¥y: "Desired = 3, Running = 2" â†’ thiáº¿u 1 task!    â”‚   â”‚
â”‚   â”‚  7. ECS tá»± Ä‘á»™ng khá»Ÿi Ä‘á»™ng Task má»›i á»Ÿ instance khÃ¡c!         â”‚   â”‚
â”‚   â”‚  8. Running = 3 láº¡i nhÆ° cÅ© âœ…                                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚   â†’ User KHÃ”NG Bá»Š áº¢NH HÆ¯á»NG (náº¿u setup Ä‘Ãºng)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Best Practices vá»›i Spot:**

| Practice | Táº¡i sao? |
|----------|----------|
| Cháº¡y **nhiá»u tasks** (Ã­t nháº¥t 2) | Náº¿u 1 bá»‹ Ä‘uá»•i, cÃ²n task khÃ¡c phá»¥c vá»¥ |
| **Spread across AZs** | Spot bá»‹ Ä‘uá»•i theo AZ, spread ra giáº£m risk |
| **Mix 70% Spot + 30% On-Demand** | LuÃ´n cÃ³ On-Demand backup |
| **Handle SIGTERM gracefully** | App xá»­ lÃ½ shutdown Ä‘á»ƒ khÃ´ng máº¥t data |

**Khi nÃ o KHÃ”NG nÃªn dÃ¹ng Spot?**

| âŒ KhÃ´ng dÃ¹ng Spot | LÃ½ do |
|-------------------|-------|
| Database (RDS, self-hosted) | Data cÃ³ thá»ƒ máº¥t/corrupt |
| Single instance app | Bá»‹ Ä‘uá»•i = downtime |
| Long-running jobs khÃ´ng checkpoint | Máº¥t háº¿t progress |

### ğŸ“‹ TÃ³m táº¯t: Chá»n loáº¡i nÃ o?

| TÃ¬nh huá»‘ng | Recommendation |
|------------|----------------|
| Dev/Test, cháº¡y vÃ i giá»/ngÃ y | **Fargate** (tráº£ theo giá») |
| Startup, MVP | **Fargate** (Ä‘Æ¡n giáº£n, khÃ´ng lo capacity) |
| Production 24/7, workload á»•n Ä‘á»‹nh | **EC2 + Reserved** (ráº» hÆ¡n 40-60%) |
| Workload biáº¿n Ä‘á»™ng (peak hours) | **Fargate** (scale linh hoáº¡t) |
| Cáº§n Spot Ä‘á»ƒ tiáº¿t kiá»‡m | **EC2 Spot** hoáº·c **Fargate Spot** |

---

## ğŸ”„ ECS vs EKS vs Fargate

### So sÃ¡nh cÃ¡c Container Services

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AWS CONTAINER SERVICES                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚    ECS     â”‚  â”‚    EKS     â”‚  â”‚       FARGATE          â”‚    â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚   (Serverless Compute)  â”‚    â”‚
â”‚  â”‚  AWS-native â”‚  â”‚ Kubernetes â”‚  â”‚                        â”‚    â”‚
â”‚  â”‚ orchestratorâ”‚  â”‚  managed   â”‚  â”‚  Works with ECS or EKS â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                  â”‚
â”‚  Fargate = Launch Type, khÃ´ng pháº£i orchestrator                 â”‚
â”‚  CÃ³ thá»ƒ dÃ¹ng Fargate vá»›i cáº£ ECS vÃ  EKS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| TiÃªu chÃ­ | ECS | EKS |
|----------|-----|-----|
| **Learning curve** | Dá»… hÆ¡n | KhÃ³ hÆ¡n |
| **AWS integration** | Native, deep | Qua add-ons |
| **Portability** | AWS only | Multi-cloud |
| **Ecosystem** | Nhá» hÆ¡n | Lá»›n (Kubernetes) |
| **Pricing** | Free control plane | ~$0.10/hour/cluster |
| **Use case** | AWS-focused | Multi-cloud, existing K8s |

---

## ğŸ“ Hands-on Labs

### Lab 1: Táº¡o ECS Cluster vá»›i Fargate

```bash
# Táº¡o cluster
aws ecs create-cluster --cluster-name my-cluster

# Verify
aws ecs list-clusters
```

### Lab 2: Register Task Definition

```json
// task-definition.json
{
  "family": "my-web-app",
  "networkMode": "awsvpc",
  "requiresCompatibilities": ["FARGATE"],
  "cpu": "256",
  "memory": "512",
  "executionRoleArn": "arn:aws:iam::123456789012:role/ecsTaskExecutionRole",
  "containerDefinitions": [
    {
      "name": "nginx",
      "image": "nginx:latest",
      "essential": true,
      "portMappings": [
        {
          "containerPort": 80,
          "protocol": "tcp"
        }
      ],
      "logConfiguration": {
        "logDriver": "awslogs",
        "options": {
          "awslogs-group": "/ecs/my-web-app",
          "awslogs-region": "us-east-1",
          "awslogs-stream-prefix": "ecs"
        }
      }
    }
  ]
}
```

```bash
# Register task definition
aws ecs register-task-definition --cli-input-json file://task-definition.json

# List task definitions
aws ecs list-task-definitions
```

### Lab 3: Táº¡o ECS Service

```bash
# Táº¡o service
aws ecs create-service \
  --cluster my-cluster \
  --service-name my-web-service \
  --task-definition my-web-app:1 \
  --desired-count 2 \
  --launch-type FARGATE \
  --network-configuration "awsvpcConfiguration={subnets=[subnet-xxx,subnet-yyy],securityGroups=[sg-zzz],assignPublicIp=ENABLED}"

# List services
aws ecs list-services --cluster my-cluster

# Describe service
aws ecs describe-services --cluster my-cluster --services my-web-service
```

### Lab 4: Scale Service

```bash
# Scale up
aws ecs update-service \
  --cluster my-cluster \
  --service my-web-service \
  --desired-count 4

# Scale down
aws ecs update-service \
  --cluster my-cluster \
  --service my-web-service \
  --desired-count 1
```

### Lab 5: Deploy má»›i (Rolling Update)

```bash
# Update task definition vá»›i image má»›i
# Sau Ä‘Ã³ force new deployment
aws ecs update-service \
  --cluster my-cluster \
  --service my-web-service \
  --task-definition my-web-app:2 \
  --force-new-deployment
```

---

## ğŸ¯ Best Practices

### 1. Container Best Practices

| Practice | MÃ´ táº£ |
|----------|-------|
| **One process per container** | Má»—i container cháº¡y 1 process chÃ­nh |
| **Small images** | DÃ¹ng alpine/distroless base images |
| **Tag images** | KhÃ´ng dÃ¹ng `:latest` cho production |
| **Health checks** | Äá»‹nh nghÄ©a health check trong task def |
| **Logging** | Log ra stdout/stderr |

### 2. Security Best Practices

| Practice | MÃ´ táº£ |
|----------|-------|
| **Least privilege** | Task roles chá»‰ cÃ³ permissions cáº§n thiáº¿t |
| **Secrets Manager** | KhÃ´ng hardcode secrets |
| **Private ECR** | KhÃ´ng dÃ¹ng public images cho production |
| **VPC endpoints** | Truy cáº­p AWS services qua VPC endpoints |
| **Read-only root** | Readonly filesystem khi cÃ³ thá»ƒ |

### 3. Reliability Best Practices

| Practice | MÃ´ táº£ |
|----------|-------|
| **Multi-AZ** | Distribute tasks across AZs |
| **Health checks** | ALB + Container health checks |
| **Auto Scaling** | Scale based on metrics |
| **Circuit breaker** | Enable deployment circuit breaker |
| **Graceful shutdown** | Handle SIGTERM signals |

### 4. Cost Optimization

| Practice | MÃ´ táº£ |
|----------|-------|
| **Right-sizing** | Chá»n Ä‘Ãºng CPU/Memory |
| **Fargate Spot** | DÃ¹ng cho fault-tolerant workloads |
| **Reserved capacity** | Compute Savings Plans |
| **Turn off dev/test** | Scheduled scaling vá» 0 |

---

## ğŸ” Troubleshooting

### Common Issues

| Issue | NguyÃªn nhÃ¢n | Giáº£i phÃ¡p |
|-------|-------------|-----------|
| **Task stuck in PENDING** | KhÃ´ng Ä‘á»§ resources | Check cluster capacity |
| **Task fails to start** | Image pull failed | Check ECR permissions |
| **Service unstable** | Health check fails | Check health check config |
| **Container keeps restarting** | App crash | Check container logs |
| **Cannot connect** | Security group/network | Check SG rules, VPC config |

### Debug Commands

```bash
# Check task status
aws ecs describe-tasks \
  --cluster my-cluster \
  --tasks arn:aws:ecs:...:task/...

# View stopped task reason
aws ecs describe-tasks \
  --cluster my-cluster \
  --tasks arn:aws:ecs:...:task/... \
  --query 'tasks[0].stoppedReason'

# View container logs
aws logs get-log-events \
  --log-group-name /ecs/my-service \
  --log-stream-name ecs/container-name/task-id

# List services with details
aws ecs describe-services \
  --cluster my-cluster \
  --services my-service

# Check events
aws ecs describe-services \
  --cluster my-cluster \
  --services my-service \
  --query 'services[0].events[:10]'
```

---

## ğŸ›’ VÃ­ dá»¥: Thiáº¿t káº¿ Microservices E-commerce

### CÃ¡c Microservices

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     E-COMMERCE PLATFORM                              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Frontend   â”‚  â”‚   User API   â”‚  â”‚  Product API â”‚               â”‚
â”‚  â”‚   (React)    â”‚  â”‚   (Node.js)  â”‚  â”‚   (Python)   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Cart API   â”‚  â”‚  Order API   â”‚  â”‚ Payment API  â”‚               â”‚
â”‚  â”‚   (Node.js)  â”‚  â”‚    (Java)    â”‚  â”‚    (Go)      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚ Notification â”‚  â”‚   Search     â”‚                                 â”‚
â”‚  â”‚   (Python)   â”‚  â”‚(Elasticsearch)â”‚                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Thiáº¿t káº¿ trÃªn ECS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ECS CLUSTER: prod-cluster                     â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                     ALB (Application Load Balancer)            â”‚ â”‚
â”‚  â”‚    api.myshop.com                                               â”‚ â”‚
â”‚  â”‚    /users/*  â†’ User Service                                    â”‚ â”‚
â”‚  â”‚    /products/* â†’ Product Service                               â”‚ â”‚
â”‚  â”‚    /orders/* â†’ Order Service                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚          â–¼                   â–¼                   â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ SERVICE: user    â”‚ â”‚SERVICE: product  â”‚ â”‚ SERVICE: order   â”‚    â”‚
â”‚  â”‚ Desired: 2 tasks â”‚ â”‚ Desired: 3 tasks â”‚ â”‚ Desired: 2 tasks â”‚    â”‚
â”‚  â”‚                  â”‚ â”‚                  â”‚ â”‚                  â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”â”‚ â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚ â”‚Taskâ”‚ â”‚Taskâ”‚   â”‚ â”‚ â”‚Taskâ”‚â”‚Taskâ”‚â”‚Taskâ”‚â”‚ â”‚ â”‚Taskâ”‚ â”‚Taskâ”‚   â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜   â”‚ â”‚ â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”˜â”‚ â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                       â”‚
â”‚            â†“                    â†“                 â†“                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    DATABASES                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚ RDS     â”‚    â”‚ RDS     â”‚    â”‚ RDS     â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚ (users) â”‚    â”‚(products)â”‚   â”‚ (orders)â”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chi tiáº¿t tá»«ng Service

| Service | Tasks | CPU | RAM | Launch Type | Auto Scale |
|---------|-------|-----|-----|-------------|------------|
| **user-service** | 2 | 0.5 vCPU | 1 GB | Fargate | 2-10 |
| **product-service** | 3 | 1 vCPU | 2 GB | Fargate | 3-15 |
| **order-api** | 2 | 1 vCPU | 2 GB | Fargate | 2-8 |
| **order-worker** | 1 | 0.5 vCPU | 1 GB | Fargate | 1-5 |
| **cart-service** | 2 | 0.5 vCPU | 1 GB | Fargate | 2-10 |
| **payment-service** | 2 | 0.5 vCPU | 1 GB | Fargate | 2-6 |
| **notification** | 1 | 0.25 vCPU | 512 MB | Fargate | 1-3 |

### Networking

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              VPC                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    PUBLIC SUBNETS                            â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚    â”‚
â”‚  â”‚   â”‚     ALB     â”‚  â† Internet facing                        â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   PRIVATE SUBNETS                            â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚    â”‚
â”‚  â”‚  â”‚ User    â”‚ â”‚ Product â”‚ â”‚ Order   â”‚ â”‚ Payment â”‚           â”‚    â”‚
â”‚  â”‚  â”‚ Tasks   â”‚ â”‚ Tasks   â”‚ â”‚ Tasks   â”‚ â”‚ Tasks   â”‚           â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚    â”‚
â”‚  â”‚  (Each task has its own ENI - awsvpc mode)                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   DATABASE SUBNETS                           â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚    â”‚
â”‚  â”‚   â”‚   RDS   â”‚ â”‚   RDS   â”‚ â”‚ElastiCacheâ”‚                     â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CI/CD Deployment Flow

```
Developer push code
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GitHub      â”‚
â”‚   Actions     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Build & Push image
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ECR       â”‚
â”‚  (Container   â”‚
â”‚   Registry)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Update Task Definition
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ECS       â”‚â”€â”€â–º Rolling deployment
â”‚   Service     â”‚    (tá»« tá»« replace tasks)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š TÃ³m táº¯t

### Khi nÃ o dÃ¹ng ECS?

| Use Case | Recommendation |
|----------|----------------|
| Má»›i báº¯t Ä‘áº§u vá»›i containers | âœ… ECS + Fargate |
| Team quen AWS | âœ… ECS |
| ÄÃ£ cÃ³ Kubernetes experience | â†’ EKS |
| Multi-cloud strategy | â†’ EKS |
| Serverless containers | âœ… ECS + Fargate |
| GPU workloads | ECS + EC2 |

### Quick Reference

```
ECS = Container Orchestrator (AWS native)
Fargate = Serverless compute for containers
ECR = Container image registry

Cluster â†’ Service â†’ Task â†’ Container

Launch Types:
  EC2 = You manage servers
  Fargate = AWS manages servers

Task Definition = Blueprint for containers
Service = Ensures desired tasks running
```
