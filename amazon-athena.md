# Amazon Athena

## Má»¥c lá»¥c
- [Giá»›i thiá»‡u](#giá»›i-thiá»‡u)
- [Kiáº¿n trÃºc](#kiáº¿n-trÃºc)
- [CÃ¡ch hoáº¡t Ä‘á»™ng](#cÃ¡ch-hoáº¡t-Ä‘á»™ng)
- [Data Formats](#data-formats)
- [Partitioning](#partitioning)
- [TÃ­ch há»£p vá»›i cÃ¡c dá»‹ch vá»¥ AWS](#tÃ­ch-há»£p-vá»›i-cÃ¡c-dá»‹ch-vá»¥-aws)
- [Federated Query](#federated-query)
- [Workgroups](#workgroups)
- [Pricing](#pricing)
- [Performance Optimization](#performance-optimization)
- [Use Cases](#use-cases)
- [Best Practices](#best-practices)
- [Exam Tips](#exam-tips)

---

## Giá»›i thiá»‡u

**Amazon Athena** lÃ  dá»‹ch vá»¥ **serverless interactive query** cho phÃ©p phÃ¢n tÃ­ch dá»¯ liá»‡u trá»±c tiáº¿p trong **Amazon S3** báº±ng **SQL chuáº©n**.

### Äáº·c Ä‘iá»ƒm chÃ­nh

| Äáº·c Ä‘iá»ƒm | MÃ´ táº£ |
|----------|-------|
| **Serverless** | KhÃ´ng cáº§n quáº£n lÃ½ infrastructure |
| **Pay-per-query** | Chá»‰ tráº£ tiá»n cho data scanned |
| **Standard SQL** | DÃ¹ng Presto/Trino engine |
| **No ETL required** | Query trá»±c tiáº¿p trÃªn S3 |
| **Fast** | Káº¿t quáº£ trong vÃ i giÃ¢y |

### Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KHÃ”NG cÃ³ Athena                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   S3 Bucket (1TB logs)                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚
â”‚   â”‚ access.log      â”‚     âŒ Pháº£i download vá» local                         â”‚
â”‚   â”‚ error.log       â”‚     âŒ Setup database server                          â”‚
â”‚   â”‚ app.log         â”‚     âŒ Load data vÃ o database                         â”‚
â”‚   â”‚ ...             â”‚     âŒ Máº¥t thá»i gian, tá»‘n tiá»n                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CÃ“ Athena                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   S3 Bucket (1TB logs)                Athena                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ access.log      â”‚â—„â”€â”€â”€â”€ SQL â”€â”€â”€â”€â”€â”‚ SELECT * FROM logs                  â”‚ â”‚
â”‚   â”‚ error.log       â”‚                â”‚ WHERE status = 500                  â”‚ â”‚
â”‚   â”‚ app.log         â”‚                â”‚ AND date > '2024-01-01'             â”‚ â”‚
â”‚   â”‚ ...             â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                              â”‚
â”‚   âœ… Query trá»±c tiáº¿p S3 - khÃ´ng cáº§n copy data                                â”‚
â”‚   âœ… Serverless - khÃ´ng quáº£n lÃ½ server                                       â”‚
â”‚   âœ… Pay-per-query - chá»‰ tráº£ $5/TB scanned                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Kiáº¿n trÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Amazon Athena Architecture                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚   â”‚    User     â”‚                                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚          â”‚ SQL Query                                                         â”‚
â”‚          â–¼                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         Amazon Athena                                â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â”‚
â”‚   â”‚   â”‚  Query Engine   â”‚     â”‚   AWS Glue      â”‚                      â”‚   â”‚
â”‚   â”‚   â”‚  (Presto/Trino) â”‚â—„â”€â”€â”€â”€â”‚   Data Catalog  â”‚                      â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   (Metadata)    â”‚                      â”‚   â”‚
â”‚   â”‚            â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â”‚                                                             â”‚
â”‚                â”‚ Scan Data                                                   â”‚
â”‚                â–¼                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         Amazon S3                                    â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚   â”‚
â”‚   â”‚   â”‚   Bucket A  â”‚  â”‚   Bucket B  â”‚  â”‚   Bucket C  â”‚                â”‚   â”‚
â”‚   â”‚   â”‚  (CSV/JSON) â”‚  â”‚  (Parquet)  â”‚  â”‚   (ORC)     â”‚                â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   Query Results â†’ S3 Bucket (staging location)                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Components

| Component | MÃ´ táº£ |
|-----------|-------|
| **Athena Engine** | Presto/Trino-based SQL engine |
| **AWS Glue Data Catalog** | Metadata store (databases, tables, schemas) |
| **S3** | Data source (nÆ¡i chá»©a data thá»±c táº¿) |
| **Query Results Location** | S3 bucket lÆ°u káº¿t quáº£ query |

---

## CÃ¡ch hoáº¡t Ä‘á»™ng

### Step-by-step

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         How Athena Works                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   STEP 1: Táº¡o Database vÃ  Table (pointing to S3)                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚                                                                              â”‚
â”‚   CREATE EXTERNAL TABLE logs (                                               â”‚
â”‚       timestamp STRING,                                                      â”‚
â”‚       ip STRING,                                                             â”‚
â”‚       request STRING,                                                        â”‚
â”‚       status INT                                                             â”‚
â”‚   )                                                                          â”‚
â”‚   ROW FORMAT DELIMITED FIELDS TERMINATED BY ','                             â”‚
â”‚   LOCATION 's3://my-bucket/logs/';                                          â”‚
â”‚                                                                              â”‚
â”‚   ğŸ“ Table lÃ  schema/definition - khÃ´ng copy data                           â”‚
â”‚   ğŸ“ Data váº«n á»Ÿ S3 bucket                                                   â”‚
â”‚                                                                              â”‚
â”‚   STEP 2: Query trá»±c tiáº¿p                                                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚                                                                              â”‚
â”‚   SELECT ip, COUNT(*) as requests                                           â”‚
â”‚   FROM logs                                                                  â”‚
â”‚   WHERE status = 500                                                         â”‚
â”‚   GROUP BY ip                                                                â”‚
â”‚   ORDER BY requests DESC                                                     â”‚
â”‚   LIMIT 10;                                                                  â”‚
â”‚                                                                              â”‚
â”‚   STEP 3: Athena scan S3, return results                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚                                                                              â”‚
â”‚   â€¢ Athena Ä‘á»c data tá»« S3 location                                          â”‚
â”‚   â€¢ Apply filters, aggregations                                              â”‚
â”‚   â€¢ Return results (also saved to S3)                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### EXTERNAL TABLE concept

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 EXTERNAL TABLE vs Regular Table                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Regular Table (MySQL, PostgreSQL):                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚   â€¢ Data Ä‘Æ°á»£c copy VÃ€O database                                 â”‚
â”‚   â€¢ Database quáº£n lÃ½ data                                       â”‚
â”‚   â€¢ DROP TABLE â†’ XÃ³a cáº£ definition VÃ€ data                      â”‚
â”‚                                                                 â”‚
â”‚   External Table (Athena):                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   â€¢ Data VáºªN á» S3 - khÃ´ng copy                                  â”‚
â”‚   â€¢ Athena chá»‰ cÃ³ schema/definition                             â”‚
â”‚   â€¢ DROP TABLE â†’ Chá»‰ xÃ³a definition, DATA VáºªN CÃ’N trong S3     â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚   Athena    â”‚         â”‚          S3             â”‚          â”‚
â”‚   â”‚             â”‚ POINTS  â”‚                         â”‚          â”‚
â”‚   â”‚  Table def  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Actual data files     â”‚          â”‚
â”‚   â”‚  (schema)   â”‚   TO    â”‚  (CSV, Parquet, JSON)  â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Formats

Athena há»— trá»£ nhiá»u data formats:

| Format | Compression | Use Case | Performance |
|--------|-------------|----------|-------------|
| **CSV/TSV** | GZIP, BZIP2 | Simple logs | â­â­ |
| **JSON** | GZIP | Semi-structured data | â­â­ |
| **Parquet** | Snappy, GZIP | Analytics | â­â­â­â­â­ |
| **ORC** | Snappy, ZLIB | Analytics | â­â­â­â­â­ |
| **Avro** | Snappy | Schema evolution | â­â­â­ |

### Columnar vs Row-based

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Row-based vs Columnar Formats                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   ROW-BASED (CSV, JSON):                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚   Row 1: [id=1, name="John", age=30, city="NYC"]                            â”‚
â”‚   Row 2: [id=2, name="Jane", age=25, city="LA"]                             â”‚
â”‚   Row 3: [id=3, name="Bob", age=35, city="SF"]                              â”‚
â”‚                                                                              â”‚
â”‚   Query: SELECT name FROM users                                              â”‚
â”‚   â†’ Pháº£i Ä‘á»c Táº¤T Cáº¢ columns rá»“i má»›i lá»c "name"                              â”‚
â”‚   â†’ Scan nhiá»u data = Tá»N TIá»€N ğŸ’°                                            â”‚
â”‚                                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚   COLUMNAR (Parquet, ORC):                                                   â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚   Column id:   [1, 2, 3]                                                     â”‚
â”‚   Column name: ["John", "Jane", "Bob"]                                       â”‚
â”‚   Column age:  [30, 25, 35]                                                  â”‚
â”‚   Column city: ["NYC", "LA", "SF"]                                           â”‚
â”‚                                                                              â”‚
â”‚   Query: SELECT name FROM users                                              â”‚
â”‚   â†’ Chá»‰ Ä‘á»c column "name"                                                    â”‚
â”‚   â†’ Skip cÃ¡c columns khÃ¡c                                                    â”‚
â”‚   â†’ Scan ÃT data = TIáº¾T KIá»†M ğŸ’°                                              â”‚
â”‚                                                                              â”‚
â”‚   â­ BEST PRACTICE: Convert CSV/JSON â†’ Parquet Ä‘á»ƒ tiáº¿t kiá»‡m 30-90%          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Partitioning

**Partitioning** chia data thÃ nh cÃ¡c pháº§n nhá» hÆ¡n dá»±a trÃªn column values, giÃºp **giáº£m data scanned**.

### VÃ­ dá»¥ Partition by Date

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Partitioning Example                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   S3 Structure (Partitioned by year/month/day):                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                              â”‚
â”‚   s3://my-bucket/logs/                                                       â”‚
â”‚   â”œâ”€â”€ year=2024/                                                             â”‚
â”‚   â”‚   â”œâ”€â”€ month=01/                                                          â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ day=01/                                                        â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ data.parquet  (10 GB)                                     â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ day=02/                                                        â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ data.parquet  (10 GB)                                     â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ...                                                            â”‚
â”‚   â”‚   â”œâ”€â”€ month=02/                                                          â”‚
â”‚   â”‚   â”‚   â””â”€â”€ ...                                                            â”‚
â”‚   â”‚   â””â”€â”€ ...                                                                â”‚
â”‚   â””â”€â”€ year=2025/                                                             â”‚
â”‚       â””â”€â”€ ...                                                                â”‚
â”‚                                                                              â”‚
â”‚   Total: 3.6 TB (1 year of data)                                            â”‚
â”‚                                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚   Query WITHOUT partition filter:                                            â”‚
â”‚   SELECT * FROM logs WHERE status = 500                                      â”‚
â”‚   â†’ Scan: 3.6 TB â†’ Cost: $18 ğŸ’°ğŸ’°ğŸ’°                                          â”‚
â”‚                                                                              â”‚
â”‚   Query WITH partition filter:                                               â”‚
â”‚   SELECT * FROM logs                                                         â”‚
â”‚   WHERE status = 500                                                         â”‚
â”‚   AND year = '2024' AND month = '01' AND day = '15'                         â”‚
â”‚   â†’ Scan: 10 GB â†’ Cost: $0.05 ğŸ’°                                             â”‚
â”‚                                                                              â”‚
â”‚   â­ Partition pruning: Athena chá»‰ Ä‘á»c folder cáº§n thiáº¿t!                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Add Partitions

```sql
-- Manual add partition
ALTER TABLE logs ADD PARTITION (year='2024', month='01', day='15')
LOCATION 's3://my-bucket/logs/year=2024/month=01/day=15/';

-- Auto-discover partitions (better!)
MSCK REPAIR TABLE logs;
```

---

## TÃ­ch há»£p vá»›i cÃ¡c dá»‹ch vá»¥ AWS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Athena Integrations                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                              Amazon Athena                                    â”‚
â”‚                                    â”‚                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚     â”‚              â”‚               â”‚               â”‚              â”‚         â”‚
â”‚     â–¼              â–¼               â–¼               â–¼              â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  S3  â”‚    â”‚   Glue   â”‚    â”‚QuickSightâ”‚    â”‚ Lambda  â”‚    â”‚   EMR   â”‚    â”‚
â”‚  â”‚      â”‚    â”‚  Catalog â”‚    â”‚   (BI)   â”‚    â”‚(Trigger)â”‚    â”‚ (ETL)   â”‚    â”‚
â”‚  â”‚ Data â”‚    â”‚ Metadata â”‚    â”‚Dashboard â”‚    â”‚         â”‚    â”‚         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  S3: Data source                                                             â”‚
â”‚  Glue Data Catalog: Table definitions, schema                                â”‚
â”‚  QuickSight: Visualize Athena query results                                  â”‚
â”‚  Lambda: Trigger queries programmatically                                    â”‚
â”‚  EMR: Process data, output to S3 for Athena                                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Common Data Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Analytics Pipeline                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Raw Data          Transform           Query      Visualize   â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ Kinesisâ”‚â”€â”€â”€â”€â”€â–ºâ”‚   Glue    â”‚â”€â”€â”€â”€â”€â–ºâ”‚ Athena  â”‚â”€â”€â–ºâ”‚QuickSightâ”‚â”‚
â”‚   â”‚Firehoseâ”‚      â”‚  (ETL to  â”‚      â”‚ (Query) â”‚   â”‚  (BI)    â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚  Parquet) â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚       â–¼               â”‚                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”          â–¼                                         â”‚
â”‚   â”‚  S3   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚   â”‚ (raw) â”‚      â”‚  S3   â”‚                                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚(clean)â”‚                                     â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Federated Query

**Federated Query** cho phÃ©p Athena query data tá»« **nhiá»u nguá»“n khÃ¡c ngoÃ i S3**.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Federated Query                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                              Amazon Athena                                    â”‚
â”‚                                    â”‚                                         â”‚
â”‚                         Federated Query Engine                               â”‚
â”‚                                    â”‚                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚     â–¼          â–¼          â–¼        â–¼        â–¼          â–¼          â–¼         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  S3  â”‚  â”‚ RDS  â”‚  â”‚MySQL â”‚  â”‚Redis â”‚  â”‚ Doc  â”‚  â”‚Cloud â”‚  â”‚ On-  â”‚      â”‚
â”‚  â”‚      â”‚  â”‚      â”‚  â”‚Auroraâ”‚  â”‚Elastiâ”‚  â”‚ DB   â”‚  â”‚Watch â”‚  â”‚ Prem â”‚      â”‚
â”‚  â”‚      â”‚  â”‚      â”‚  â”‚      â”‚  â”‚cache â”‚  â”‚      â”‚  â”‚ Logs â”‚  â”‚      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â”‚   Data Source Connectors (Lambda-based):                                     â”‚
â”‚   â€¢ Amazon-provided connectors                                               â”‚
â”‚   â€¢ Custom connectors (build your own)                                       â”‚
â”‚                                                                              â”‚
â”‚   Example: JOIN S3 data vá»›i RDS data trong má»™t query!                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Workgroups

**Workgroups** giÃºp tÃ¡ch biá»‡t queries, users, vÃ  control costs.

| Feature | MÃ´ táº£ |
|---------|-------|
| **Query isolation** | TÃ¡ch queries theo team/project |
| **Cost control** | Set data scan limits per query |
| **IAM integration** | Control access to workgroups |
| **Query history** | Track queries per workgroup |
| **Settings** | Different result locations, encryption |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Workgroups                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Workgroup: "data-science"                                     â”‚
â”‚   â”œâ”€â”€ Members: data science team                                â”‚
â”‚   â”œâ”€â”€ Data limit: 100 GB per query                              â”‚
â”‚   â”œâ”€â”€ Result location: s3://athena-results/data-science/        â”‚
â”‚   â””â”€â”€ Queries tracked separately                                â”‚
â”‚                                                                 â”‚
â”‚   Workgroup: "business-analytics"                               â”‚
â”‚   â”œâ”€â”€ Members: business analysts                                â”‚
â”‚   â”œâ”€â”€ Data limit: 10 GB per query                               â”‚
â”‚   â”œâ”€â”€ Result location: s3://athena-results/analytics/           â”‚
â”‚   â””â”€â”€ Queries tracked separately                                â”‚
â”‚                                                                 â”‚
â”‚   â­ Prevent runaway queries eating budget!                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Pricing

### Pricing Model

| Component | Price |
|-----------|-------|
| **Data scanned** | $5 per TB scanned |
| **DDL statements** | FREE (CREATE, DROP, ALTER) |
| **Failed queries** | FREE |
| **Cancelled queries** | Pay for data scanned before cancel |

### Cost Optimization

| Technique | Savings |
|-----------|---------|
| **Columnar formats (Parquet/ORC)** | 30-90% less data scanned |
| **Compression** | 30-50% less data |
| **Partitioning** | Only scan needed partitions |
| **LIMIT clause** | Limit results (doesn't help much) |

### Cost Example

```
Scenario: Query 1 TB of CSV logs daily

WITHOUT optimization:
- 1 TB Ã— $5 Ã— 30 days = $150/month

WITH optimization (Convert to Parquet + Partition):
- Data reduction: 90%
- Partition pruning: 95% (only query today's data)
- Effective scan: 1 TB Ã— 0.1 Ã— 0.05 = 5 GB
- Cost: 0.005 TB Ã— $5 Ã— 30 days = $0.75/month

ğŸ’° Savings: 99.5%!
```

---

## Performance Optimization

### 1. Use Columnar Formats

```sql
-- Convert CSV to Parquet using CTAS
CREATE TABLE logs_parquet
WITH (
    format = 'PARQUET',
    external_location = 's3://my-bucket/logs-parquet/'
)
AS SELECT * FROM logs_csv;
```

### 2. Partition Data

```sql
-- Create partitioned table
CREATE EXTERNAL TABLE logs (
    ip STRING,
    request STRING,
    status INT
)
PARTITIONED BY (year STRING, month STRING, day STRING)
STORED AS PARQUET
LOCATION 's3://my-bucket/logs-partitioned/';
```

### 3. Use Compression

```sql
-- Recommended: Snappy for Parquet (good balance)
CREATE TABLE logs_compressed
WITH (
    format = 'PARQUET',
    parquet_compression = 'SNAPPY'
)
AS SELECT * FROM logs;
```

### 4. Optimize Queries

| Do | Don't |
|----|-------|
| `SELECT col1, col2` | `SELECT *` |
| Filter on partition columns | Scan entire dataset |
| Use `LIMIT` for testing | Run full query for testing |
| Use `EXPLAIN` to understand | Guess query performance |

---

## Use Cases

### 1. Log Analysis

```
Use case: Analyze CloudTrail, VPC Flow Logs, ALB Access Logs
How: Query directly from S3 without ETL
Benefit: Pay only when you query
```

### 2. Ad-hoc Data Exploration

```
Use case: Data scientists explore new datasets
How: Create table, run SQL queries
Benefit: No infrastructure setup
```

### 3. BI Dashboards

```
Use case: Business analytics with QuickSight
How: QuickSight connects to Athena, Athena queries S3
Benefit: Low-cost BI on large datasets
```

### 4. Data Lake Analytics

```
Use case: Query petabytes in data lake
How: Glue crawls S3, Athena queries
Benefit: Schema-on-read, no data movement
```

---

## Best Practices

### Data Organization

| Practice | Reason |
|----------|--------|
| Use **Parquet/ORC** | Columnar = less data scanned |
| **Partition** by date/region | Partition pruning |
| **Compress** data | Smaller files = cheaper |
| **Right-size files** | 128 MB - 512 MB optimal |

### Query Optimization

| Practice | Reason |
|----------|--------|
| Select **specific columns** | Don't use `SELECT *` |
| **Filter on partitions** | Avoid full table scans |
| Use **LIMIT** for testing | Save costs during development |
| **EXPLAIN** queries | Understand query plans |

### Cost Control

| Practice | Reason |
|----------|--------|
| Set **workgroup limits** | Prevent runaway queries |
| **Monitor** with CloudWatch | Track spending |
| Use **Saved Queries** | Reuse optimized queries |

---

## Exam Tips

### Key Points

1. **Serverless** - No infrastructure to manage
2. **Pay-per-query** - $5/TB scanned
3. **Standard SQL** - Presto/Trino engine
4. **S3 as data source** - Query data in place
5. **Glue Data Catalog** - Metadata storage

### Cost Optimization (important!)

- **Columnar formats** (Parquet/ORC) reduce costs 30-90%
- **Partitioning** reduces data scanned
- **Compression** reduces data size
- **Workgroups** control costs per team

### Common Exam Scenarios

| Scenario | Answer |
|----------|--------|
| Query S3 data with SQL, serverless | Amazon Athena |
| Analyze CloudTrail/VPC Flow Logs | Athena |
| Ad-hoc queries on data lake | Athena |
| Reduce Athena costs | Parquet + Partitioning |
| BI on S3 data | QuickSight + Athena |
| Query multiple data sources | Federated Query |

### So sÃ¡nh vá»›i cÃ¡c dá»‹ch vá»¥ khÃ¡c

| Feature | Athena | Redshift | EMR |
|---------|--------|----------|-----|
| **Type** | Serverless query | Data warehouse | Cluster |
| **Pricing** | Per query | Per hour | Per hour |
| **Best for** | Ad-hoc, occasional | BI, dashboards | ETL, ML |
| **Setup** | Instant | Minutes | Minutes |
| **Data location** | S3 | Redshift storage | S3/HDFS |

---

## LiÃªn káº¿t liÃªn quan

- [Amazon S3](./s3.md)
- [AWS Glue](./aws-glue.md)
- [Amazon QuickSight](./amazon-quicksight.md)
- [Amazon EMR](./amazon-emr.md)
- [AWS Lake Formation](./aws-lake-formation.md)
