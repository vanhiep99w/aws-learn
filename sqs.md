# Amazon SQS (Simple Queue Service)


## Má»¥c lá»¥c

- [Tá»•ng quan](#tá»•ng-quan)
- [1. Queue Types](#1-queue-types)
  - [FIFO - Message Group Processing](#14-fifo---message-group-processing)
  - [FIFO - Hot Partition Problem](#15-fifo---hot-partition-problem)
  - [FIFO - Head-of-Line Blocking](#16-fifo---head-of-line-blocking)
- [2. Message Lifecycle](#2-message-lifecycle)
- [3. SQS Features](#3-sqs-features)
  - [Long Polling vs Short Polling](#31-long-polling-vs-short-polling)
  - [Message Failure vÃ  Retry Flow](#32-message-failure--retry-flow)
  - [Dead Letter Queue](#33-dead-letter-queue-dlq)
- [4. Security](#4-security)
- [5. Integration Patterns](#5-integration-patterns)
- [6. Best Practices](#6-best-practices)
  - [Auto Scaling Consumers vá»›i CloudWatch Alarms](#64-auto-scaling-consumers-vá»›i-cloudwatch-alarms)
- [7. Spring Boot Integration](#7-spring-boot-integration)
- [8. SQS vs SNS vs Kinesis](#8-sqs-vs-sns-vs-kinesis)
- [8. SQS Message Distribution & So sÃ¡nh vá»›i Kafka](#8-sqs-message-distribution-so-sÃ¡nh-vá»›i-kafka)
- [9. Common Exam Questions](#9-common-exam-questions)
- [TÃ i liá»‡u tham kháº£o](#tÃ i-liá»‡u-tham-kháº£o)

---

## Tá»•ng quan

**Amazon SQS** lÃ  fully managed message queuing service giÃºp **decouple** vÃ  **scale** microservices, distributed systems, vÃ  serverless applications.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SQS ARCHITECTURE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   Producer   â”‚â”€â”€â”€â†’â”‚   SQS Queue  â”‚â”€â”€â”€â†’â”‚   Consumer   â”‚     â”‚
â”‚   â”‚  (Send Msg)  â”‚    â”‚  (Store Msg) â”‚    â”‚ (Receive Msg)â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚   â€¢ Producers gá»­i messages vÃ o queue                            â”‚
â”‚   â€¢ Messages Ä‘Æ°á»£c lÆ°u trá»¯ táº¡m thá»i                              â”‚
â”‚   â€¢ Consumers poll vÃ  xá»­ lÃ½ messages                            â”‚
â”‚   â€¢ Messages bá»‹ xÃ³a sau khi xá»­ lÃ½ thÃ nh cÃ´ng                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Lá»£i Ã­ch chÃ­nh

| Feature | MÃ´ táº£ |
|---------|-------|
| **Fully Managed** | KhÃ´ng cáº§n quáº£n lÃ½ infrastructure |
| **Unlimited Throughput** | KhÃ´ng giá»›i háº¡n sá»‘ messages/giÃ¢y |
| **Unlimited Queue Size** | LÆ°u trá»¯ khÃ´ng giá»›i háº¡n messages |
| **Decoupling** | TÃ¡ch biá»‡t producers vÃ  consumers |
| **Durability** | Messages Ä‘Æ°á»£c replicate qua nhiá»u AZs |

---

## 1. Queue Types

### 1.1 Standard Queue vs FIFO Queue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                STANDARD vs FIFO QUEUE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   STANDARD QUEUE:                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Send: A â†’ B â†’ C â†’ D                                    â”‚  â”‚
â”‚   â”‚  Receive: A â†’ C â†’ B â†’ A â†’ D  (Best-effort ordering)     â”‚  â”‚
â”‚   â”‚           â†‘                                             â”‚  â”‚
â”‚   â”‚      CÃ³ thá»ƒ trÃ¹ng!                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   FIFO QUEUE:                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Send: A â†’ B â†’ C â†’ D                                    â”‚  â”‚
â”‚   â”‚  Receive: A â†’ B â†’ C â†’ D  (Exact ordering)               â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚  Exactly-once processing                                â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 So sÃ¡nh chi tiáº¿t

| Feature | Standard Queue | FIFO Queue |
|---------|---------------|------------|
| **Throughput** | Unlimited | 300 msg/s (batch: 3000) |
| **Ordering** | Best-effort | Guaranteed (FIFO) |
| **Delivery** | At-least-once | Exactly-once |
| **Deduplication** | No | Yes (5 min window) |
| **Queue Name** | Any | Must end with `.fifo` |
| **Use Case** | High throughput | Ordering important |

> [!WARNING]
> **Best-effort Ordering nghÄ©a lÃ  gÃ¬?**
>
> SQS Standard Queue lÃ  **distributed system** (nhiá»u servers). Messages phÃ¢n tÃ¡n trÃªn nhiá»u servers nÃªn thá»© tá»± **KHÃ”NG Äáº¢M Báº¢O**:
> ```
> Gá»­i:  [1] â†’ [2] â†’ [3] â†’ [4] â†’ [5]
> Nháº­n: [2] â†’ [1] â†’ [4] â†’ [3] â†’ [5]  (cÃ³ thá»ƒ sai thá»© tá»±!)
> ```
> "Best-effort" = SQS **cá»‘ gáº¯ng** giá»¯ thá»© tá»±, nhÆ°ng **khÃ´ng há»©a**.

> [!CAUTION]
> **Duplicate Processing - Khi Visibility Timeout háº¿t trong lÃºc Ä‘ang xá»­ lÃ½**
>
> ```
> T=0s: Consumer A nháº­n message, báº¯t Ä‘áº§u xá»­ lÃ½
> T=30s: Visibility Timeout Háº¾T Háº N (A váº«n Ä‘ang xá»­ lÃ½)
> T=31s: Message VISIBLE láº¡i â†’ Consumer B nháº­n Ä‘Æ°á»£c
> 
> Káº¾T QUáº¢: Cáº¢ A VÃ€ B ÄANG Xá»¬ LÃ CÃ™NG 1 MESSAGE!
> ```
>
> **Giáº£i phÃ¡p:**
> 1. Set `Visibility Timeout` > thá»i gian xá»­ lÃ½
> 2. Gá»i `ChangeMessageVisibility` API Ä‘á»ƒ extend timeout
> 3. Code consumer pháº£i **IDEMPOTENT** (cháº¡y 2 láº§n = káº¿t quáº£ giá»‘ng nhau)

### 1.3 FIFO Queue Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FIFO QUEUE CONCEPTS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   MESSAGE GROUP ID:                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Group "OrderA": [1] â†’ [2] â†’ [3]  (Processed in order)  â”‚  â”‚
â”‚   â”‚  Group "OrderB": [1] â†’ [2] â†’ [3]  (Parallel processing) â”‚  â”‚
â”‚   â”‚  Group "OrderC": [1] â†’ [2] â†’ [3]  (Different consumer)  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   â†’ Messages cÃ¹ng Group ID Ä‘Æ°á»£c xá»­ lÃ½ theo thá»© tá»±               â”‚
â”‚   â†’ KhÃ¡c Group ID cÃ³ thá»ƒ xá»­ lÃ½ parallel                         â”‚
â”‚                                                                 â”‚
â”‚   DEDUPLICATION ID:                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Message vá»›i cÃ¹ng Deduplication ID trong 5 phÃºt         â”‚  â”‚
â”‚   â”‚  sáº½ bá»‹ reject (prevent duplicates)                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Deduplication Methods:**
1. **Content-based**: SQS tá»± hash message body
2. **Message Deduplication ID**: Developer tá»± Ä‘áº·t ID

### 1.4 FIFO - Message Group Processing

> [!IMPORTANT]
> **1 Message Group = Chá»‰ 1 message "in-flight" táº¡i 1 thá»i Ä‘iá»ƒm**
>
> ```
> Group "OrderA": [1] [2] [3]
>                  â†“
> Consumer nháº­n [1] â†’ [2] vÃ  [3] bá»‹ BLOCK!
>                  â†“
> Consumer xá»­ lÃ½ xong [1], xÃ³a â†’ [2] má»›i available
> ```
>
> | Äiá»u kiá»‡n | Xá»­ lÃ½ song song? |
> |-----------|-----------------|
> | **CÃ¹ng Group** | âŒ KHÃ”NG - pháº£i tuáº§n tá»± |
> | **KhÃ¡c Group** | âœ… CÃ“ - song song Ä‘Æ°á»£c |

### 1.5 FIFO - Hot Partition Problem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HOT PARTITION PROBLEM                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Group "VIP-Customer": [1][2][3]...[1000]  â† HOT! ğŸ”¥           â”‚
â”‚   Group "Normal-1":     [1][2]              â† bÃ¬nh thÆ°á»ng       â”‚
â”‚   Group "Normal-2":     [1]                 â† bÃ¬nh thÆ°á»ng       â”‚
â”‚                                                                 â”‚
â”‚   Váº¥n Ä‘á»: VIP-Customer cÃ³ 1000 msgs nhÆ°ng chá»‰ xá»­ lÃ½ 1 lÃºc 1!   â”‚
â”‚   â†’ BOTTLENECK!                                                 â”‚
â”‚                                                                 â”‚
â”‚   Giáº£i phÃ¡p: Chia nhá» Group ID                                  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚   âŒ TrÆ°á»›c: Group ID = "customer-123"                           â”‚
â”‚   âœ… Sau:   Group ID = "customer-123-order-456"                 â”‚
â”‚                                                                 â”‚
â”‚   â†’ Má»—i order lÃ  1 group riÃªng â†’ scale tá»‘t hÆ¡n                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.6 FIFO - Head-of-Line Blocking

> [!CAUTION]
> **Message Ä‘áº§u fail â†’ BLOCK táº¥t cáº£ messages phÃ­a sau trong cÃ¹ng Group!**
>
> ```
> Group "OrderA": [1] [2] [3] [4] [5]
>                  â†“
> [1] fail, retry... fail, retry... fail
>                  â†“
> [2] [3] [4] [5] VáºªN Bá»Š BLOCK! ğŸš«
> ```
>
> **Giáº£i phÃ¡p: Dead Letter Queue (DLQ)**
> ```
> [1] fail > maxReceiveCount â†’ [1] vÃ o DLQ
>                            â†’ [2] bÃ¢y giá» available! âœ…
> ```

> [!WARNING]
> **FIFO Queue Báº®T BUá»˜C pháº£i cÃ³ DLQ!**
> Náº¿u khÃ´ng â†’ 1 message lá»—i cÃ³ thá»ƒ block cáº£ group mÃ£i mÃ£i!

## 2. Message Lifecycle

### 2.1 Flow chi tiáº¿t

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MESSAGE LIFECYCLE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   1. SEND MESSAGE                                               â”‚
â”‚   Producer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ SQS Queue                        â”‚
â”‚   (SendMessage API)            (Message stored)                 â”‚
â”‚                                                                 â”‚
â”‚   2. RECEIVE MESSAGE                                            â”‚
â”‚   Consumer â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SQS Queue                        â”‚
â”‚   (ReceiveMessage API)         (Up to 10 msgs/call)             â”‚
â”‚            â”‚                                                    â”‚
â”‚            â†“                                                    â”‚
â”‚   3. VISIBILITY TIMEOUT (message invisible)                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ Message "locked" - other consumers can't see it       â”‚    â”‚
â”‚   â”‚ Default: 30 seconds, Max: 12 hours                    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚            â”‚                                                    â”‚
â”‚       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                               â”‚
â”‚       â†“         â†“                                               â”‚
â”‚   SUCCESS    FAILURE                                            â”‚
â”‚      â”‚          â”‚                                               â”‚
â”‚      â†“          â†“                                               â”‚
â”‚   4. DELETE   Message becomes                                   â”‚
â”‚   MESSAGE     visible again                                     â”‚
â”‚   (DeleteMessage API)                                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Visibility Timeout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  VISIBILITY TIMEOUT                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Timeline khi Consumer receive message:                        â”‚
â”‚                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚   â”‚ Receive â”‚â†â”€â”€ Visibility Timeout (30s) â”€â”€â†’â”‚ Visible again â”‚  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â†“                                          â†“              â”‚
â”‚   Message invisible                         Náº¿u chÆ°a delete,    â”‚
â”‚   to other consumers                        consumer khÃ¡c       â”‚
â”‚                                             cÃ³ thá»ƒ receive      â”‚
â”‚                                                                 â”‚
â”‚   ChangeMessageVisibility API:                                  â”‚
â”‚   â€¢ Extend timeout náº¿u cáº§n xá»­ lÃ½ lÃ¢u hÆ¡n                        â”‚
â”‚   â€¢ Set to 0 Ä‘á»ƒ release message ngay                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Best Practice:**
- Set visibility timeout > Thá»i gian xá»­ lÃ½ message
- Sá»­ dá»¥ng `ChangeMessageVisibility` náº¿u cáº§n thÃªm thá»i gian

### 2.3 Message Retention

| Setting | Value |
|---------|-------|
| **Default** | 4 days |
| **Minimum** | 1 minute |
| **Maximum** | 14 days |

---

## 3. SQS Features

### 3.1 Long Polling vs Short Polling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LONG POLLING vs SHORT POLLING                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   SHORT POLLING (Default):                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Consumer: "Any messages?" â†’ SQS: "No" (empty response) â”‚  â”‚
â”‚   â”‚  Consumer: "Any messages?" â†’ SQS: "No"                  â”‚  â”‚
â”‚   â”‚  Consumer: "Any messages?" â†’ SQS: "Yes, here's 1"       â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚  â†’ Nhiá»u API calls, tá»‘n tiá»n, cÃ³ thá»ƒ miss messages      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   LONG POLLING (Recommended):                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Consumer: "Any messages? I'll wait up to 20s"          â”‚  â”‚
â”‚   â”‚        â†“                                                â”‚  â”‚
â”‚   â”‚  SQS waits... waits...                                  â”‚  â”‚
â”‚   â”‚        â†“                                                â”‚  â”‚
â”‚   â”‚  SQS: "Here's your message!" (or timeout after 20s)     â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚  â†’ Ãt API calls, tiáº¿t kiá»‡m tiá»n, khÃ´ng miss messages    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Enable Long Polling:**
- Queue level: `ReceiveMessageWaitTimeSeconds` > 0
- API level: `WaitTimeSeconds` parameter (1-20 seconds)

**Polling Limits:**

| Parameter | Value | MÃ´ táº£ |
|-----------|-------|-------|
| **MaxNumberOfMessages** | 1-10 | Sá»‘ messages tá»‘i Ä‘a má»—i láº§n poll |
| **WaitTimeSeconds** | 0-20s | Thá»i gian chá» Long Polling |
| **VisibilityTimeout** | 0s - 12h | Thá»i gian message bá»‹ "lock" |

### 3.2 Message Failure & Retry Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              KHI CONSUMER Xá»¬ LÃ MESSAGE FAIL                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Timeline:                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ Receive â”‚   Visibility Timeout     â”‚ Message visible láº¡i  â”‚â”‚
â”‚   â”‚ Message â”‚   (message invisible)    â”‚ trong queue          â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚       â†“                                        â†“               â”‚
â”‚   Consumer nháº­n                          Consumer khÃ¡c         â”‚
â”‚   message & FAIL                         cÃ³ thá»ƒ nháº­n láº¡i       â”‚
â”‚                                                                 â”‚
â”‚   Retry Flow:                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Receive 1 â†’ Fail â†’ Visible láº¡i                         â”‚  â”‚
â”‚   â”‚  Receive 2 â†’ Fail â†’ Visible láº¡i                         â”‚  â”‚
â”‚   â”‚  Receive 3 â†’ Fail â†’ Visible láº¡i                         â”‚  â”‚
â”‚   â”‚  ...                                                     â”‚  â”‚
â”‚   â”‚  Receive N (= maxReceiveCount) â†’ Fail â†’ CHUYá»‚N Äáº¾N DLQ  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   âš ï¸ LÆ°u Ã½:                                                    â”‚
â”‚   â€¢ Message KHÃ”NG tá»± Ä‘á»™ng bá»‹ xÃ³a khi fail                      â”‚
â”‚   â€¢ Visibility Timeout háº¿t â†’ message quay láº¡i queue            â”‚
â”‚   â€¢ Consumer khÃ¡c (hoáº·c chÃ­nh nÃ³) cÃ³ thá»ƒ nháº­n láº¡i              â”‚
â”‚   â€¢ Sau maxReceiveCount láº§n fail â†’ chuyá»ƒn sang DLQ             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Scenario | HÃ nh vi |
|----------|---------|
| **Consumer xá»­ lÃ½ SUCCESS** | Gá»i `DeleteMessage` â†’ Message bá»‹ xÃ³a |
| **Consumer xá»­ lÃ½ FAIL** | Visibility Timeout háº¿t â†’ Message visible láº¡i |
| **Consumer crash** | Visibility Timeout háº¿t â†’ Message visible láº¡i |
| **Fail > maxReceiveCount láº§n** | Message chuyá»ƒn sang DLQ |

### 3.3 Dead Letter Queue (DLQ)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DEAD LETTER QUEUE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚   â”‚   Producer   â”‚                                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚          â†“                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Failed > maxReceiveCount                 â”‚
â”‚   â”‚  Main Queue  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚   DLQ   â”‚ â”‚
â”‚          â†“                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â†“      â”‚
â”‚   â”‚   Consumer   â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚   (retry)    â”‚                              â”‚ Investigate â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚   & Debug   â”‚â”‚
â”‚                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚   maxReceiveCount = Sá»‘ láº§n retry trÆ°á»›c khi chuyá»ƒn Ä‘áº¿n DLQ       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**DLQ Redrive:**
- Sau khi fix bug, cÃ³ thá»ƒ "redrive" messages tá»« DLQ vá» main queue
- Console: "Start DLQ redrive"
- Redrive policy: tá»‘i Ä‘a bao nhiÃªu messages sáº½ redrive/giÃ¢y

### 3.3 Delay Queue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DELAY QUEUE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Producer sends message                                        â”‚
â”‚       â†“                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ DELAY PERIOD (0 - 15 minutes)                         â”‚    â”‚
â”‚   â”‚ Message invisible to consumers                        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚       â†“                                                         â”‚
â”‚   Message becomes available for consumers                       â”‚
â”‚                                                                 â”‚
â”‚   2 ways to set delay:                                          â”‚
â”‚   â€¢ Queue level: DelaySeconds (applies to all messages)         â”‚
â”‚   â€¢ Message level: DelaySeconds parameter (override queue)      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 Message Attributes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MESSAGE STRUCTURE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                     MESSAGE                             â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  Body (Required):                                       â”‚  â”‚
â”‚   â”‚  â€¢ String (max 256 KB)                                  â”‚  â”‚
â”‚   â”‚  â€¢ JSON, XML, or plain text                             â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  Attributes (Optional, up to 10):                       â”‚  â”‚
â”‚   â”‚  â€¢ Name-Type-Value                                      â”‚  â”‚
â”‚   â”‚  â€¢ Types: String, Number, Binary                        â”‚  â”‚
â”‚   â”‚  â€¢ Used for metadata                                    â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  System Attributes:                                     â”‚  â”‚
â”‚   â”‚  â€¢ MessageId, ReceiptHandle                             â”‚  â”‚
â”‚   â”‚  â€¢ ApproximateReceiveCount                              â”‚  â”‚
â”‚   â”‚  â€¢ SentTimestamp, ApproximateFirstReceiveTimestamp      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5 Large Messages (Extended Client)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LARGE MESSAGES (>256KB)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   SQS Extended Client Library (Java):                           â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
â”‚   â”‚   Producer   â”‚                                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                              â”‚
â”‚          â”‚                                                      â”‚
â”‚          â†“                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  1. Upload large payload to S3                           â”‚ â”‚
â”‚   â”‚  2. Send message with S3 reference to SQS                â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                   â”‚                                  â”‚
â”‚          â†“                   â†“                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚   â”‚     S3       â”‚    â”‚  SQS Queue   â”‚                         â”‚
â”‚   â”‚ (Large data) â”‚    â”‚ (Reference)  â”‚                         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â†“                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Consumer: receive SQS message â†’ fetch data from S3      â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Security

### 4.1 Encryption

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ENCRYPTION                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   IN-FLIGHT (HTTPS):                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Producer â”€â”€â”€â”€ HTTPS â”€â”€â”€â”€â†’ SQS â†â”€â”€â”€â”€ HTTPS â”€â”€â”€â”€ Consumerâ”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   AT-REST (SSE-SQS / SSE-KMS):                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  SSE-SQS: AWS managed keys (default, free)              â”‚  â”‚
â”‚   â”‚  SSE-KMS: Customer managed keys (more control)          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   CLIENT-SIDE ENCRYPTION:                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Producer encrypts â†’ SQS (encrypted) â†’ Consumer decryptsâ”‚  â”‚
â”‚   â”‚  (Application handles encryption/decryption)            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Access Control

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ACCESS CONTROL                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   IAM POLICIES:                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Attached to IAM users/roles                            â”‚  â”‚
â”‚   â”‚  Control "who can access what"                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   SQS ACCESS POLICIES (Resource-based):                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Attached to SQS queue                                  â”‚  â”‚
â”‚   â”‚  Allow cross-account access                             â”‚  â”‚
â”‚   â”‚  Allow other AWS services (SNS, S3, etc.)               â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**SQS Access Policy Example (Allow SNS to send):**
```json
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow",
    "Principal": {"Service": "sns.amazonaws.com"},
    "Action": "sqs:SendMessage",
    "Resource": "arn:aws:sqs:region:account:queue",
    "Condition": {
      "ArnEquals": {
        "aws:SourceArn": "arn:aws:sns:region:account:topic"
      }
    }
  }]
}
```

---

## 5. Integration Patterns

### 5.1 SQS + Lambda

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SQS + LAMBDA                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   Producer   â”‚â”€â”€â”€â†’â”‚  SQS Queue   â”‚â”€â”€â”€â†’â”‚   Lambda     â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  (Trigger)   â”‚     â”‚
â”‚                              â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                              â”‚                   â”‚              â”‚
â”‚                              â†“                   â†“              â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                       â”‚     DLQ      â”‚    â”‚  Process &   â”‚     â”‚
â”‚                       â”‚ (on failure) â”‚    â”‚   Delete     â”‚     â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚   Lambda Event Source Mapping:                                  â”‚
â”‚   â€¢ Batch size: 1-10 (Standard), 1-10,000 (FIFO)               â”‚
â”‚   â€¢ Batch window: 0-300 seconds                                 â”‚
â”‚   â€¢ Concurrency: Up to 1000 concurrent Lambda invocations       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Lambda Scaling vá»›i SQS:**
- Lambda polls SQS vá»›i long polling
- Auto-scale based on queue depth
- Max 1000 concurrent executions (default)

### 5.2 SNS + SQS (Fan-out Pattern)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SNS + SQS FAN-OUT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                    â”‚   Producer   â”‚                             â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â†“                                     â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                    â”‚  SNS Topic   â”‚                             â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                           â”‚                                     â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚           â†“               â†“               â†“                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  SQS Queue A â”‚ â”‚  SQS Queue B â”‚ â”‚  SQS Queue C â”‚           â”‚
â”‚   â”‚  (Analytics) â”‚ â”‚  (Billing)   â”‚ â”‚  (Inventory) â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â†“               â†“               â†“                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚  Consumer A  â”‚ â”‚  Consumer B  â”‚ â”‚  Consumer C  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚   Benefits:                                                     â”‚
â”‚   â€¢ One message â†’ Multiple consumers                            â”‚
â”‚   â€¢ Decoupled & independent processing                          â”‚
â”‚   â€¢ Each queue can have different processing logic              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 S3 Event â†’ SQS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    S3 + SQS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚  S3 Bucket   â”‚â”€â”€â”€â†’â”‚  SQS Queue   â”‚â”€â”€â”€â†’â”‚   Consumer   â”‚     â”‚
â”‚   â”‚  (Upload)    â”‚    â”‚              â”‚    â”‚  (Process)   â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚   S3 Event Types:                                               â”‚
â”‚   â€¢ s3:ObjectCreated:*                                          â”‚
â”‚   â€¢ s3:ObjectRemoved:*                                          â”‚
â”‚   â€¢ s3:ObjectRestore:*                                          â”‚
â”‚                                                                 â”‚
â”‚   Use Case: Image/video processing pipeline                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 Request-Response Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REQUEST-RESPONSE PATTERN                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Requester                                    Responder        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚            â”‚â”€â”€â”€â”€ Request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚            â”‚   â”‚
â”‚   â”‚            â”‚    (CorrelationId: 123)      â”‚            â”‚   â”‚
â”‚   â”‚            â”‚    (ReplyTo: response-queue) â”‚            â”‚   â”‚
â”‚   â”‚            â”‚                              â”‚            â”‚   â”‚
â”‚   â”‚            â”‚â†â”€â”€â”€ Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚   â”‚
â”‚   â”‚            â”‚    (CorrelationId: 123)      â”‚            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â†“                                            â†“          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚Response Queueâ”‚                        â”‚Request Queue â”‚     â”‚
â”‚   â”‚ (Temporary)  â”‚                        â”‚              â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                 â”‚
â”‚   SQS Temporary Queues:                                         â”‚
â”‚   â€¢ Auto-delete after idle timeout                              â”‚
â”‚   â€¢ Use for request-response patterns                           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Best Practices

### 6.1 Producer Best Practices

| Practice | MÃ´ táº£ |
|----------|-------|
| **Batch Messages** | Sá»­ dá»¥ng `SendMessageBatch` (up to 10 msgs) |
| **Message Deduplication** | Set Deduplication ID cho FIFO |
| **Handle Throttling** | Implement exponential backoff |
| **Message Size** | Keep < 256KB, use S3 for larger |

### 6.2 Consumer Best Practices

| Practice | MÃ´ táº£ |
|----------|-------|
| **Long Polling** | Set `WaitTimeSeconds` = 20 |
| **Batch Receive** | `MaxNumberOfMessages` = 10 |
| **Visibility Timeout** | Set > processing time |
| **Delete After Process** | Always delete successful messages |
| **DLQ** | Configure for failed messages |

### 6.3 Scaling Patterns

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SCALING CONSUMERS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Horizontal Scaling:                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                    SQS Queue                            â”‚  â”‚
â”‚   â”‚ (ApproximateNumberOfMessages = queue depth)             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚         â”‚         â”‚         â”‚         â”‚              â”‚
â”‚         â†“         â†“         â†“         â†“         â†“              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚Consumer1â”‚ â”‚Consumer2â”‚ â”‚Consumer3â”‚ â”‚Consumer4â”‚ â”‚Consumer5â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   Auto Scaling with CloudWatch:                                 â”‚
â”‚   â€¢ Metric: ApproximateNumberOfMessagesVisible                  â”‚
â”‚   â€¢ Alarm â†’ Scale EC2/ECS tasks                                 â”‚
â”‚   â€¢ Target Tracking: messages per consumer                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 Auto Scaling Consumers vá»›i CloudWatch Alarms

> [!IMPORTANT]
> **Tá»± Ä‘á»™ng scale consumer** lÃ  key pattern Ä‘á»ƒ SQS hoáº¡t Ä‘á»™ng hiá»‡u quáº£ vá»›i workload biáº¿n Ä‘á»™ng. AWS cung cáº¥p cÃ¡c SQS metrics trong CloudWatch Ä‘á»ƒ báº¡n cÃ³ thá»ƒ setup Auto Scaling.

#### 6.4.1 SQS Metrics trong CloudWatch

| Metric | MÃ´ táº£ | Use Case |
|--------|-------|----------|
| **ApproximateNumberOfMessagesVisible** | Sá»‘ messages sáºµn sÃ ng Ä‘á»ƒ receive | Scale-out trigger chÃ­nh |
| **ApproximateNumberOfMessagesNotVisible** | Sá»‘ messages Ä‘ang "in-flight" (Ä‘ang xá»­ lÃ½) | Monitor processing capacity |
| **ApproximateAgeOfOldestMessage** | Tuá»•i cá»§a message cÅ© nháº¥t (giÃ¢y) | PhÃ¡t hiá»‡n bottleneck |
| **NumberOfMessagesSent** | Sá»‘ messages gá»­i vÃ o queue | Monitor producer throughput |
| **NumberOfMessagesDeleted** | Sá»‘ messages xÃ³a khá»i queue | Monitor consumer throughput |
| **NumberOfMessagesReceived** | Sá»‘ messages Ä‘Æ°á»£c consumer nháº­n | Monitor polling activity |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           CLOUDWATCH METRICS FLOW                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   SQS Queue                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ [A] [B] [C] [D] [E] [F] [G] [H] [I] [J]               â”‚    â”‚
â”‚   â”‚      â†“                                                â”‚    â”‚
â”‚   â”‚ ApproximateNumberOfMessagesVisible = 10               â”‚    â”‚
â”‚   â”‚ ApproximateAgeOfOldestMessage = 300s                  â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                       â†“                                         â”‚
â”‚              CloudWatch Metrics                                 â”‚
â”‚                       â†“                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ CloudWatch Alarm: "Queue depth > 100 for 2 periods"   â”‚    â”‚
â”‚   â”‚                       â†“                               â”‚    â”‚
â”‚   â”‚ Trigger â†’ Auto Scaling Group â†’ Launch new EC2         â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.4.2 Custom Metric: Messages Per Consumer (Backlog Per Instance)

> [!TIP]
> **AWS Recommended Metric:** Thay vÃ¬ dÃ¹ng `ApproximateNumberOfMessagesVisible` Ä‘Æ¡n thuáº§n, AWS khuyáº¿n nghá»‹ tÃ­nh **Backlog per Instance** Ä‘á»ƒ scale chÃ­nh xÃ¡c hÆ¡n.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           BACKLOG PER INSTANCE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   CÃ´ng thá»©c:                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                 ApproximateNumberOfMessagesVisible      â”‚  â”‚
â”‚   â”‚   Backlog = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚   â”‚                   Current Number of Consumers           â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   VÃ­ dá»¥:                                                        â”‚
â”‚   â€¢ Queue cÃ³ 1000 messages                                      â”‚
â”‚   â€¢ CÃ³ 5 consumers                                              â”‚
â”‚   â€¢ Backlog per instance = 1000 / 5 = 200 msgs/consumer         â”‚
â”‚                                                                 â”‚
â”‚   Target:                                                       â”‚
â”‚   â€¢ Náº¿u má»—i consumer xá»­ lÃ½ 50 msgs/phÃºt                         â”‚
â”‚   â€¢ Target backlog = 100 (â‰ˆ 2 phÃºt xá»­ lÃ½)                       â”‚
â”‚   â€¢ Khi backlog > 100 â†’ Scale OUT                               â”‚
â”‚   â€¢ Khi backlog < 100 â†’ Scale IN                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Publish Custom Metric Example (Lambda):**
```python
import boto3

def publish_backlog_metric():
    cloudwatch = boto3.client('cloudwatch')
    sqs = boto3.client('sqs')
    asg = boto3.client('autoscaling')
    
    # Get queue depth
    response = sqs.get_queue_attributes(
        QueueUrl='https://sqs.region.amazonaws.com/account/my-queue',
        AttributeNames=['ApproximateNumberOfMessagesVisible']
    )
    queue_depth = int(response['Attributes']['ApproximateNumberOfMessagesVisible'])
    
    # Get current ASG capacity
    asg_response = asg.describe_auto_scaling_groups(
        AutoScalingGroupNames=['my-consumer-asg']
    )
    capacity = asg_response['AutoScalingGroups'][0]['DesiredCapacity']
    
    # Calculate backlog per instance
    backlog = queue_depth / max(capacity, 1)
    
    # Publish custom metric
    cloudwatch.put_metric_data(
        Namespace='Custom/SQS',
        MetricData=[{
            'MetricName': 'BacklogPerInstance',
            'Value': backlog,
            'Unit': 'Count',
            'Dimensions': [
                {'Name': 'QueueName', 'Value': 'my-queue'},
                {'Name': 'AutoScalingGroupName', 'Value': 'my-consumer-asg'}
            ]
        }]
    )
```

#### 6.4.3 CloudWatch Alarm Setup

**Scale-Out Alarm:**
```yaml
# CloudFormation Example
ScaleOutAlarm:
  Type: AWS::CloudWatch::Alarm
  Properties:
    AlarmName: SQS-HighBacklog-ScaleOut
    AlarmDescription: Scale out when queue depth is high
    MetricName: ApproximateNumberOfMessagesVisible
    Namespace: AWS/SQS
    Dimensions:
      - Name: QueueName
        Value: !Ref MyQueue
    Statistic: Average
    Period: 60                    # Check má»—i 60s
    EvaluationPeriods: 2          # Cáº§n 2 periods liÃªn tiáº¿p
    Threshold: 100                # > 100 messages
    ComparisonOperator: GreaterThanThreshold
    AlarmActions:
      - !Ref ScaleOutPolicy       # Trigger scale-out policy

ScaleInAlarm:
  Type: AWS::CloudWatch::Alarm
  Properties:
    AlarmName: SQS-LowBacklog-ScaleIn
    MetricName: ApproximateNumberOfMessagesVisible
    Namespace: AWS/SQS
    Dimensions:
      - Name: QueueName
        Value: !Ref MyQueue
    Statistic: Average
    Period: 300                   # Check má»—i 5 phÃºt
    EvaluationPeriods: 3          # Cáº§n 3 periods (15 phÃºt)
    Threshold: 10                 # < 10 messages
    ComparisonOperator: LessThanThreshold
    AlarmActions:
      - !Ref ScaleInPolicy        # Trigger scale-in policy
```

#### 6.4.4 Auto Scaling Policies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AUTO SCALING POLICY TYPES                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   1. TARGET TRACKING SCALING (Recommended):                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ "Giá»¯ backlog per instance = 100"                        â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚ â€¢ AWS tá»± Ä‘á»™ng scale Ä‘á»ƒ duy trÃ¬ target                   â”‚  â”‚
â”‚   â”‚ â€¢ Tá»± Ä‘á»™ng táº¡o CloudWatch alarms                         â”‚  â”‚
â”‚   â”‚ â€¢ Cooldown tá»± Ä‘á»™ng                                      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   2. STEP SCALING:                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ IF queue_depth 100-500   â†’ Add 1 instance               â”‚  â”‚
â”‚   â”‚ IF queue_depth 500-1000  â†’ Add 2 instances              â”‚  â”‚
â”‚   â”‚ IF queue_depth > 1000    â†’ Add 5 instances              â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚ â€¢ Scale theo má»©c Ä‘á»™ severity                            â”‚  â”‚
â”‚   â”‚ â€¢ Cáº§n define CloudWatch alarms riÃªng                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â”‚   3. SIMPLE SCALING:                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ IF alarm triggered â†’ Add/Remove X instances             â”‚  â”‚
â”‚   â”‚                                                         â”‚  â”‚
â”‚   â”‚ â€¢ ÄÆ¡n giáº£n nháº¥t                                         â”‚  â”‚
â”‚   â”‚ â€¢ CÃ³ cooldown cá»©ng                                      â”‚  â”‚
â”‚   â”‚ â€¢ KhÃ´ng linh hoáº¡t                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Target Tracking Policy Example (CloudFormation):**
```yaml
TargetTrackingPolicy:
  Type: AWS::AutoScaling::ScalingPolicy
  Properties:
    AutoScalingGroupName: !Ref MyConsumerASG
    PolicyType: TargetTrackingScaling
    TargetTrackingConfiguration:
      TargetValue: 100                    # Target: 100 msgs/consumer
      CustomizedMetricSpecification:
        MetricName: BacklogPerInstance
        Namespace: Custom/SQS
        Dimensions:
          - Name: QueueName
            Value: !Ref MyQueue
        Statistic: Average
      ScaleOutCooldown: 60                # Wait 60s trÆ°á»›c khi scale-out tiáº¿p
      ScaleInCooldown: 300                # Wait 5 phÃºt trÆ°á»›c khi scale-in
```

**Step Scaling Policy Example:**
```yaml
StepScalingPolicy:
  Type: AWS::AutoScaling::ScalingPolicy
  Properties:
    AutoScalingGroupName: !Ref MyConsumerASG
    PolicyType: StepScaling
    AdjustmentType: ChangeInCapacity
    StepAdjustments:
      - MetricIntervalLowerBound: 0
        MetricIntervalUpperBound: 400     # 100-500 msgs
        ScalingAdjustment: 1              # Add 1 instance
      - MetricIntervalLowerBound: 400
        MetricIntervalUpperBound: 900     # 500-1000 msgs
        ScalingAdjustment: 2              # Add 2 instances
      - MetricIntervalLowerBound: 900     # > 1000 msgs
        ScalingAdjustment: 5              # Add 5 instances
```

#### 6.4.5 Kiáº¿n trÃºc hoÃ n chá»‰nh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SQS AUTO SCALING ARCHITECTURE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚   Producer   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚              SQS Queue                   â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  ApproximateNumberOfMessagesVisible: 500 â”‚ â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                              â”‚                           â”‚
â”‚                                              â†“                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                      CloudWatch                                   â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚  â”‚ Metric: ApproximateNumberOfMessagesVisible = 500           â”‚ â”‚  â”‚
â”‚   â”‚  â”‚ Custom Metric: BacklogPerInstance = 500/2 = 250            â”‚ â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚         â”‚                                                        â”‚  â”‚
â”‚   â”‚         â†“                                                        â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚  â”‚ Alarm: BacklogPerInstance > 100 for 2 periods â†’ ALARM!     â”‚ â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚               â”‚                                                          â”‚
â”‚               â†“                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                   Auto Scaling Group                              â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚  â”‚ Target Tracking Policy: BacklogPerInstance = 100            â”‚ â”‚  â”‚
â”‚   â”‚  â”‚                                                             â”‚ â”‚  â”‚
â”‚   â”‚  â”‚ Min: 1    Desired: 2 â†’ 5    Max: 20                         â”‚ â”‚  â”‚
â”‚   â”‚  â”‚                 â†“                                           â”‚ â”‚  â”‚
â”‚   â”‚  â”‚ Launch 3 new EC2 instances!                                 â”‚ â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                                                                   â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚   â”‚  â”‚Consumer1â”‚ â”‚Consumer2â”‚ â”‚Consumer3â”‚ â”‚Consumer4â”‚ â”‚Consumer5â”‚    â”‚  â”‚
â”‚   â”‚  â”‚  (old)  â”‚ â”‚  (old)  â”‚ â”‚  (new)  â”‚ â”‚  (new)  â”‚ â”‚  (new)  â”‚    â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â”‚   Sau khi scale: BacklogPerInstance = 500/5 = 100 âœ“ (Ä‘áº¡t target)        â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 6.4.6 Best Practices cho Auto Scaling

| Practice | MÃ´ táº£ |
|----------|-------|
| **Use Target Tracking** | AWS tá»± Ä‘á»™ng tÃ­nh toÃ¡n scale, Ã­t phá»©c táº¡p hÆ¡n |
| **Custom Metric (Backlog/Instance)** | ChÃ­nh xÃ¡c hÆ¡n raw queue depth |
| **Longer Scale-In Cooldown** | 5-10 phÃºt Ä‘á»ƒ trÃ¡nh flapping |
| **Short Scale-Out Cooldown** | 60s Ä‘á»ƒ pháº£n á»©ng nhanh vá»›i traffic burst |
| **Set Min Capacity â‰¥ 1** | LuÃ´n cÃ³ consumer Ä‘á»ƒ xá»­ lÃ½ message |
| **Monitor OldestMessage Age** | Alert náº¿u messages quÃ¡ cÅ© â†’ bottleneck |
| **Use Predictive Scaling** | Cho workload cÃ³ pattern (vd: daily peak) |

> [!WARNING]
> **Äá»«ng scale dá»±a trÃªn CPU/Memory!**
>
> Vá»›i SQS consumers, CPU/Memory thÆ°á»ng KHÃ”NG pháº£n Ã¡nh Ä‘Ãºng workload:
> - Consumer cÃ³ thá»ƒ idle (chá» messages) â†’ CPU tháº¥p, nhÆ°ng cáº§n scale OUT
> - Consumer Ä‘ang xá»­ lÃ½ â†’ CPU cao, nhÆ°ng queue depth tháº¥p â†’ KHÃ”NG cáº§n scale
>
> **LuÃ´n scale dá»±a trÃªn Queue Depth hoáº·c Backlog per Instance!**

### 6.5 Cost Optimization

| Strategy | Description |
|----------|-------------|
| **Long Polling** | Reduces API calls (saves $$$) |
| **Batch Operations** | 10 messages = 1 API call |
| **Right-size Visibility Timeout** | Avoid unnecessary retries |
| **Delete Messages Promptly** | Don't pay for storage |

---

## 7. Spring Boot Integration

### 7.1 Spring Boot lÃ m SQS Consumer (HOÃ€N TOÃ€N ÄÆ¯á»¢C!)

> **âš ï¸ LÆ°u Ã½:** Nhiá»u ngÆ°á»i láº§m tÆ°á»Ÿng SQS chá»‰ dÃ¹ng Ä‘Æ°á»£c vá»›i Lambda. Thá»±c táº¿ báº¡n **HOÃ€N TOÃ€N CÃ“ THá»‚** dÃ¹ng Spring Boot (hoáº·c báº¥t ká»³ app nÃ o) lÃ m consumer!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SPRING BOOT + SQS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   SQS Queue                         Spring Boot App             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  [A] [B]  â”‚  â†â”€â”€ POLL â”€â”€â”€â”€â”€â”€â”€â”€â”‚ @SqsListener          â”‚   â”‚
â”‚   â”‚  [C] [D]  â”‚      (long poll)   â”‚                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ public void process(  â”‚   â”‚
â”‚                                    â”‚   String message) {   â”‚   â”‚
â”‚                                    â”‚   // xá»­ lÃ½ message    â”‚   â”‚
â”‚                                    â”‚ }                     â”‚   â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚   ThÆ° viá»‡n: spring-cloud-aws-messaging hoáº·c aws-sdk-java       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Code Example

**Maven dependency:**
```xml
<dependency>
    <groupId>io.awspring.cloud</groupId>
    <artifactId>spring-cloud-aws-messaging</artifactId>
    <version>3.0.0</version>
</dependency>
```

**Consumer code:**
```java
@Component
public class OrderConsumer {

    @SqsListener("order-queue")
    public void processOrder(String message) {
        log.info("Received order: {}", message);
        // Xá»­ lÃ½ order
        orderService.process(message);
        // Message tá»± Ä‘á»™ng Ä‘Æ°á»£c delete sau khi method return success
    }
    
    // Hoáº·c vá»›i object mapping:
    @SqsListener("order-queue")
    public void processOrder(Order order) {
        orderService.process(order);
    }
}
```

### 7.3 So sÃ¡nh Consumer Types

| Consumer Type | Use Case | Pros | Cons |
|---------------|----------|------|------|
| **Spring Boot + SQS** | Long-running apps, microservices | Full control, existing infrastructure | Manage scaling yourself |
| **Lambda + SQS Trigger** | Serverless, event-driven | Auto-scaling, pay per use | Cold start, 15 min timeout |
| **ECS/EKS + SQS** | Containerized workloads | Container orchestration | More complex setup |

### 7.4 Kafka vs SQS - Äiá»ƒm khÃ¡c biá»‡t THá»°C Sá»°

> KhÃ¡c biá»‡t **KHÃ”NG PHáº¢I** lÃ  Spring Boot cÃ³ thá»ƒ lÃ m consumer hay khÃ´ng (Ä‘á»u Ä‘Æ°á»£c!), mÃ  lÃ :

| | **Kafka** | **SQS** |
|---|-----------|---------|
| **Consumer library** | `@KafkaListener` | `@SqsListener` |
| **Sau khi Ä‘á»c** | Message VáºªN CÃ’N | Message Bá»Š XÃ“A |
| **Consumer Groups** | âœ… Native | âŒ KhÃ´ng cÃ³ |
| **Replay** | âœ… CÃ³ | âŒ KhÃ´ng |
| **Nhiá»u apps Ä‘á»c cÃ¹ng data** | âœ… Dá»… dÃ ng | âŒ Pháº£i dÃ¹ng SNS fan-out |

```
KAFKA:    Topic â”€â”¬â†’ App A (Ä‘á»c táº¥t cáº£)   â† CÃ™NG DATA
                 â””â†’ App B (Ä‘á»c táº¥t cáº£)   â† CÃ™NG DATA
                 
SQS:      Queue â”€â†’ App A hoáº·c App B (Má»–I msg chá»‰ 1 app nháº­n)
                 
SNS+SQS:  SNS â”€â”¬â†’ Queue A â†’ App A (nháº­n copy)
              â””â†’ Queue B â†’ App B (nháº­n copy)
```

---

## 8. SQS vs SNS vs Kinesis

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SQS vs SNS vs KINESIS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   SQS:                                                          â”‚
â”‚   â€¢ Consumer "pulls" messages                                   â”‚
â”‚   â€¢ Messages deleted after consumed                             â”‚
â”‚   â€¢ No need to provision throughput                             â”‚
â”‚   â€¢ Ordering only with FIFO                                     â”‚
â”‚                                                                 â”‚
â”‚   SNS:                                                          â”‚
â”‚   â€¢ "Push" to subscribers                                       â”‚
â”‚   â€¢ No persistence (instant delivery)                           â”‚
â”‚   â€¢ Many subscribers (fan-out)                                  â”‚
â”‚   â€¢ Up to 12,500,000 subscribers                                â”‚
â”‚                                                                 â”‚
â”‚   Kinesis Data Streams:                                         â”‚
â”‚   â€¢ Consumer "pulls" data                                       â”‚
â”‚   â€¢ Data persists (replay capability)                           â”‚
â”‚   â€¢ Provisioned throughput (shards)                             â”‚
â”‚   â€¢ Ordering at shard level                                     â”‚
â”‚   â€¢ Real-time big data streaming                                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Feature | SQS | SNS | Kinesis |
|---------|-----|-----|---------|
| **Model** | Pull (poll) | Push | Pull |
| **Persistence** | Yes (14 days) | No | Yes (1-365 days) |
| **Consumers** | 1 per message | Many (fan-out) | Many (shared) |
| **Ordering** | FIFO only | No | Per shard |
| **Replay** | No | No | Yes |
| **Throughput** | Unlimited | Unlimited | Provisioned |
| **Use Case** | Decoupling | Notifications | Streaming |

---

## 8. SQS Message Distribution & So sÃ¡nh vá»›i Kafka

### 8.1 SQS lÃ  Point-to-Point (KHÃ”NG pháº£i Fan-out)

> **âš ï¸ LÆ°u Ã½ quan trá»ng:** SQS KHÃ”NG gá»­i message Ä‘áº¿n táº¥t cáº£ consumers. Má»—i message chá»‰ Ä‘Æ°á»£c **Má»˜T** consumer xá»­ lÃ½.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SQS: POINT-TO-POINT                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Producer sends: [A] [B] [C] [D] [E]                           â”‚
â”‚                         â†“                                       â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                   â”‚ SQS Queue â”‚                                 â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                    â†“    â†“    â†“                                  â”‚
â”‚              Consumer1  Consumer2  Consumer3                    â”‚
â”‚                 [A]       [B]        [C]                        â”‚
â”‚                 [D]       [E]                                   â”‚
â”‚                                                                 â”‚
â”‚   â†’ Má»—i message CHá»ˆ Ä‘Æ°á»£c 1 consumer nháº­n & xá»­ lÃ½                â”‚
â”‚   â†’ Sau khi xá»­ lÃ½ xong, message bá»‹ XÃ“A khá»i queue               â”‚
â”‚   â†’ Consumers chia nhau xá»­ lÃ½ (load balancing)                  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 Náº¿u muá»‘n Fan-out (1 message â†’ nhiá»u consumers)?

Sá»­ dá»¥ng **SNS + SQS Pattern**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SNS + SQS FAN-OUT PATTERN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Producer sends: [Order Created]                               â”‚
â”‚                         â†“                                       â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚                   â”‚ SNS Topic â”‚  â† Publish 1 láº§n                â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                    â†“    â†“    â†“                                  â”‚
â”‚               â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”                              â”‚
â”‚               â”‚SQS1â”‚ â”‚SQS2â”‚ â”‚SQS3â”‚ â† Má»—i queue nháº­n COPY        â”‚
â”‚               â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜                              â”‚
â”‚                 â†“      â†“      â†“                                 â”‚
â”‚            Analytics Billing Inventory                          â”‚
â”‚                                                                 â”‚
â”‚   â†’ 1 message gá»­i Ä‘áº¿n SNS                                       â”‚
â”‚   â†’ Táº¤T Cáº¢ SQS queues Ä‘á»u nháº­n copy cá»§a message Ä‘Ã³              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 SQS KHÃ”NG cÃ³ Topic vÃ  Consumer Group nhÆ° Kafka

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KAFKA ARCHITECTURE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Topic "orders"                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ Partition 0: [msg1] [msg4] [msg7]                       â”‚  â”‚
â”‚   â”‚ Partition 1: [msg2] [msg5] [msg8]                       â”‚  â”‚
â”‚   â”‚ Partition 2: [msg3] [msg6] [msg9]                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â†“                  â†“                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚        â”‚ Consumer Group A â”‚  â”‚ Consumer Group B â”‚              â”‚
â”‚        â”‚ (Each gets ALL)  â”‚  â”‚ (Each gets ALL)  â”‚              â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                 â”‚
â”‚   Kafka features:                                               â”‚
â”‚   â†’ Topic: logical channel for messages                         â”‚
â”‚   â†’ Consumer Group: má»—i group nháº­n Táº¤T Cáº¢ messages              â”‚
â”‚   â†’ Consumers trong group chia partition                        â”‚
â”‚   â†’ Messages Ä‘Æ°á»£c giá»¯ láº¡i, cÃ³ thá»ƒ replay                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SQS ARCHITECTURE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Queue "orders-queue"                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ [msg1] [msg2] [msg3] [msg4] [msg5] ...                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†“         â†“         â†“                              â”‚
â”‚         Consumer1  Consumer2  Consumer3                         â”‚
â”‚           [msg1]     [msg2]     [msg3]                          â”‚
â”‚                                                                 â”‚
â”‚   SQS limitations:                                              â”‚
â”‚   â†’ KHÃ”NG cÃ³ Topic (1 queue = 1 channel)                        â”‚
â”‚   â†’ KHÃ”NG cÃ³ Consumer Group                                     â”‚
â”‚   â†’ Message bá»‹ XÃ“A sau khi xá»­ lÃ½                                â”‚
â”‚   â†’ KHÃ”NG thá»ƒ replay                                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 Báº£ng so sÃ¡nh SQS vs Kafka

| Feature | **Kafka** | **SQS** | **AWS tÆ°Æ¡ng Ä‘Æ°Æ¡ng** |
|---------|-----------|---------|---------------------|
| **Topic** | âœ… CÃ³ | âŒ KhÃ´ng | **SNS Topic** |
| **Consumer Group** | âœ… CÃ³ | âŒ KhÃ´ng | KhÃ´ng cÃ³ tÆ°Æ¡ng Ä‘Æ°Æ¡ng |
| **Partitions** | âœ… CÃ³ | âŒ KhÃ´ng | **FIFO Message Group ID** (tÆ°Æ¡ng tá»±) |
| **Message Replay** | âœ… CÃ³ | âŒ KhÃ´ng | **Kinesis Data Streams** |
| **Message Retention** | Days - Years | Max 14 days | Kinesis: 1-365 days |
| **Ordering** | Per partition | FIFO queues only | Kinesis: Per shard |
| **Multiple Consumer Groups** | âœ… CÃ³ | âŒ KhÃ´ng | SNS + nhiá»u SQS queues |
| **Throughput** | Very high | Unlimited | Kinesis: Provisioned |

### 8.5 Khi nÃ o dÃ¹ng gÃ¬?

| Use Case | Recommend |
|----------|-----------|
| Simple decoupling, task queue | **SQS** |
| Need message replay | **Kinesis** hoáº·c **MSK** |
| Need Consumer Groups | **Kinesis** hoáº·c **MSK** |
| Fan-out to multiple services | **SNS + SQS** |
| Real-time streaming analytics | **Kinesis** |
| Full Kafka compatibility | **Amazon MSK** |

### 8.6 AWS Alternatives cho Kafka-like behavior

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          AWS OPTIONS FOR KAFKA-LIKE BEHAVIOR                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   1. KINESIS DATA STREAMS (AWS Native):                         â”‚
â”‚      â€¢ Shards â‰ˆ Partitions                                      â”‚
â”‚      â€¢ Data replay âœ…                                           â”‚
â”‚      â€¢ Ordering per shard âœ…                                    â”‚
â”‚      â€¢ Multiple consumers (Enhanced Fan-out) âœ…                 â”‚
â”‚      â€¢ Retention: 1-365 days                                    â”‚
â”‚                                                                 â”‚
â”‚   2. AMAZON MSK (Managed Kafka):                                â”‚
â”‚      â€¢ Actual Kafka on AWS                                      â”‚
â”‚      â€¢ 100% Kafka API compatible                                â”‚
â”‚      â€¢ Topics, Consumer Groups, Partitions âœ…                   â”‚
â”‚      â€¢ Use existing Kafka code                                  â”‚
â”‚                                                                 â”‚
â”‚   3. SNS + SQS (Fan-out Pattern):                               â”‚
â”‚      â€¢ Fan-out to multiple queues âœ…                            â”‚
â”‚      â€¢ Each queue = independent consumer                        â”‚
â”‚      â€¢ No replay, no ordering guarantee                         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. Common Exam Questions

### Q1: Standard vs FIFO Queue?
**A:** Standard = unlimited throughput, at-least-once, best-effort ordering. FIFO = 300 msg/s, exactly-once, guaranteed ordering.

### Q2: Visibility Timeout default?
**A:** 30 seconds (min: 0s, max: 12 hours)

### Q3: How to enable Long Polling?
**A:** Set `ReceiveMessageWaitTimeSeconds` > 0 (1-20 seconds)

### Q4: DLQ lÃ  gÃ¬?
**A:** Queue chá»©a messages failed processing sau `maxReceiveCount` retries

### Q5: Max message size?
**A:** 256 KB. Use S3 + Extended Client for larger.

### Q6: Message retention default/max?
**A:** Default: 4 days. Max: 14 days.

---

## TÃ i liá»‡u tham kháº£o

- [Amazon SQS Developer Guide](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/)
- [SQS Best Practices](https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-best-practices.html)
- [SQS FAQs](https://aws.amazon.com/sqs/faqs/)
