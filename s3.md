# Amazon S3 (Simple Storage Service)


## Má»¥c lá»¥c

- [Tá»•ng quan](#tá»•ng-quan)
- [CÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n](#cÃ¡c-khÃ¡i-niá»‡m-cÆ¡-báº£n)
- [Storage Classes](#storage-classes)
- [Storage Management](#storage-management)
- [Access Management & Security](#access-management-security)
- [S3 Performance](#s3-performance)
- [Data Processing](#data-processing)
  - [S3 Object Lambda](#s3-object-lambda)
  - [Event Notifications](#event-notifications)
- [Monitoring & Analytics](#monitoring-analytics)
- [Data Consistency](#data-consistency)
- [Pricing](#pricing)
- [Requester Pays](#requester-pays)
- [Best Practices](#best-practices)
- [S3 Transfer Acceleration](#s3-transfer-acceleration)
- [So sÃ¡nh vá»›i EBS vÃ  EFS](#so-sÃ¡nh-vá»›i-ebs-vÃ -efs)
- [LiÃªn káº¿t](#liÃªn-káº¿t)
- [TÃ i liá»‡u tham kháº£o](#tÃ i-liá»‡u-tham-kháº£o)

---

## Tá»•ng quan

Amazon S3 lÃ  dá»‹ch vá»¥ **object storage** vá»›i kháº£ nÄƒng má»Ÿ rá»™ng khÃ´ng giá»›i háº¡n, Ä‘á»™ bá»n dá»¯ liá»‡u cao (99.999999999% - 11 nines), vÃ  hiá»‡u suáº¥t tá»‘t. S3 lÃ  má»™t trong nhá»¯ng dá»‹ch vá»¥ cá»‘t lÃµi vÃ  phá»• biáº¿n nháº¥t cá»§a AWS.

### Durability 11 nines lÃ  gÃ¬?

**99.999999999% durability** cÃ³ nghÄ©a: náº¿u lÆ°u 10 triá»‡u objects, thá»‘ng kÃª báº¡n sáº½ máº¥t 1 object má»—i 10,000 nÄƒm.

AWS Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u nÃ y báº±ng cÃ¡ch **tá»± Ä‘á»™ng replicate má»—i object sang â‰¥3 Availability Zones** trong cÃ¹ng Region - báº¡n khÃ´ng cáº§n cáº¥u hÃ¬nh gÃ¬.

### Erasure Coding - Ká»¹ thuáº­t Ä‘áº±ng sau 11 nines

AWS sá»­ dá»¥ng **Erasure Coding** thay vÃ¬ replicate 3 báº£n copy Ä‘áº§y Ä‘á»§, giÃºp tiáº¿t kiá»‡m storage vÃ  váº«n Ä‘áº¡t durability cao.

**CÃ¡ch hoáº¡t Ä‘á»™ng (vÃ­ dá»¥ cáº¥u hÃ¬nh 5+4):**

```
Original file: 1 GB
      â†“
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ D1  â”‚ D2  â”‚ D3  â”‚ D4  â”‚ D5  â”‚ P1  â”‚ P2  â”‚ P3  â”‚ P4  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
  5 data chunks        +      4 parity chunks

Total: 9 chunks phÃ¢n tÃ¡n qua â‰¥3 AZs
Storage overhead: 180% (thay vÃ¬ 300% vá»›i 3x replication)
```

**Fault Tolerance:**

| Máº¥t chunks | Chunks cÃ²n láº¡i | Káº¿t quáº£ |
|------------|---------------|---------|
| 0-4 | 5-9 | âœ… Recover Ä‘Æ°á»£c |
| **5+** | **< 5** | âŒ **Máº¥t data** |

> Cáº§n Ã­t nháº¥t **5 chunks báº¥t ká»³** Ä‘á»ƒ rebuild data gá»‘c.

**Táº¡i sao váº«n Ä‘áº¡t 11 nines?**
- Chunks phÃ¢n tÃ¡n cross-AZ â†’ máº¥t cáº£ 1 AZ váº«n OK
- **Auto-healing**: AWS liÃªn tá»¥c check vÃ  rebuild chunks bá»‹ corrupt
- XÃ¡c suáº¥t máº¥t 5+ chunks Ä‘á»“ng thá»i: ~10^-15

> âš ï¸ **LÆ°u Ã½**: AWS khÃ´ng cÃ´ng bá»‘ chÃ­nh xÃ¡c cáº¥u hÃ¬nh erasure coding. 5+4 lÃ  thÃ´ng tin tá»« nguá»“n phÃ¢n tÃ­ch bÃªn ngoÃ i.

### CÃ¡c ká»¹ thuáº­t Internal khÃ¡c cá»§a S3

#### 1. Checksums & Data Integrity

S3 sá»­ dá»¥ng checksums Ä‘á»ƒ Ä‘áº£m báº£o data khÃ´ng bá»‹ corrupt:

```
UPLOAD:
  Client tÃ­nh checksum (MD5, SHA-256, CRC32...)
       â†“
  Gá»­i file + checksum lÃªn S3
       â†“
  S3 tÃ­nh láº¡i checksum trÃªn server
       â†“
  So sÃ¡nh: khá»›p â†’ store | khÃ´ng khá»›p â†’ reject âŒ

DATA AT REST (liÃªn tá»¥c):
  Background job quÃ©t storage
       â†“
  PhÃ¡t hiá»‡n "bit rot" (data corrupt theo thá»i gian)
       â†“
  Tá»± Ä‘á»™ng repair tá»« chunk á»Ÿ AZ khÃ¡c
```

#### 2. Shuffle Sharding - Giáº£m "Blast Radius"

Thay vÃ¬ assign cá»‘ Ä‘á»‹nh buckets vÃ o drives, AWS random assign:

```
FIXED (bad):                    SHUFFLE SHARDING (good):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Bucket A â†’ Drives {1, 2}        Bucket A â†’ Drives {1, 5} (random)
Bucket B â†’ Drives {1, 2}        Bucket B â†’ Drives {2, 7} (random)
                               
Náº¿u Drive 1,2 cháº¿t:             Náº¿u Drive 1,2 cháº¿t:
â†’ A,B máº¥t 100% âŒ               â†’ A máº¥t 50%, B máº¥t 50%
                                â†’ KhÃ´ng ai máº¥t hoÃ n toÃ n âœ…
```

**Lá»£i Ã­ch:**
- **Fault isolation**: Lá»—i khÃ´ng lan rá»™ng
- **Giáº£m blast radius**: Má»—i bucket chá»‰ bá»‹ áº£nh hÆ°á»Ÿng má»™t pháº§n

#### 3. Cell-based Architecture

S3 Ä‘Æ°á»£c chia thÃ nh cÃ¡c "cells" Ä‘á»™c láº­p:

```
AWS Region = "Supercell"
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Cell 1    â”‚  â”‚   Cell 2    â”‚  â”‚   Cell 3    â”‚
  â”‚  (S3 subset)â”‚  â”‚  (S3 subset)â”‚  â”‚  (S3 subset)â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              Cells KHÃ”NG share state
              Lá»—i Cell 1 khÃ´ng áº£nh hÆ°á»Ÿng Cell 2,3
```

#### 4. Two Random Choices (Load Balancing)

Khi cáº§n lÆ°u object vÃ o drive:

```
Step 1: Random chá»n 2 drives (A vÃ  B)
Step 2: Check utilization (% Ä‘Ã£ dÃ¹ng) cá»§a cáº£ 2
Step 3: Chá»n drive cÃ³ utilization THáº¤P hÆ¡n

VÃ­ dá»¥:
  Drive A: 75% full â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘
  Drive B: 30% full â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  â†’ Chá»n Drive B (cÃ²n trá»‘ng nhiá»u hÆ¡n)
```

**Táº¡i sao chá»‰ cáº§n 2?**
- Random 1: CÃ³ thá»ƒ chá»n trÃºng drive Ä‘Ã£ full
- Check táº¥t cáº£: QuÃ¡ cháº­m (hÃ ng nghÃ¬n drives)
- **Two Random Choices**: Nhanh + load khÃ¡ Ä‘á»u (toÃ¡n há»c chá»©ng minh!)

#### Tá»•ng káº¿t cÃ¡c ká»¹ thuáº­t

| Ká»¹ thuáº­t | Má»¥c Ä‘Ã­ch |
|----------|----------|
| **Erasure Coding** | Durability vá»›i Ã­t storage overhead |
| **Checksums** | PhÃ¡t hiá»‡n vÃ  sá»­a data corruption |
| **Shuffle Sharding** | Fault isolation, giáº£m blast radius |
| **Cell Architecture** | Isolate failures giá»¯a cÃ¡c cells |
| **Two Random Choices** | Load balancing storage |

**Ngoáº¡i lá»‡** (chá»‰ lÆ°u trong 1 AZ, durability tháº¥p hÆ¡n náº¿u AZ gáº·p sá»± cá»‘):
- S3 One Zone-IA
- S3 Express One Zone

> **LÆ°u Ã½:** Durability â‰  Availability. S3 Standard cÃ³ 99.99% availability (cÃ³ thá»ƒ unavailable ~52 phÃºt/nÄƒm), nhÆ°ng data váº«n khÃ´ng bá»‹ máº¥t.

**Use cases phá»• biáº¿n:**
- Data lakes vÃ  big data analytics
- Backup vÃ  disaster recovery
- Static website hosting
- Archive vÃ  long-term storage
- Media hosting (images, videos)
- Application data storage

> **Nguá»“n:** [What is Amazon S3?](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html)

---

## CÃ¡c khÃ¡i niá»‡m cÆ¡ báº£n

### Buckets

- **Container** chá»©a cÃ¡c objects
- TÃªn bucket pháº£i **globally unique** trÃªn toÃ n bá»™ AWS
- Bucket Ä‘Æ°á»£c táº¡o trong má»™t **Region** cá»¥ thá»ƒ
- **4 loáº¡i bucket:**
  - **General purpose buckets** - bucket thÃ´ng thÆ°á»ng
  - **Directory buckets** - cho S3 Express One Zone (high performance)
  - **Table buckets** - cho tabular data
  - **Vector buckets** - cho vector storage (ML workloads)

### Objects

- ÄÆ¡n vá»‹ lÆ°u trá»¯ cÆ¡ báº£n trong S3
- Bao gá»“m: **data** + **key** (tÃªn) + **metadata**
- KÃ­ch thÆ°á»›c tá»‘i Ä‘a: **5 TB** per object
- Upload > 5GB pháº£i dÃ¹ng **multipart upload**

### Keys

- Unique identifier cho object trong bucket
- Full path: `s3://bucket-name/folder/subfolder/file.txt`
- Key = `folder/subfolder/file.txt`

### Versioning

- LÆ°u giá»¯ nhiá»u versions cá»§a cÃ¹ng má»™t object
- Báº£o vá»‡ khá»i xÃ³a nháº§m vÃ  overwrite
- Báº­t á»Ÿ **bucket level**
- Má»—i version cÃ³ **Version ID** riÃªng

---

## Storage Classes

S3 cung cáº¥p nhiá»u storage classes cho cÃ¡c use cases khÃ¡c nhau. Táº¥t cáº£ Ä‘á»u cÃ³ **durability 99.999999999%** (11 nines).

### Storage Class Ä‘Æ°á»£c chá»n á»Ÿ Ä‘Ã¢u?

> **LÆ°u Ã½:** Storage class Ä‘Æ°á»£c chá»n á»Ÿ **object level**, khÃ´ng pháº£i bucket level!

- Khi **upload object** â†’ chá»n storage class cho object Ä‘Ã³ (Properties â†’ Storage class)
- Hoáº·c dÃ¹ng **Lifecycle rules** Ä‘á»ƒ tá»± Ä‘á»™ng chuyá»ƒn objects giá»¯a cÃ¡c classes
- **Ngoáº¡i lá»‡:** S3 Express One Zone dÃ¹ng **Directory buckets** - loáº¡i bucket riÃªng, pháº£i chá»n khi táº¡o bucket

### Báº£ng so sÃ¡nh tá»•ng quan

| Storage Class | AZs | Availability | Min Duration | Min Billable Size | Retrieval Fee |
|---------------|-----|--------------|--------------|-------------------|---------------|
| **S3 Standard** | â‰¥3 | 99.99% | None | None | None |
| **S3 Express One Zone** | 1 | 99.95% | None | None | None |
| **S3 Intelligent-Tiering** | â‰¥3 | 99.9% | None | None | None |
| **S3 Standard-IA** | â‰¥3 | 99.9% | 30 days | 128 KB* | CÃ³ |
| **S3 One Zone-IA** | 1 | 99.5% | 30 days | 128 KB* | CÃ³ |
| **S3 Glacier Instant Retrieval** | â‰¥3 | 99.9% | 90 days | 128 KB* | CÃ³ |
| **S3 Glacier Flexible Retrieval** | â‰¥3 | 99.99%** | 90 days | +40 KB metadata | CÃ³ |
| **S3 Glacier Deep Archive** | â‰¥3 | 99.99%** | 180 days | +40 KB metadata | CÃ³ |

*Min billable size: Báº¡n váº«n upload Ä‘Æ°á»£c file nhá» hÆ¡n, nhÆ°ng bá»‹ **charge nhÆ° 128 KB**
**Sau khi restore

---

### 1. S3 Standard

**Use case:** Frequently accessed data (truy cáº­p > 1 láº§n/thÃ¡ng)

- Storage class **máº·c Ä‘á»‹nh**
- Millisecond access
- KhÃ´ng cÃ³ retrieval fee, min duration, min size
- Replicate across â‰¥3 AZs

**PhÃ¹ há»£p cho:** Websites, mobile apps, gaming, big data analytics

---

### 2. S3 Express One Zone

**Use case:** Ultra-low latency applications (single-digit milliseconds)

- **Nhanh nháº¥t** - latency tháº¥p hÆ¡n S3 Standard tá»›i 10x
- **Ráº» hÆ¡n 50%** request costs so vá»›i S3 Standard
- Chá»‰ lÆ°u trong **1 AZ** (báº¡n chá»n AZ nÃ o)
- DÃ¹ng vá»›i **Directory buckets** (khÃ´ng pháº£i general purpose buckets)

**Táº¡i sao nhanh hÆ¡n?**
- **Co-location** - chá»n cÃ¹ng AZ vá»›i EC2/EKS/Lambda â†’ khÃ´ng cÃ³ network latency cross-AZ
- **Custom hardware & software** - AWS thiáº¿t káº¿ riÃªng cho low-latency
- **Directory buckets** - kiáº¿n trÃºc má»›i, há»— trá»£ 2 triá»‡u reads + 200K writes/giÃ¢y
- **Session-based authorization** - giáº£m overhead authentication má»—i request

**Táº¡i sao chá»‰ 1 AZ?**

ÄÃ¢y lÃ  trade-off cÃ³ chá»§ Ä‘Ã­ch:
```
S3 Standard:  Write â†’ Replicate to AZ1, AZ2, AZ3 â†’ Confirm (slower, more durable)
S3 Express:   Write â†’ Replicate trong 1 AZ only â†’ Confirm (faster, less resilient)
```
Cross-AZ replication thÃªm network latency (vÃ i ms). Äá»ƒ Ä‘áº¡t single-digit ms, pháº£i bá» cross-AZ replication.

**PhÃ¹ há»£p cho:** ML training, real-time analytics, high-performance computing, cache/temporary data

**Trade-off:** KhÃ´ng resilient náº¿u AZ gáº·p sá»± cá»‘ - chá»‰ dÃ¹ng cho data cÃ³ thá»ƒ tÃ¡i táº¡o hoáº·c Ä‘Ã£ cÃ³ backup á»Ÿ nÆ¡i khÃ¡c

---

### 3. S3 Intelligent-Tiering

**Use case:** Data cÃ³ access patterns khÃ´ng biáº¿t trÆ°á»›c hoáº·c thay Ä‘á»•i

**"Access patterns khÃ´ng biáº¿t trÆ°á»›c" lÃ  gÃ¬?**

```
VÃ­ dá»¥ 1: E-commerce product images
- Sáº£n pháº©m má»›i upload â†’ access nhiá»u (hot)
- 3 thÃ¡ng sau â†’ cÃ³ thá»ƒ váº«n hot, cÃ³ thá»ƒ khÃ´ng ai xem
- Báº¡n KHÃ”NG BIáº¾T TRÆ¯á»šC sáº£n pháº©m nÃ o sáº½ bÃ¡n cháº¡y

VÃ­ dá»¥ 2: User-generated content (YouTube, TikTok)
- Video má»›i â†’ cÃ³ thá»ƒ viral (millions views) hoáº·c flop (10 views)
- Video cÅ© â†’ cÃ³ thá»ƒ bá»—ng viral láº¡i sau 1 nÄƒm
- Access pattern THAY Äá»”I liÃªn tá»¥c, khÃ´ng dá»± Ä‘oÃ¡n Ä‘Æ°á»£c
```

**Äáº·c Ä‘iá»ƒm:**
- **Tá»± Ä‘á»™ng** di chuyá»ƒn objects giá»¯a cÃ¡c tiers - khÃ´ng cáº§n quáº£n lÃ½
- **KhÃ´ng cÃ³ retrieval fees** (3 tiers Ä‘áº§u)
- CÃ³ **monitoring fee** nhá» per object (~$0.0025/1000 objects/month)
- Objects < 128 KB khÃ´ng Ä‘Æ°á»£c monitor, luÃ´n á»Ÿ Frequent Access tier

**5 Access Tiers (bÃªn trong Intelligent-Tiering, khÃ´ng pháº£i storage classes khÃ¡c):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           S3 Intelligent-Tiering (1 storage class) â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Frequent Access tier      â† upload vÃ o Ä‘Ã¢y   â”‚ â”‚
â”‚  â”‚  Infrequent Access tier    â† sau 30 ngÃ y      â”‚ â”‚
â”‚  â”‚  Archive Instant Access    â† sau 90 ngÃ y      â”‚ â”‚
â”‚  â”‚  Archive Access (optional) â† sau 90+ ngÃ y     â”‚ â”‚
â”‚  â”‚  Deep Archive (optional)   â† sau 180+ ngÃ y    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Tier | Khi nÃ o chuyá»ƒn | Retrieval |
|------|----------------|-----------|
| **Frequent Access** | Default khi upload | Milliseconds |
| **Infrequent Access** | Sau 30 ngÃ y khÃ´ng access | Milliseconds |
| **Archive Instant Access** | Sau 90 ngÃ y khÃ´ng access | Milliseconds |
| **Archive Access** (optional) | Sau 90+ ngÃ y, cáº§n activate | 3-5 hours |
| **Deep Archive Access** (optional) | Sau 180+ ngÃ y, cáº§n activate | 12 hours |

**LÆ°u Ã½:** Archive Access vÃ  Deep Archive Access tiers cáº§n **restore trÆ°á»›c** khi access.

**So sÃ¡nh Intelligent-Tiering vs Lifecycle Rules:**

| | Intelligent-Tiering | Lifecycle Rules |
|---|---------------------|-----------------|
| **Monitoring fee** | ~$0.0025/1000 objects/thÃ¡ng | KhÃ´ng |
| **Retrieval fee** | **KhÃ´ng** (3 tiers Ä‘áº§u) | **CÃ³** (tá»« IA, Glacier) |
| **Cáº¥u hÃ¬nh** | KhÃ´ng cáº§n | Pháº£i tá»± Ä‘á»‹nh nghÄ©a rules |
| **Di chuyá»ƒn** | Tá»± Ä‘á»™ng theo access thá»±c táº¿ | Theo thá»i gian cá»‘ Ä‘á»‹nh |

```
Khi nÃ o Intelligent-Tiering ráº» hÆ¡n:
- File cÃ³ thá»ƒ bá»‹ access báº¥t ngá»
- Lifecycle: Standard â†’ Standard-IA â†’ access â†’ tráº£ retrieval fee má»—i láº§n
- Intelligent-Tiering: access â†’ KHÃ”NG fee, tá»± chuyá»ƒn tier phÃ¹ há»£p

Khi nÃ o Lifecycle ráº» hÆ¡n:
- Biáº¿t cháº¯c 100% khÃ´ng access (vd: logs cÅ©)
- Lifecycle: Standard â†’ Glacier â†’ khÃ´ng tráº£ monitoring fee
```

**TÃ³m láº¡i:**
- **Biáº¿t cháº¯c access pattern** â†’ Lifecycle rules (tiáº¿t kiá»‡m monitoring fee)
- **KhÃ´ng biáº¿t / thay Ä‘á»•i** â†’ Intelligent-Tiering (tiáº¿t kiá»‡m retrieval fee)

---

### 4. S3 Standard-IA (Infrequent Access)

**Use case:** Long-lived data, truy cáº­p khÃ´ng thÆ°á»ng xuyÃªn (~1 láº§n/thÃ¡ng), cáº§n millisecond access

- GiÃ¡ storage **ráº» hÆ¡n S3 Standard**
- CÃ³ **retrieval fee** per GB
- **Min storage duration:** 30 ngÃ y (xÃ³a sá»›m váº«n bá»‹ charge 30 ngÃ y)
- **Min billable size:** 128 KB (object nhá» hÆ¡n váº«n bá»‹ charge 128 KB)
- Replicate across â‰¥3 AZs

**PhÃ¹ há»£p cho:** Backups, disaster recovery, older data cáº§n truy cáº­p nhanh

**Khi nÃ o dÃ¹ng:** Dá»¯ liá»‡u khÃ´ng thá»ƒ tÃ¡i táº¡o Ä‘Æ°á»£c

---

### 5. S3 One Zone-IA

**Use case:** Giá»‘ng Standard-IA nhÆ°ng cháº¥p nháº­n risk máº¥t data náº¿u AZ fail

- **Ráº» hÆ¡n ~20%** so vá»›i Standard-IA
- Chá»‰ lÆ°u trong **1 AZ**
- Min storage duration: 30 ngÃ y
- Min billable size: 128 KB

**PhÃ¹ há»£p cho:** 
- Secondary backup copies
- Data cÃ³ thá»ƒ tÃ¡i táº¡o Ä‘Æ°á»£c
- Cross-Region Replication destination

**Trade-off:** Máº¥t data náº¿u AZ bá»‹ destroy (Ä‘á»™ng Ä‘áº¥t, lÅ© lá»¥t)

---

### 6. S3 Glacier Instant Retrieval

**Use case:** Archive data, hiáº¿m khi access (~1 láº§n/quÃ½), nhÆ°ng cáº§n millisecond retrieval

- Storage cost **tháº¥p hÆ¡n Standard-IA 68%**
- **Millisecond access** - khÃ´ng cáº§n restore
- **Min storage duration:** 90 ngÃ y
- **Min billable size:** 128 KB
- Retrieval fee cao hÆ¡n Standard-IA

**PhÃ¹ há»£p cho:** Medical images, news media assets, user-generated content archives

---

### "Restore" lÃ  gÃ¬?

Má»™t sá»‘ storage classes (Glacier Flexible, Deep Archive) lÆ°u data trÃªn **cold storage** (cÃ³ thá»ƒ lÃ  tape) Ä‘á»ƒ giáº£m giÃ¡. Khi cáº§n access, pháº£i "restore" trÆ°á»›c:

```
Millisecond access (Standard, IA, Glacier Instant):
  GET object â†’ nháº­n data ngay láº­p tá»©c

Cáº§n restore (Glacier Flexible, Deep Archive):
  GET object â†’ Error 403 (pháº£i restore trÆ°á»›c!)
  
  BÆ°á»›c 1: POST restore request
  BÆ°á»›c 2: Chá» 1 phÃºt â†’ 48 giá» (tuá»³ option vÃ  storage class)
  BÆ°á»›c 3: AWS copy object táº¡m sang tier cÃ³ thá»ƒ access
  BÆ°á»›c 4: GET object â†’ nháº­n data
  BÆ°á»›c 5: Sau X ngÃ y (báº¡n chá»n), báº£n copy táº¡m bá»‹ xÃ³a
```

**Táº¡i sao thiáº¿t káº¿ váº­y?** Äá»•i láº¡i thá»i gian chá» â†’ **giÃ¡ storage ráº» hÆ¡n ráº¥t nhiá»u**.

---

### 7. S3 Glacier Flexible Retrieval

**Use case:** Archive data, access ~1 láº§n/nÄƒm, khÃ´ng cáº§n immediate access

- Storage cost ráº¥t tháº¥p
- **Min storage duration:** 90 ngÃ y
- **Pháº£i restore trÆ°á»›c khi access** (khÃ´ng real-time)

**Retrieval options:**

| Option | Thá»i gian | Cost |
|--------|-----------|------|
| **Expedited** | 1-5 minutes | Cao nháº¥t |
| **Standard** | 3-5 hours | Trung bÃ¬nh |
| **Bulk** | 5-12 hours | Tháº¥p nháº¥t |

**PhÃ¹ há»£p cho:** Backup, disaster recovery, compliance archives

---

### 8. S3 Glacier Deep Archive

**Use case:** Long-term archive, access < 1 láº§n/nÄƒm, lÆ°u trá»¯ 7-10+ nÄƒm

- **Ráº» nháº¥t** trong táº¥t cáº£ storage classes
- **Min storage duration:** 180 ngÃ y
- **Pháº£i restore trÆ°á»›c khi access**

**Retrieval options:**

| Option | Thá»i gian |
|--------|-----------|
| **Standard** | 12 hours |
| **Bulk** | 48 hours |

**PhÃ¹ há»£p cho:** Compliance archives (financial, healthcare), magnetic tape replacement

---

### LÆ°u Ã½ quan trá»ng vá» Min Duration vÃ  Min Size

```
VÃ­ dá»¥ vá»›i S3 Standard-IA (min 30 days, min 128 KB):

1. Upload file 50 KB â†’ bá»‹ charge nhÆ° 128 KB
2. Upload file, xÃ³a sau 10 ngÃ y â†’ váº«n bá»‹ charge 30 ngÃ y storage
3. Upload file, transition sang Glacier sau 15 ngÃ y â†’ charge 30 ngÃ y Standard-IA + Glacier
```

> **Nguá»“n:** [Understanding and managing Amazon S3 storage classes](https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-class-intro.html)

---

## Storage Management

### S3 Lifecycle

Tá»± Ä‘á»™ng chuyá»ƒn objects giá»¯a storage classes hoáº·c xÃ³a sau má»™t thá»i gian:

```
Lifecycle Rule Example:
- Transition to Standard-IA after 30 days
- Transition to Glacier after 90 days
- Delete after 365 days
```

### S3 Replication

> **LÆ°u Ã½:** ÄÃ¢y lÃ  tÃ­nh nÄƒng báº¡n **tá»± cáº¥u hÃ¬nh**, khÃ¡c vá»›i viá»‡c AWS tá»± Ä‘á»™ng replicate sang 3 AZs!

**2 loáº¡i replication khÃ¡c nhau:**

| | Automatic (3 AZs) | S3 Replication (CRR/SRR) |
|---|-------------------|--------------------------|
| **Cáº¥u hÃ¬nh** | AWS tá»± Ä‘á»™ng lÃ m | Báº¡n pháº£i tá»± setup |
| **Scope** | Trong cÃ¹ng 1 bucket, cÃ¹ng Region | Sang **bucket khÃ¡c** |
| **Má»¥c Ä‘Ã­ch** | Durability 11 nines | DR, compliance, latency |
| **Control** | KhÃ´ng control Ä‘Æ°á»£c | Báº¡n chá»n destination |

```
Automatic 3 AZs (báº¡n khÃ´ng tháº¥y, khÃ´ng control):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Bucket A (us-east-1)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ AZ1 â”‚  â”‚ AZ2 â”‚  â”‚ AZ3 â”‚  â† AWS tá»± Ä‘á»™ng
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

S3 Replication (báº¡n cáº¥u hÃ¬nh):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bucket A         â”‚ â”€â”€â–º â”‚ Bucket B         â”‚
â”‚ (us-east-1)      â”‚     â”‚ (eu-west-1)      â”‚  â† báº¡n setup
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CÃ¡c loáº¡i S3 Replication:**
- **Cross-Region Replication (CRR)** - replicate sang Region khÃ¡c
- **Same-Region Replication (SRR)** - replicate trong cÃ¹ng Region

**YÃªu cáº§u:** Versioning pháº£i **enabled** á»Ÿ cáº£ source vÃ  destination bucket

**Use cases:**
- **CRR**: Disaster recovery, compliance (data pháº£i á»Ÿ EU), giáº£m latency cho users á»Ÿ region khÃ¡c
- **SRR**: Aggregate logs tá»« nhiá»u buckets, copy giá»¯a dev/prod accounts

> **Xem thÃªm:** [AWS Overview - Regions vÃ  AZs](aws-overview.md#regions) Ä‘á»ƒ hiá»ƒu vá» Region, AZ

### S3 Object Lock

Chá»‘ng xÃ³a/overwrite objects theo mÃ´ hÃ¬nh **WORM** (Write Once Read Many) - thÆ°á»ng dÃ¹ng cho compliance.

**2 cÃ¡ch báº£o vá»‡:**

| | Retention Period | Legal Hold |
|---|------------------|------------|
| **Thá»i háº¡n** | Cá»‘ Ä‘á»‹nh (vd: 365 ngÃ y) | KhÃ´ng cÃ³, cho Ä‘áº¿n khi táº¯t |
| **Use case** | Compliance, regulatory | Litigation, Ä‘iá»u tra, audit |
| **Káº¿t thÃºc** | Tá»± Ä‘á»™ng háº¿t háº¡n | Pháº£i manually remove |

**2 Retention Modes:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GOVERNANCE MODE                          â”‚
â”‚  - Users thÆ°á»ng KHÃ”NG THá»‚ xÃ³a/overwrite                     â”‚
â”‚  - Users cÃ³ permission s3:BypassGovernanceRetention CÃ“ THá»‚  â”‚
â”‚  - CÃ³ thá»ƒ extend hoáº·c shorten retention                     â”‚
â”‚  - Use case: Test, flexible WORM                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPLIANCE MODE                          â”‚
â”‚  - KHÃ”NG AI cÃ³ thá»ƒ xÃ³a, ká»ƒ cáº£ root user                     â”‚
â”‚  - KHÃ”NG THá»‚ shorten retention period                       â”‚
â”‚  - CÃ¡ch duy nháº¥t xÃ³a sá»›m: XÃ“A Cáº¢ AWS ACCOUNT               â”‚
â”‚  - Use case: Regulatory compliance (SEC, FINRA, HIPAA)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VÃ­ dá»¥ thá»±c táº¿:**
```
Scenario: NgÃ¢n hÃ ng cáº§n giá»¯ records 7 nÄƒm (compliance)

1. Enable Object Lock trÃªn bucket (khi táº¡o bucket)
2. Set default retention: 7 years, Compliance mode
3. Upload transaction records

â†’ KhÃ´ng ai cÃ³ thá»ƒ xÃ³a records trong 7 nÄƒm
â†’ Ká»ƒ cáº£ CEO, ká»ƒ cáº£ root account
â†’ ÄÃ¡p á»©ng audit requirements
```

**YÃªu cáº§u & lÆ°u Ã½:**
- **Versioning pháº£i enabled**
- Object Lock pháº£i enable **khi táº¡o bucket** (khÃ´ng thá»ƒ enable sau vá»›i existing bucket)
- Má»™t khi enable, **khÃ´ng thá»ƒ disable**

> **Nguá»“n:** [S3 Object Lock](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lock.html)

### S3 Batch Operations

- Thá»±c hiá»‡n operations trÃªn hÃ ng triá»‡u/tá»· objects
- Operations: Copy, Invoke Lambda, Restore, Tagging, etc.

---

## Access Management & Security

### Default Security

- Buckets vÃ  objects máº·c Ä‘á»‹nh lÃ  **private**
- Chá»‰ owner/account administrator cÃ³ access

### Access Control Methods

| Method | Scope | Use Case |
|--------|-------|----------|
| **IAM Policies** | User/Role level | Control user access to S3 |
| **Bucket Policies** | Bucket level | Cross-account, public access |
| **Access Points** | Named endpoints | Simplified access for shared datasets |
| **ACLs** | Object/Bucket level | Legacy, khÃ´ng khuyáº¿n khÃ­ch |
| **S3 Block Public Access** | Account/Bucket level | Prevent public access |

### Bucket Policy Example

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    }
  ]
}
```

### Encryption

**Server-Side Encryption (SSE):**
- **SSE-S3** - AWS managed keys (default tá»« Jan 2023)
- **SSE-KMS** - Customer managed keys via KMS
- **SSE-C** - Customer-provided keys
- **DSSE-KMS** - Dual-layer encryption

**Client-Side Encryption:**
- Encrypt trÆ°á»›c khi upload

### S3 Object Ownership

- **Bucket owner enforced** (recommended) - disable ACLs, bucket owner owns all objects
- **Bucket owner preferred** - bucket owner owns objects náº¿u upload vá»›i `bucket-owner-full-control`
- **Object writer** - uploader owns the object

> **Xem chi tiáº¿t:** [S3 Security](s3-security.md) - Access Control, Encryption, Block Public Access, Pre-signed URLs, VPC Endpoints
>
> **Nguá»“n:** [Amazon S3 Security Features](https://aws.amazon.com/s3/security/)

---

## S3 Performance

### Baseline Performance

S3 cÃ³ kháº£ nÄƒng xá»­ lÃ½ **ráº¥t cao** out-of-the-box:

| Metric | Per Prefix |
|--------|------------|
| **GET/HEAD requests** | 5,500 requests/second |
| **PUT/COPY/POST/DELETE** | 3,500 requests/second |

> **Prefix** = pháº§n path trÆ°á»›c object name. VÃ­ dá»¥: `bucket/folder1/subfolder/` lÃ  1 prefix.

```
VÃ­ dá»¥: Bucket vá»›i nhiá»u prefixes

s3://my-bucket/images/2024/   â† 5,500 GET/s + 3,500 PUT/s
s3://my-bucket/images/2025/   â† 5,500 GET/s + 3,500 PUT/s  
s3://my-bucket/videos/        â† 5,500 GET/s + 3,500 PUT/s

â†’ DÃ¹ng nhiá»u prefixes = Scale gáº§n nhÆ° vÃ´ háº¡n!
```

### Tá»‘i Æ°u Performance

#### 1. Multi-Part Upload

**Báº¯t buá»™c** cho files > 5GB, **khuyáº¿n nghá»‹** cho files > 100MB.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTI-PART UPLOAD                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  File 1GB                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Part 1 â”‚ Part 2 â”‚ Part 3 â”‚ Part 4 â”‚ ... â”‚ Part 10      â”‚    â”‚
â”‚  â”‚ 100MB  â”‚ 100MB  â”‚ 100MB  â”‚ 100MB  â”‚     â”‚ 100MB        â”‚    â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚      â”‚        â”‚        â”‚        â”‚              â”‚                â”‚
â”‚      â–¼        â–¼        â–¼        â–¼              â–¼                â”‚
â”‚   Upload   Upload   Upload   Upload         Upload              â”‚
â”‚   song song (parallel) â†’ NHANH HÆ N!                             â”‚
â”‚      â”‚        â”‚        â”‚        â”‚              â”‚                â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                         â”‚                                        â”‚
â”‚                         â–¼                                        â”‚
â”‚                  S3 ghÃ©p láº¡i thÃ nh 1 file                       â”‚
â”‚                                                                  â”‚
â”‚  âœ… Upload song song nhiá»u parts                                â”‚
â”‚  âœ… Retry chá»‰ parts failed (khÃ´ng retry cáº£ file)                â”‚
â”‚  âœ… Báº¯t Ä‘áº§u upload khi váº«n Ä‘ang generate file                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. S3 Transfer Acceleration

Upload/download qua AWS Edge Locations thay vÃ¬ public internet.

```
WITHOUT Acceleration:        WITH Acceleration:
User â”€â”€â–º Internet â”€â”€â–º S3     User â”€â”€â–º Edge â•â•â–º AWS Backbone â•â•â–º S3
         (slow)                       (fast)    (optimized)
```

- Endpoint: `bucket-name.s3-accelerate.amazonaws.com`
- Chá»‰ charge khi thá»±c sá»± nhanh hÆ¡n
- Tá»‘t cho: long-distance transfers, large files

#### 3. Byte-Range Fetches (Parallel Downloads)

Download má»™t pháº§n file hoáº·c download song song nhiá»u pháº§n.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BYTE-RANGE FETCHES                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  File 1GB trÃªn S3                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 0-100MB â”‚ 100-200MB â”‚ 200-300MB â”‚ ... â”‚ 900MB-1GB      â”‚    â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚      â”‚           â”‚            â”‚                   â”‚              â”‚
â”‚      â–¼           â–¼            â–¼                   â–¼              â”‚
â”‚  GET byte=0-100MB  GET byte=100-200MB  ...  GET byte=900-1GB    â”‚
â”‚      â”‚           â”‚            â”‚                   â”‚              â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                                       â”‚
â”‚                          â–¼                                       â”‚
â”‚                   GhÃ©p láº¡i á»Ÿ client                              â”‚
â”‚                                                                  â”‚
â”‚  âœ… Download song song (parallel) â†’ NHANH HÆ N                   â”‚
â”‚  âœ… Retry chá»‰ pháº§n failed                                       â”‚
â”‚  âœ… Download chá»‰ pháº§n cáº§n thiáº¿t (vd: header cá»§a video)          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Use cases:**
- Parallel download Ä‘á»ƒ tÄƒng tá»‘c
- Download chá»‰ metadata/header cá»§a file
- Resume download bá»‹ giÃ¡n Ä‘oáº¡n

#### 4. S3 Select / Glacier Select

Query data trá»±c tiáº¿p trong S3 mÃ  khÃ´ng cáº§n download toÃ n bá»™ file.

```
Truyá»n thá»‘ng:
Download 1GB CSV â†’ Filter á»Ÿ client â†’ Chá»‰ cáº§n 10MB data
â†’ Tá»‘n bandwidth, cháº­m

S3 Select:
Query trá»±c tiáº¿p trÃªn S3 â†’ Chá»‰ tráº£ vá» 10MB data cáº§n
â†’ Tiáº¿t kiá»‡m bandwidth, nhanh hÆ¡n
```

```sql
-- S3 Select query (SQL-like)
SELECT s.name, s.age FROM S3Object s WHERE s.age > 25
```

**Há»— trá»£ formats:** CSV, JSON, Parquet

### TÃ³m táº¯t Performance Optimizations

| Technique | Use Case | Benefit |
|-----------|----------|---------|
| **Multi-Part Upload** | Files > 100MB | Parallel upload, retry parts |
| **Transfer Acceleration** | Long distance | Faster via Edge Locations |
| **Byte-Range Fetches** | Large downloads | Parallel download, partial fetch |
| **S3 Select** | Query large files | Reduce data transfer |
| **Multiple Prefixes** | High throughput | Scale requests linearly |

> **Nguá»“n:** [S3 Performance Guidelines](https://docs.aws.amazon.com/AmazonS3/latest/userguide/optimizing-performance.html)

---

## Data Processing

### S3 Object Lambda

**S3 Object Lambda** cho phÃ©p thÃªm code Ä‘á»ƒ **transform data on-the-fly** khi GET object, mÃ  khÃ´ng cáº§n sá»­a object gá»‘c.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    S3 OBJECT LAMBDA                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Truyá»n thá»‘ng (khÃ´ng cÃ³ Object Lambda):                         â”‚
â”‚                                                                  â”‚
â”‚  App â”€â”€â–º GET object â”€â”€â–º S3 â”€â”€â–º Raw data                        â”‚
â”‚  App â”€â”€â–º Transform locally (tá»‘n CPU, memory)                    â”‚
â”‚                                                                  â”‚
â”‚  HOáº¶C: Store nhiá»u versions (original + transformed)            â”‚
â”‚        â†’ Tá»‘n storage, pháº£i sync                                 â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                  â”‚
â”‚  Vá»›i S3 Object Lambda:                                           â”‚
â”‚                                                                  â”‚
â”‚  App â”€â”€â–º Object Lambda â”€â”€â–º Lambda Function â”€â”€â–º S3               â”‚
â”‚          Access Point        (transform)        (raw data)       â”‚
â”‚               â”‚                   â”‚                              â”‚
â”‚               â””â”€â”€â”€â”€â”€â–º Tráº£ vá» transformed data                   â”‚
â”‚                                                                  â”‚
â”‚  â†’ Chá»‰ lÆ°u 1 báº£n gá»‘c, transform khi cáº§n                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CÃ¡ch hoáº¡t Ä‘á»™ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    App    â”‚â”€â”€â”€â–ºâ”‚ Object Lambda       â”‚â”€â”€â”€â–ºâ”‚    Lambda    â”‚â”€â”€â”€â–ºâ”‚    S3    â”‚
â”‚           â”‚    â”‚ Access Point        â”‚    â”‚   Function   â”‚    â”‚  Bucket  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                            â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ Transformed Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. App gá»i **Object Lambda Access Point** (khÃ´ng gá»i trá»±c tiáº¿p S3)
2. Object Lambda Access Point invoke **Lambda function**
3. Lambda láº¥y object gá»‘c tá»« S3, transform, tráº£ vá» cho app

#### Use Cases phá»• biáº¿n

| Use Case | MÃ´ táº£ |
|----------|-------|
| **Resize images** | Tráº£ vá» thumbnail thay vÃ¬ image gá»‘c |
| **Redact PII** | Che thÃ´ng tin nháº¡y cáº£m (SSN, email...) |
| **Convert formats** | XML â†’ JSON, PNG â†’ WebP |
| **Decompress** | Gunzip on-the-fly |
| **Add watermark** | ThÃªm watermark vÃ o images |
| **Filter data** | Tráº£ vá» subset cá»§a data dá»±a trÃªn user role |
| **Enrich data** | ThÃªm metadata tá»« external source |

#### VÃ­ dá»¥: Redact PII

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Original JSON in S3:                                            â”‚
â”‚  {                                                                â”‚
â”‚    "name": "John Doe",                                           â”‚
â”‚    "email": "john@example.com",    â† PII                         â”‚
â”‚    "ssn": "123-45-6789",           â† PII                         â”‚
â”‚    "department": "Engineering"                                   â”‚
â”‚  }                                                                â”‚
â”‚                                                                  â”‚
â”‚  After Object Lambda (redact):                                   â”‚
â”‚  {                                                                â”‚
â”‚    "name": "John Doe",                                           â”‚
â”‚    "email": "***REDACTED***",      â† ÄÃ£ che                      â”‚
â”‚    "ssn": "***REDACTED***",        â† ÄÃ£ che                      â”‚
â”‚    "department": "Engineering"                                   â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Lambda Function Example (Node.js)

```javascript
const { S3 } = require('@aws-sdk/client-s3');

exports.handler = async (event) => {
  // Get object tá»« S3
  const s3Client = new S3();
  const response = await s3Client.getObject({
    Bucket: event.getObjectContext.inputS3Url,
  });
  
  // Transform data
  const originalData = await response.Body.transformToString();
  const jsonData = JSON.parse(originalData);
  
  // Redact PII
  jsonData.email = "***REDACTED***";
  jsonData.ssn = "***REDACTED***";
  
  // Return transformed data
  await s3Client.writeGetObjectResponse({
    RequestRoute: event.getObjectContext.outputRoute,
    RequestToken: event.getObjectContext.outputToken,
    Body: JSON.stringify(jsonData),
  });
  
  return { statusCode: 200 };
};
```

#### So sÃ¡nh vá»›i cÃ¡c giáº£i phÃ¡p khÃ¡c

| Approach | Storage | Performance | Flexibility |
|----------|---------|-------------|-------------|
| Store multiple versions | âŒ Nhiá»u | âœ… Nhanh | âŒ Pháº£i sync |
| Transform on client | âœ… 1 báº£n | âŒ Cháº­m | âœ… Linh hoáº¡t |
| **S3 Object Lambda** | âœ… 1 báº£n | âš¡ Tá»‘t | âœ… Linh hoáº¡t |

#### Pricing

- **Lambda invocation**: TÃ­nh nhÆ° Lambda bÃ¬nh thÆ°á»ng
- **Data transfer**: Tá»« S3 â†’ Lambda â†’ Client
- **No additional Object Lambda fee**

> ğŸ’¡ **Khi nÃ o dÃ¹ng:** Khi cáº§n transform data nhÆ°ng khÃ´ng muá»‘n lÆ°u nhiá»u versions, hoáº·c transformation phá»¥ thuá»™c vÃ o context (user role, request params...).

### Event Notifications

Trigger workflows khi cÃ³ changes trong S3.

#### CÃ¡ch hoáº¡t Ä‘á»™ng

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    S3 EVENT NOTIFICATIONS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   S3 Bucket                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Object Created (PUT, POST, COPY, MultiPart)            â”‚   â”‚
â”‚   â”‚  Object Removed (DELETE, DeleteMarkerCreated)           â”‚   â”‚
â”‚   â”‚  Object Restore (Glacier restore completed)             â”‚   â”‚
â”‚   â”‚  Replication Events                                      â”‚   â”‚
â”‚   â”‚  ...                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                   DESTINATIONS                           â”‚   â”‚
â”‚   â”‚                                                         â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚   â”‚   SNS   â”‚  â”‚   SQS   â”‚  â”‚ Lambda  â”‚  â”‚EventBridgeâ”‚ â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CÃ¡c loáº¡i Events

| Event Type | Trigger khi |
|------------|-------------|
| `s3:ObjectCreated:*` | PUT, POST, COPY, MultipartUpload complete |
| `s3:ObjectRemoved:*` | DELETE hoáº·c DeleteMarkerCreated |
| `s3:ObjectRestore:*` | Glacier restore báº¯t Ä‘áº§u/hoÃ n thÃ nh |
| `s3:Replication:*` | Replication failed/completed |
| `s3:LifecycleExpiration:*` | Object bá»‹ xÃ³a bá»Ÿi lifecycle |
| `s3:LifecycleTransition` | Object chuyá»ƒn storage class |
| `s3:IntelligentTiering` | Object chuyá»ƒn tier trong IT |

#### Destinations

| Destination | Use Case | Äáº·c Ä‘iá»ƒm |
|-------------|----------|----------|
| **Amazon SNS** | Fan-out (gá»­i Ä‘áº¿n nhiá»u subscribers) | Push notifications, email, SMS |
| **Amazon SQS** | Queue xá»­ lÃ½ tuáº§n tá»± | Decoupling, retry, batch processing |
| **AWS Lambda** | Serverless processing | Real-time, custom code |
| **EventBridge** | Complex routing, filtering | Rules, cross-account, archive |

#### So sÃ¡nh Destinations

```
SNS (Fan-out):
â”Œâ”€â”€â”€â”€â”€â”
â”‚ S3  â”‚â”€â”€â–º SNS â”€â”€â”¬â”€â”€â–º SQS Queue 1
â””â”€â”€â”€â”€â”€â”˜          â”œâ”€â”€â–º SQS Queue 2  
                 â”œâ”€â”€â–º Lambda
                 â””â”€â”€â–º Email

SQS (Queue):
â”Œâ”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ S3  â”‚â”€â”€â–º SQS â”€â”€â–º Workers â”‚  (xá»­ lÃ½ tuáº§n tá»±)
â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Lambda (Direct):
â”Œâ”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ S3  â”‚â”€â”€â–º Lambda (resize image, process) â”‚
â””â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

EventBridge (Advanced):
â”Œâ”€â”€â”€â”€â”€â”                   â”Œâ”€â–º Lambda A (*.jpg)
â”‚ S3  â”‚â”€â”€â–º EventBridge â”€â”€â”€â”¼â”€â–º SQS (*.pdf)
â””â”€â”€â”€â”€â”€â”˜     (filter)      â””â”€â–º SNS (*.mp4)
```

#### Use Cases phá»• biáº¿n

| Use Case | Event | Destination | Action |
|----------|-------|-------------|--------|
| **Image thumbnail** | ObjectCreated | Lambda | Resize, save thumbnail |
| **Video transcoding** | ObjectCreated | SQS â†’ MediaConvert | Convert video formats |
| **Log processing** | ObjectCreated | Lambda â†’ ES | Index logs cho search |
| **Backup notification** | ObjectCreated | SNS â†’ Email | Notify admin |
| **Data pipeline** | ObjectCreated | EventBridge â†’ Step Functions | ETL workflow |
| **Audit trail** | All events | EventBridge â†’ CloudWatch Logs | Logging |

#### VÃ­ dá»¥: Image Processing Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IMAGE PROCESSING PIPELINE                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   User uploads image.jpg                                         â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚ S3 Bucket     â”‚                                             â”‚
â”‚   â”‚ /uploads/     â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚           â”‚ s3:ObjectCreated:Put                                â”‚
â”‚           â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚    Lambda     â”‚                                             â”‚
â”‚   â”‚ (resize.py)   â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚           â”‚                                                      â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”                                               â”‚
â”‚     â–¼     â–¼     â–¼                                               â”‚
â”‚   small  med  large                                              â”‚
â”‚   100px  300px 800px                                             â”‚
â”‚     â”‚     â”‚     â”‚                                               â”‚
â”‚     â–¼     â–¼     â–¼                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚   â”‚ S3 Bucket     â”‚                                             â”‚
â”‚   â”‚ /thumbnails/  â”‚                                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### LÆ°u Ã½ quan trá»ng

> [!IMPORTANT]
> **Permissions:** Destination (SNS/SQS/Lambda) pháº£i cÃ³ policy cho phÃ©p S3 gá»­i events.

```json
// SQS Policy Example
{
  "Statement": [{
    "Effect": "Allow",
    "Principal": {"Service": "s3.amazonaws.com"},
    "Action": "sqs:SendMessage",
    "Resource": "arn:aws:sqs:region:account:queue",
    "Condition": {
      "ArnLike": {"aws:SourceArn": "arn:aws:s3:::bucket-name"}
    }
  }]
}
```

> [!TIP]
> **EventBridge vs Legacy (SNS/SQS/Lambda):**
> - **Legacy:** Faster, simpler, direct integration
> - **EventBridge:** More powerful filtering, routing rules, cross-account, archive events

---

## Monitoring & Analytics

### Monitoring Tools

| Tool | Purpose |
|------|---------|
| **CloudWatch Metrics** | Monitor operational health |
| **CloudTrail** | API logging vÃ  auditing |
| **Server Access Logging** | Detailed request logs |
| **S3 Storage Lens** | 60+ metrics, dashboards |

### Analytics

- **Storage Class Analysis** - phÃ¢n tÃ­ch access patterns Ä‘á»ƒ tá»‘i Æ°u storage class
- **S3 Inventory** - bÃ¡o cÃ¡o objects vÃ  metadata

---

## Data Consistency

S3 cung cáº¥p **strong read-after-write consistency**:
- PUT new object â†’ immediately readable
- PUT overwrite â†’ immediately see new version
- DELETE â†’ immediately not found

Applies to táº¥t cáº£ AWS Regions.

---

## Pricing

S3 tÃ­nh phÃ­ theo:
- **Storage** - GB per month
- **Requests** - PUT, COPY, POST, LIST, GET, SELECT
- **Data Transfer** - OUT to internet, cross-region
- **Management features** - Inventory, Analytics, Object Tagging

**Free Tier (12 months):**
- 5 GB S3 Standard storage
- 20,000 GET requests
- 2,000 PUT requests

> **Nguá»“n:** [Amazon S3 Pricing](https://aws.amazon.com/s3/pricing/)

---

## Requester Pays

**Requester Pays** cho phÃ©p bucket owner **chuyá»ƒn chi phÃ­** data transfer vÃ  request sang cho **ngÆ°á»i request** (requester) thay vÃ¬ tráº£ tiá»n táº¥t cáº£.

### Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t

```
TÃŒNH HUá»NG THÃ”NG THÆ¯á»œNG:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Báº¡n cÃ³ 100TB dá»¯ liá»‡u research Ä‘á»ƒ chia sáº»                       â”‚
â”‚                                                                  â”‚
â”‚  User A download 10TB â”€â”                                        â”‚
â”‚  User B download 20TB  â”œâ”€â”€â–º Báº N pháº£i tráº£ ~$2,700/thÃ¡ng!        â”‚
â”‚  User C download 30TB â”€â”˜    (data transfer out)                 â”‚
â”‚                                                                  â”‚
â”‚  â†’ CÃ ng nhiá»u ngÆ°á»i dÃ¹ng, báº¡n cÃ ng Tá»N TIá»€N                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Vá»šI REQUESTER PAYS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Báº¡n chá»‰ tráº£ chi phÃ­ STORAGE (~$2,300/thÃ¡ng cho 100TB)         â”‚
â”‚                                                                  â”‚
â”‚  User A download 10TB â”€â”€â–º User A tráº£ $900                       â”‚
â”‚  User B download 20TB â”€â”€â–º User B tráº£ $1,800                     â”‚
â”‚  User C download 30TB â”€â”€â–º User C tráº£ $0 (náº¿u cÃ¹ng region)      â”‚
â”‚                                                                  â”‚
â”‚  â†’ CÃ´ng báº±ng: ai dÃ¹ng, ngÆ°á»i Ä‘Ã³ tráº£                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chi phÃ­ Ä‘Æ°á»£c chuyá»ƒn cho Requester

| Chi phÃ­ | Bucket Owner | Requester |
|---------|--------------|-----------|
| **Storage** | âœ… Tráº£ | - |
| **Data Transfer OUT** | - | âœ… Tráº£ |
| **GET/PUT Requests** | - | âœ… Tráº£ |
| **Same-region transfer** | - | Miá»…n phÃ­ |

### CÃ¡ch hoáº¡t Ä‘á»™ng

```
1. Bucket owner enable "Requester Pays" trÃªn bucket

2. Requester pháº£i:
   â”œâ”€â”€ CÃ³ AWS account (authenticated)
   â”œâ”€â”€ Gá»­i request vá»›i header: x-amz-request-payer: requester
   â””â”€â”€ Hoáº·c CLI: --request-payer requester

3. AWS tÃ­nh phÃ­ vÃ o account cá»§a requester, khÃ´ng pháº£i bucket owner
```

**LÆ°u Ã½ quan trá»ng:**
- âŒ **Anonymous access khÃ´ng hoáº¡t Ä‘á»™ng** - Requester PHáº¢I cÃ³ AWS account
- âŒ KhÃ´ng thá»ƒ dÃ¹ng pre-signed URLs (vÃ¬ cáº§n authenticated request)
- âœ… Bucket owner váº«n control access qua bucket policy

### Use Cases

| Use Case | MÃ´ táº£ |
|----------|-------|
| **Public datasets** | NASA, genome data, weather data - ai dÃ¹ng, ngÆ°á»i Ä‘Ã³ tráº£ |
| **Data marketplace** | BÃ¡n/share data mÃ  khÃ´ng lo chi phÃ­ bandwidth |
| **Research data** | Universities share research data |
| **Media archives** | Stock photos/videos, download theo nhu cáº§u |

### VÃ­ dá»¥ CLI

```bash
# Download tá»« requester pays bucket
aws s3 cp s3://requester-pays-bucket/file.txt ./file.txt --request-payer requester

# List objects
aws s3 ls s3://requester-pays-bucket/ --request-payer requester
```

### Enable Requester Pays

```bash
# Enable
aws s3api put-bucket-request-payment \
  --bucket my-bucket \
  --request-payment-configuration Payer=Requester

# Check status
aws s3api get-bucket-request-payment --bucket my-bucket
```

> **Nguá»“n:** [Using Requester Pays buckets](https://docs.aws.amazon.com/AmazonS3/latest/userguide/RequesterPaysBuckets.html)

---

## Best Practices

1. **Enable versioning** Ä‘á»ƒ báº£o vá»‡ khá»i accidental deletes
2. **Use Lifecycle policies** Ä‘á»ƒ tá»‘i Æ°u costs
3. **Enable S3 Block Public Access** trá»« khi cáº§n public
4. **Use SSE-KMS** cho sensitive data
5. **Enable CloudTrail** Ä‘á»ƒ audit access
6. **Use S3 Intelligent-Tiering** náº¿u khÃ´ng biáº¿t access patterns
7. **Use multipart upload** cho files > 100MB
8. **Use S3 Transfer Acceleration** cho long-distance transfers

---

## S3 Transfer Acceleration

TÄƒng tá»‘c upload/download files qua long distances báº±ng AWS Edge Locations.

```
WITHOUT Acceleration:        WITH Acceleration:
User â”€â”€â–º Internet â”€â”€â–º S3     User â”€â”€â–º Edge â•â•â–º AWS Backbone â•â•â–º S3
         (slow)                       (fast)    (optimized)
```

**Key points:**
- DÃ¹ng endpoint: `bucket-name.s3-accelerate.amazonaws.com`
- **Chá»‰ charge khi nhanh hÆ¡n** (AWS tá»± Ä‘á»™ng bypass náº¿u khÃ´ng cáº£i thiá»‡n)
- Pricing: ~$0.04-0.08/GB
- Hiá»‡u quáº£ nháº¥t khi: client xa bucket, file lá»›n

ğŸ“– **Xem chi tiáº¿t:** [S3 Transfer Acceleration Deep Dive](s3-transfer-acceleration.md)

---

## So sÃ¡nh vá»›i EBS vÃ  EFS

| Feature | S3 | EBS | EFS |
|---------|----|----|-----|
| Type | Object storage | Block storage | File storage |
| Access | HTTP/HTTPS API | Attached to EC2 | NFS mount |
| Scope | Regional | Single AZ | Regional |
| Max size | Unlimited | 64 TiB/volume | Unlimited |
| Use case | Static files, backups | OS, databases | Shared files |

---

## LiÃªn káº¿t

- [EBS](ebs.md) - Block storage cho EC2
- [EFS](efs.md) - Shared file storage
- [IAM](iam.md) - Access management
- [VPC](vpc.md) - Network configuration

---

## TÃ i liá»‡u tham kháº£o

- [What is Amazon S3?](https://docs.aws.amazon.com/AmazonS3/latest/userguide/Welcome.html)
- [Amazon S3 Features](https://aws.amazon.com/s3/features/)
- [S3 Storage Classes](https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-class-intro.html)
- [Getting started with Amazon S3](https://docs.aws.amazon.com/AmazonS3/latest/userguide/GetStartedWithS3.html)
